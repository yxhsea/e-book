<html class="cye-disabled cye-lm"><head><meta charset="utf-8"><meta name="referrer" content="no-referrer"><meta name="Keywords" content="极客时间,极客邦,极客邦科技,极客邦控股,极客时间App,专栏订阅,极客新闻,二叉树,极客Live,QCon,左耳听风,AI技术内参,大航海时代,陈皓,徐飞,洪亮劼,霍泰稳,池建强,Selina,Gary,InfoQ,极客搜索"><meta name="description" content="极客时间是极客邦科技出品的一款 IT 内容知识服务 App，内容包含专栏订阅、极客新闻、热点专题、直播、视频和音频等多形式的知识内容，并设有陈皓专栏、徐飞专栏、洪亮劼专栏等专栏供订阅。"><link rel="apple-touch-icon" sizes="180x180" href="http://static001.geekbang.org/static/icon/time/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="http://static001.geekbang.org/static/icon/time/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="http://static001.geekbang.org/static/icon/time/favicon-16x16.png"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,viewport-fit=cover"><meta name="format-detection" content="telephone=no"><title>10 |	基本概念：节点、集群、分片及副本</title><link href="https://static001.geekbang.org/static/time/css/app.b230db929e53af87acd535637f5011b8.css" rel="stylesheet"><style type="text/css">        @font-face {            font-family: player-font;            src: url("//at.alicdn.com/t/font_509397_9fpjwjp73uqsemi.eot");            src: url("//at.alicdn.com/t/font_509397_9fpjwjp73uqsemi.eot?#iefix") format("embedded-opentype"), url("//at.alicdn.com/t/font_509397_9fpjwjp73uqsemi.woff") format("woff"), url("//at.alicdn.com/t/font_509397_9fpjwjp73uqsemi.ttf") format("truetype"), url("//at.alicdn.com/t/font_509397_9fpjwjp73uqsemi.svg#player-font") format("svg")        }        .player-font {            font-family: player-font !important;            font-size: 16px;            font-style: normal;            -webkit-font-smoothing: antialiased;            -webkit-text-stroke-width: .2px;            -moz-osx-font-smoothing: grayscale        }        .vplayer {            position: relative;            overflow: hidden        }        .vplayer,        .vplayer video {            width: 100%        }        .vplayer .title {            position: absolute;            top: 1rem;            left: 1rem;            right: 1rem;            color: #fff;            font-weight: 400;            font-size: .875rem;            word-break: break-all;            display: -webkit-box;            overflow: hidden;            text-overflow: ellipsis;            -webkit-box-orient: vertical;            -webkit-line-clamp: 1        }        .vplayer .finish-control,        .vplayer .loading {            position: absolute;            top: 0;            left: 0;            background: rgba(0, 0, 0, .5);            color: #fff;            width: 100%;            height: 100%;            z-index: 2;            display: -webkit-box;            display: -ms-flexbox;            display: flex;            -webkit-box-align: center;            -ms-flex-align: center;            align-items: center;            -webkit-box-pack: center;            -ms-flex-pack: center;            justify-content: center        }        .vplayer .finish-control h3,        .vplayer .loading h3 {            position: absolute;            color: #fff;            top: 1rem;            left: 50%;            font-size: 1rem;            font-weight: 400;            -webkit-transform: translate(-50%);            transform: translate(-50%)        }        .vplayer .finish-control p,        .vplayer .loading p {            cursor: pointer;            max-height: 6rem;            text-align: center        }        .vplayer .finish-control .cancel-next,        .vplayer .loading .cancel-next {            margin-left: 4rem        }        .vplayer .finish-control .cancel-next .icon-cancel-next,        .vplayer .loading .cancel-next .icon-cancel-next {            height: 4rem;            line-height: 4rem;            cursor: pointer;            font-size: 3.5rem        }        .vplayer .finish-control .cancel-next .icon-cancel-next i,        .vplayer .loading .cancel-next .icon-cancel-next i {            position: absolute;            top: 0;            left: 0;            margin-left: 8px        }        .vplayer .finish-control .icon-replay,        .vplayer .loading .icon-replay {            height: 4rem;            cursor: pointer;            line-height: 4rem;            font-size: 3rem        }        .vplayer .finish-control {            background: #000        }        .vplayer .no-wifi {            width: 70%;            position: absolute;            left: 50%;            top: 50%;            padding: 1rem;            background: rgba(0, 0, 0, .8);            -webkit-transform: translate(-50%, -50%);            transform: translate(-50%, -50%);            display: -webkit-box;            display: -ms-flexbox;            display: flex;            -webkit-box-orient: vertical;            -webkit-box-direction: normal;            -ms-flex-direction: column;            flex-direction: column;            -webkit-box-pack: center;            -ms-flex-pack: center;            justify-content: center;            -webkit-box-align: center;            -ms-flex-align: center;            align-items: center;            z-index: 3        }        .vplayer .no-wifi p {            line-height: 1.5rem;            margin: 0 auto;            width: 60%;            color: #fff;            font-size: 1rem;            text-align: center        }        .vplayer .no-wifi p span {            font-size: .875rem        }        .vplayer .no-wifi div {            -webkit-box-flex: 1;            -ms-flex-positive: 1;            flex-grow: 1;            margin-top: 1rem        }        .vplayer .no-wifi div a {            color: #fff;            background: #ff5a05;            padding: .3rem .5rem        }        .vplayer .no-wifi div a:last-child {            margin-left: 1rem        }        .vplayer .buy {            position: absolute;            z-index: 4;            top: 0;            left: 0;            width: 100%;            height: 100%;            color: #fff;            display: -webkit-box;            display: -ms-flexbox;            display: flex;            -webkit-box-orient: vertical;            -webkit-box-direction: normal;            -ms-flex-direction: column;            flex-direction: column;            -webkit-box-pack: center;            -ms-flex-pack: center;            justify-content: center;            -webkit-box-align: center;            -ms-flex-align: center;            align-items: center;            background: #000        }        .vplayer .buy p {            text-align: center        }        .vplayer .buy p span {            color: #ff5a05        }        .vplayer .buy .btn {            margin-top: 1rem;            color: #fff;            background: #ff5a05;            padding: .3rem 1.5rem        }        .android .dplayer .dplayer-controller .dplayer-icons .dplayer-full,        .dplayer-setting-item.dplayer-setting-loop {            display: none        }</style><style type="text/css">        .MathJax_Display {            overflow: auto        }        .poster {            position: fixed;            left: -10000px;            top: -10000px;            overflow: hidden;            padding: 1rem;            background: #ececec        }        .richcontent-pre-copy {            font-size: 13px;            color: #888;            position: absolute;            right: 1em;            top: .2em;            cursor: pointer;            -webkit-user-select: none;            -moz-user-select: none;            -ms-user-select: none;            user-select: none        }        .richcontent-pre-copy .iconfont {            font-size: 12px;            margin-right: .2em        }</style><style type="text/css">        .bottom {            width: 100%;            background-color: #f5f5f5;            position: fixed;            bottom: 0;            left: 0;            z-index: 10        }        .bottom,        .bottom .bottom-wrapper {            height: 67px;            display: -webkit-box;            display: -ms-flexbox;            display: flex;            -webkit-box-orient: horizontal;            -webkit-box-direction: normal;            -ms-flex-direction: row;            flex-direction: row        }        .bottom .bottom-wrapper {            -webkit-box-flex: 1;            -ms-flex-positive: 1;            flex-grow: 1;            padding-left: 20px;            padding-right: 20px;            -webkit-box-align: center;            -ms-flex-align: center;            align-items: center;            -webkit-box-pack: justify;            -ms-flex-pack: justify;            justify-content: space-between        }        .bottom .bottom-wrapper a {            height: 48px;            line-height: 51px;            -webkit-box-sizing: border-box;            box-sizing: border-box        }</style><style type="text/css">        .breadcrumb {            padding: 30px 0;            display: -webkit-box;            display: -ms-flexbox;            display: flex;            -webkit-box-orient: horizontal;            -webkit-box-direction: normal;            -ms-flex-direction: row;            flex-direction: row;            -webkit-box-align: center;            -ms-flex-align: center;            align-items: center;            -ms-flex-wrap: wrap;            flex-wrap: wrap;            background: #fff        }        .breadcrumb a.title {            color: #e57c39;            font-size: 15px;            font-weight: 400        }        .breadcrumb span.title {            color: #888;            font-size: 15px;            font-weight: 400        }        .breadcrumb .split {            color: #ccc;            font-size: 10px;            margin-right: 5px        }</style><style type="text/css">        .course-detail[data-v-4e11b9bf] {            max-width: 46.25rem;            margin: 0 auto;            background: #f5f5f5        }        .course-detail .course-main[data-v-4e11b9bf] {            background-color: #fff;            width: 100%;            z-index: 10;            top: 0;            left: 0        }        .course-detail .course-info[data-v-4e11b9bf] {            background: #fff;            cursor: pointer        }        .course-detail .course-info .course-info-top[data-v-4e11b9bf] {            padding: 1rem 0 .4rem .78125rem;            display: -webkit-box;            display: -ms-flexbox;            display: flex;            -webkit-box-pack: justify;            -ms-flex-pack: justify;            justify-content: space-between;            -webkit-box-align: center;            -ms-flex-align: center;            align-items: center        }        .course-detail .course-info .course-info-top h1[data-v-4e11b9bf] {            font-size: 1.03125rem;            font-weight: 400;            text-align: justify-content        }        .course-detail .course-info .course-info-top i[data-v-4e11b9bf] {            font-weight: 400;            width: 40px;            padding-right: .78125rem;            -ms-flex-negative: 0;            flex-shrink: 0;            text-align: right;            color: #dadada        }        .course-detail .course-info .course-info-bottom[data-v-4e11b9bf] {            padding: 0 54px .5rem .78125rem;            border-bottom: 1px solid #e8e8e8;            color: #888;            font-size: .78125rem        }        .course-detail .course-info .course-info-bottom .icon-course-play[data-v-4e11b9bf] {            color: #d9d9d9;            font-size: .75rem        }        .course-detail .video-list[data-v-4e11b9bf] {            background: #fff;            width: 100%;            overflow: hidden;            overflow: auto;            -webkit-overflow-scrolling: touch        }        .course-detail .video-list ul[data-v-4e11b9bf] {            display: -webkit-box;            display: -ms-flexbox;            display: flex;            -webkit-box-orient: horizontal;            -webkit-box-direction: normal;            -ms-flex-direction: row;            flex-direction: row;            padding: .875rem 0        }        .course-detail .video-list ul li[data-v-4e11b9bf] {            margin-left: .71875rem;            position: relative;            border: 1px solid #e8e8e8;            border-radius: 3px;            display: -webkit-box;            display: -ms-flexbox;            display: flex;            height: 4.0625rem;            overflow: hidden;            -webkit-box-pack: center;            -ms-flex-pack: center;            justify-content: center;            -webkit-box-align: center;            -ms-flex-align: center;            align-items: center;            font-size: .78125rem;            -ms-flex-negative: 0;            flex-shrink: 0;            line-height: 1rem;            -webkit-transition: border .5s ease;            transition: border .5s ease        }        .course-detail .video-list ul li img[data-v-4e11b9bf] {            width: 1.78125rem;            height: .84375rem;            position: absolute;            top: 0;            left: 0        }        .course-detail .video-list ul li a[data-v-4e11b9bf] {            -webkit-transition: color .5s ease;            transition: color .5s ease;            padding: 0 .5rem        }        .course-detail .video-list ul li a[data-v-4e11b9bf]:link,        .course-detail .video-list ul li a[data-v-4e11b9bf]:visited {            color: #353535        }        .course-detail .video-list ul li.on[data-v-4e11b9bf] {            border-color: #ff5a05        }        .course-detail .video-list ul li.on a[data-v-4e11b9bf]:link,        .course-detail .video-list ul li.on a[data-v-4e11b9bf]:visited {            color: #ff5a05        }        .article-title[data-v-4e11b9bf] {            color: #353535;            font-weight: 400;            line-height: 1.65rem;            font-size: 1.34375rem        }        .article-info[data-v-4e11b9bf] {            color: #888;            font-size: .9375rem;            margin-top: 1.0625rem        }        .article-content[data-v-4e11b9bf] {            margin-top: 1.0625rem        }        .audio-player[data-v-4e11b9bf] {            width: 100%;            margin: 20px 0        }        .content-box[data-v-4e11b9bf] {            padding: 1px 1.3125rem;            background-color: #fff;            margin-top: .46875rem        }        .to-comment[data-v-4e11b9bf] {            overflow: hidden;            padding-top: 20px;            margin: 0 1.3125rem -10px        }        .to-comment a.button-primary[data-v-4e11b9bf] {            float: right;            height: 20px;            font-size: 12px;            line-height: 20px;            padding: 4px 8px;            cursor: pointer        }        .extra[data-v-4e11b9bf] {            margin-top: .46875rem;            margin-bottom: 67px;            background: #fff;            position: relative        }        .extra .video-comment-box[data-v-4e11b9bf] {            position: absolute;            width: 100%;            top: 0;            left: 0;            z-index: 3;            -webkit-box-sizing: border-box;            box-sizing: border-box;            background: #fff;            padding-left: 1rem;            padding-right: 1rem;            padding-top: .5rem        }        .extra .video-comment-box h3[data-v-4e11b9bf] {            color: #353535;            font-size: .875rem;            line-height: 2rem;            font-weight: 400        }        .extra .comments[data-v-4e11b9bf] {            margin: 0 1.3125rem;            padding-bottom: 50px        }        .extra .comments h2[data-v-4e11b9bf] {            text-align: center;            color: #888;            position: relative;            z-index: 1;            margin-bottom: 14px        }        .extra .comments h2[data-v-4e11b9bf]:before {            border-top: 1px dotted #e8e8e8;            content: "";            position: absolute;            top: 50%;            left: 0;            width: 100%;            z-index: -1        }        .extra .comments h2 span[data-v-4e11b9bf] {            font-size: 15.25px;            font-weight: 400;            padding: 16px 1rem;            background: #fff;            display: inline-block        }        .extra .comments .no-comment[data-v-4e11b9bf] {            text-align: center        }        .extra .comments .no-comment i.icon-cat[data-v-4e11b9bf] {            color: #f5f5f5;            font-size: 100px;            line-height: 1.2;            margin-right: 12px        }        .extra .comments .no-comment .no-comment-text[data-v-4e11b9bf] {            color: #e8e8e8;            font-size: 12.5px;            line-height: 1.6        }        .bottom[data-v-4e11b9bf] {            position: fixed;            bottom: 0;            left: 0;            width: 100%;            height: 67px;            background: #fff;            background-color: #f5f5f5;            z-index: 10        }        .bottom .buy-join[data-v-4e11b9bf],        .bottom[data-v-4e11b9bf] {            display: -webkit-box;            display: -ms-flexbox;            display: flex;            -webkit-box-pack: center;            -ms-flex-pack: center;            justify-content: center        }        .bottom .buy-join[data-v-4e11b9bf] {            -webkit-box-orient: horizontal;            -webkit-box-direction: normal;            -ms-flex-direction: row;            flex-direction: row;            -webkit-box-align: center;            -ms-flex-align: center;            align-items: center;            height: 48px;            line-height: 48px        }        .bottom .buy-join span[data-v-4e11b9bf] {            line-height: 48px;            margin-left: 5px;            color: hsla(0, 0%, 100%, .5);            font-size: 11px;            text-decoration: line-through        }        .bottom .button-cancel[data-v-4e11b9bf] {            height: 51px;            line-height: 51px        }        .bottom-control[data-v-4e11b9bf],        .bottom-sub[data-v-4e11b9bf] {            width: 100%;            -webkit-box-orient: horizontal;            -ms-flex-direction: row;            flex-direction: row;            -ms-flex-pack: distribute;            justify-content: space-around;            -webkit-box-sizing: border-box;            box-sizing: border-box;            padding: 0 1.3125rem        }        .bottom-control .item[data-v-4e11b9bf],        .bottom-control[data-v-4e11b9bf],        .bottom-sub .item[data-v-4e11b9bf],        .bottom-sub[data-v-4e11b9bf] {            display: -webkit-box;            display: -ms-flexbox;            display: flex;            -webkit-box-align: center;            -ms-flex-align: center;            align-items: center;            -webkit-box-direction: normal        }        .bottom-control .item[data-v-4e11b9bf],        .bottom-sub .item[data-v-4e11b9bf] {            -webkit-box-flex: 1;            -ms-flex-positive: 1;            flex-grow: 1;            -webkit-box-orient: vertical;            -ms-flex-direction: column;            flex-direction: column;            -webkit-box-pack: center;            -ms-flex-pack: center;            justify-content: center;            cursor: pointer        }        .bottom-control .item i[data-v-4e11b9bf],        .bottom-sub .item i[data-v-4e11b9bf] {            color: #353535;            font-size: 1.125rem;            line-height: 1.5rem        }        .bottom-control .item span[data-v-4e11b9bf],        .bottom-sub .item span[data-v-4e11b9bf] {            color: #888;            font-size: 11px        }        .button-subscribe[data-v-4e11b9bf] {            -webkit-box-flex: 1;            -ms-flex: 1;            flex: 1;            height: 69px;            color: #fff;            font-size: 15.25px;            text-align: center;            background-color: #ff5a05;            line-height: 69px;            border-radius: 5px        }        .article-sub-bottom[data-v-4e11b9bf] {            z-index: 2        }        @media only screen and (device-width:375px) and (device-height:812px) and (-webkit-device-pixel-ratio:3) {            .bottom[data-v-4e11b9bf],            .comments[data-v-4e11b9bf] {                padding-bottom: 34px            }        }        @media (max-width:769px) {            .course-detail .breadcrumb[data-v-4e11b9bf] {                padding: 10px            }        }        @media screen and (min-width:768px) {            .extra .comments[data-v-4e11b9bf],            .to-comment[data-v-4e11b9bf] {                margin: 0 0 -10px            }        }</style><style type="text/css">        .mobile-tips {            width: 100%;            height: 51px;            background: rgba(0, 0, 0, .8);            position: fixed;            top: 0;            left: 0;            z-index: 20;            display: -webkit-box;            display: -ms-flexbox;            display: flex;            -webkit-box-orient: horizontal;            -webkit-box-direction: normal;            -ms-flex-direction: row;            flex-direction: row;            -webkit-box-align: center;            -ms-flex-align: center;            align-items: center;            -webkit-box-pack: justify;            -ms-flex-pack: justify;            justify-content: space-between;            -webkit-box-sizing: border-box;            box-sizing: border-box;            padding: 0 12px;            -webkit-transition: opacity .35s;            transition: opacity .35s;            opacity: 0;            pointer-events: none        }        .mobile-tips.istop {            opacity: 1;            pointer-events: auto        }        .mobile-tips .mobile-tips-info {            display: -webkit-box;            display: -ms-flexbox;            display: flex;            -webkit-box-orient: horizontal;            -webkit-box-direction: normal;            -ms-flex-direction: row;            flex-direction: row;            -webkit-box-align: center;            -ms-flex-align: center;            align-items: center;            -webkit-box-pack: start;            -ms-flex-pack: start;            justify-content: flex-start        }        .mobile-tips .mobile-tips-info i {            width: 36px;            height: 36px;            background-image: url(data:image/png;base64,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);            background-position: 0 0;            background-repeat: no-repeat;            background-size: contain;            border-radius: 7px        }        .mobile-tips .mobile-tips-info h2 {            font-size: 15px;            color: #fff;            font-weight: 400;            margin-left: 6px        }        .mobile-tips .mobile-tips-info h2 span {            font-size: 11px        }        .mobile-tips a {            width: 72px;            height: 31px;            text-align: center;            border: 1px solid #ff5a05;            border-radius: 3px;            font-size: 13px;            color: #ff5a05;            line-height: 31px        }</style><style type="text/css">        .comment-item {            list-style-position: inside;            width: 100%;            display: -webkit-box;            display: -ms-flexbox;            display: flex;            -webkit-box-orient: horizontal;            -webkit-box-direction: normal;            -ms-flex-direction: row;            flex-direction: row;            margin-bottom: 1rem        }        .comment-item a {            border-bottom: none        }        .comment-item .avatar {            width: 2.625rem;            height: 2.625rem;            -ms-flex-negative: 0;            flex-shrink: 0;            border-radius: 50%        }        .comment-item .info {            margin-left: .5rem;            -webkit-box-flex: 1;            -ms-flex-positive: 1;            flex-grow: 1        }        .comment-item .info .hd {            width: 100%;            display: -webkit-box;            display: -ms-flexbox;            display: flex;            -webkit-box-orient: horizontal;            -webkit-box-direction: normal;            -ms-flex-direction: row;            flex-direction: row;            -webkit-box-pack: justify;            -ms-flex-pack: justify;            justify-content: space-between;            -webkit-box-align: center;            -ms-flex-align: center;            align-items: center        }        .comment-item .info .hd .username {            color: #888;            font-size: 15.25px;            font-weight: 400;            line-height: 1.2        }        .comment-item .info .hd .control {            display: -webkit-box;            display: -ms-flexbox;            display: flex;            -webkit-box-orient: horizontal;            -webkit-box-direction: normal;            -ms-flex-direction: row;            flex-direction: row;            -webkit-box-align: center;            -ms-flex-align: center;            align-items: center        }        .comment-item .info .hd .control .btn-share {            color: #888;            font-size: .75rem;            margin-right: 1rem        }        .comment-item .info .hd .control .btn-praise {            display: -webkit-box;            display: -ms-flexbox;            display: flex;            -webkit-box-orient: horizontal;            -webkit-box-direction: normal;            -ms-flex-direction: row;            flex-direction: row;            -webkit-box-align: center;            -ms-flex-align: center;            align-items: center;            font-size: 15.25px;            text-decoration: none        }        .comment-item .info .hd .control .btn-praise i {            color: #888;            display: inline-block;            font-size: .75rem;            margin-right: .3rem;            margin-top: -.01rem        }        .comment-item .info .hd .control .btn-praise i.on,        .comment-item .info .hd .control .btn-praise span {            color: #ff5a05        }        .comment-item .info .bd {            color: #353535;            font-size: 15.25px;            font-weight: 400;            white-space: normal;            word-break: break-all;            line-height: 1.6        }        .comment-item .info .time {            color: #888;            font-size: 9px;            line-height: 1        }        .comment-item .info .reply .reply-hd {            font-size: 15.25px        }        .comment-item .info .reply .reply-hd span {            margin-left: -12px;            color: #888;            font-weight: 400        }        .comment-item .info .reply .reply-hd i {            color: #ff5a05;            font-size: 15.25px        }        .comment-item .info .reply .reply-content {            color: #353535;            font-size: 15.25px;            font-weight: 400;            white-space: normal;            word-break: break-all        }        .comment-item .info .reply .reply-time {            color: #888;            font-size: 9px        }</style></head><body style=""><div id="app"><div data-v-4e11b9bf="" class="course-detail"><div class="breadcrumb breadcrumb"><span><a href="#" class="title router-link-active">讲堂</a><span class="split iconfont"></span></span><span><span class="title">10 |	基本概念：节点、集群、分片及副本</span></span></div><div data-v-4e11b9bf="" class="course-main main" style="position: relative;"><div data-v-4e11b9bf="" class="vplayer" id ="DplayerCont" style="height: 416.25px;"><h2 class="title">                        10 |	基本概念：节点、集群、分片及副本</h2></div></div><div data-v-4e11b9bf="" class="course-info" style="margin-top: 0px;"><div data-v-4e11b9bf="" class="course-info-top"><h1 data-v-4e11b9bf="" class="course-title"></h1><i data-v-4e11b9bf="" class="iconfont"></i></div></div><div data-v-4e11b9bf=""><div data-v-4e11b9bf="" class="content-box"><div data-v-4e11b9bf="" id="article-content" class="typo common-content"><div class="text">                            <p><a href="https://github.com/geektime-geekbang/geektime-ELK/tree/master/part-1/3.2-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B52%E8%8A%82%E7%82%B9%2C%E9%9B%86%E7%BE%A4%2C%E5%88%86%E7%89%87%E5%8F%8A%E5%89%AF%E6%9C%AC">课程Demo</a></p><h1>相关阅读</h1><ul>
<li>CAT Nodes API <a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.1/cat-nodes.html">https://www.elastic.co/guide/en/elasticsearch/reference/7.1/cat-nodes.html</a></li>
<li>Cluster API <a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.1/cluster.html">https://www.elastic.co/guide/en/elasticsearch/reference/7.1/cluster.html</a></li>
<li>CAT Shards API <a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.1/cat-shards.html">https://www.elastic.co/guide/en/elasticsearch/reference/7.1/cat-shards.html</a></li>
</ul><h1>课件地址</h1><p><a href="https://github.com/geektime-geekbang/geektime-ELK/blob/master/part-1/%E5%88%9D%E8%AF%86Elasticsearch.pdf">初识Elasticsearch</a></p><!-- [[[read_end]]] --></div></div></div></div><div data-v-4e11b9bf="" class="extra" style="margin-bottom: 1rem;"><div data-v-4e11b9bf="" class="comments"><h2 data-v-4e11b9bf=""><span data-v-4e11b9bf="">精选留言</span></h2><ul>                        <li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/15/54/7b/6b207dc7.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Geek_e94f9e</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>27</span></a></div>
	</div>
	<div class="bd">老师您好。请教个问题。我们的ES集群的一个索引有二十多亿个文档，大概有两三个T，有40个分片，查询非常慢，平均要几秒。有什么办法做优化吗？如果每个分片约存30G，那分片数量又会变多，似乎也会影响查询性能。所以，请教一下老师，面对这种文档数量比较大的索引，如果优化，减少查询时间。谢谢。</div> <span class="time">2019-06-27</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKg3ia2DDFuGLZRtHw6to43icxKyia1eHbxTUh1CY1dSuTp5WmQN01A1aLAia1lkaR8EAkXD4h76n8Bog/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Hxd</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>9</span></a></div>
	</div>
	<div class="bd">docker镜像没有下载成功的同学可以直接在本地做demo<br>cerebro在GitHub上下载非常慢，我把它下载下来放到网盘了，大家可以解压到本机做测试：<br>链接:https://pan.baidu.com/s/1xFXSKUTeuMjUiW-1fJ_HTw  密码:iaxx</div> <span class="time">2019-07-08</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/18/3e/06/53b2468a.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">xiao</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>4</span></a></div>
	</div>
	<div class="bd">请问在生产环境，一台主机能运行多个节点么？通过增加节点是否提高es效率</div> <span class="time">2019-07-06</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">生产环境，建议一台vm或者一台bm一个ES inatance</p> <p class="reply-time">2019-07-07</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/15/5f/b2/c4780c10.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">曹伟雄</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>4</span></a></div>
	</div>
	<div class="bd">老师你好，正准备搭建ES集群（3台）做为分布式系统的日志监控平台，能否给一些注意事项或建议? 比如: 服务器的磁盘，内存多少合适?  分片，副本多少合适? 还有其它...谢谢</div> <span class="time">2019-06-26</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">你这个问题，相信听完第三部分后，就会自己给出答案。<br><br>首先，我并不知道你的性能需求，例如多少数据量，多大的写入，是写为主还是查询为主，等等，只能给非常笼统的推荐<br><br>磁盘，推荐 SSD，JVM最大Xmx 不要超过30G。副本分片至少设置为1。 主分片，单个存储不要超过 30 GB（按照这个你推算出分片数，进行设定）</p> <p class="reply-time">2019-06-26</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/c5/51/958e5300.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">┍ 赱私貨灬</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>3</span></a></div>
	</div>
	<div class="bd">老师，我根据之前的课程，把movies数据集导入到了elasticsearch中。<br>然后我在kibana中的索引管理中看到moveis的health为yellow，并且通过 http://localhost:9200/_cluster/health查看，status显示的也是yellow,请问需要做什么调整可以把yellow改为green呢？</div> <span class="time">2019-06-29</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">黄的状态 代表你的副本分片没有分配。一个办法是，先设置index的settings，将副本设置成0。一个办法可以通过增加一个节点使得分片能够分配。<br><br>你有观察和思考的好习惯，👍</p> <p class="reply-time">2019-06-30</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/18/4b/ea/a9e7bc50.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">℡人见人爱浩然君゜</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>1</span></a></div>
	</div>
	<div class="bd">老师你好：<br>     请问怎么才能知道一个请求后面可以跟什么参数呢？比如以下：<br>     GET _cluster/health?level=shards （这个level=shards）<br>     GET /_cat/nodes?v&h=id,ip,port,v,m（这个h=id）<br>     ES有没有一个help接口的api呢？可以查阅所有接口和参数的说明。</div> <span class="time">2019-10-17</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">在kibana的dev console里，写一个api，mac下按下cmd➕/ 会跳到相应的api</p> <p class="reply-time">2019-10-23</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/16/f2/97/94fcd159.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Wendell</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>1</span></a></div>
	</div>
	<div class="bd">老师您好，我现在有一个六节点的集群，角色配置是data=true,master=true。（索引分片分配方式为：六个分片或四个分片）在线上使用过程中发现（正常使用几周后发现的），集群的负载不均衡，有两个节点的DISK使用量接近98%，其它节点磁盘还有较多剩余。集群看到的现象是磁盘爆满的这两个节点的分片都处于未分配的状态【"details": "failed to create shard, failure IOException[No space left on device]"】。之后在集群上新建6个分片的索引的时候，甚至有些索引的分片全在一个节点上。<br>问题一：集群在数据写入过程中为什么会有分片数据不自动均衡分配的现象？<br>问题二：设置每个索引在一个节点的最大分片数量是否会解决这个问题？<br>问题三：已经分配失败的分片，如何快速恢复呢？</div> <span class="time">2019-07-29</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">1.集群中磁盘快满的时候，你再增加机器，确实可能导致新建的索引全部分配到新节点上去的可能性。最终导致数据分配不均。所以要记得监控集群，到70%就需要考虑删除数据或是增加节点<br><br>2.可以设置最大分片书缓解这个问题。<br><br>3.分片的尺寸如果过大，确实也没有快速恢复的办法，所以尽量保证分片的size在40G以下</p> <p class="reply-time">2019-08-04</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">SuperSnow</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>1</span></a></div>
	</div>
	<div class="bd">一个主分片是一个运行的Lucene的实例，是不是也可以理解为是一个运行的elasticsearch实例，毕竟一个节点只有一个主分片。</div> <span class="time">2019-07-09</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">在第二部分会有深入的讲解。<br><br>一个node对应一个es instance<br>一个node可以有多个index<br>一个index可以有多个shard<br>一个shard是一个lucene index（这个index是lucene自己的概念、和es的index不是一回事）</p> <p class="reply-time">2019-07-09</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/18/1c/59/596b2419.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Coisini</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>1</span></a></div>
	</div>
	<div class="bd">老师 进入 cerebro 连接elasticsearch失败 会不会是因为http://elasticsearch:9200 中识别不了elasticsearch这个主机名呀 </div> <span class="time">2019-07-01</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">docker内访问，使用的就是这个内部网络。你访问localhost：9200可以吗？</p> <p class="reply-time">2019-07-02</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/mG8pYHVExw91oF4kB43rlRFbr3ZTCUaFnk4Plfq8ysQaibDvsCDCJ9RGrGFT7uTXia9h9mvGsmYmb9rFu0O0C0og/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">杨松</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">还想请教老师和同学个问题，我用的es是7.3.1版本，用docker安装的，我看了配置文件elasticsearch.yml里面也没有默认的端口号9200，这个默认的端口号必须要我在启动的时候在命令行上指定 -p 9200:9200 -p 9300:9300才行吗？还是这个版本的默认端口号设置在其他地方了？</div> <span class="time">2019-10-06</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/mG8pYHVExw91oF4kB43rlRFbr3ZTCUaFnk4Plfq8ysQaibDvsCDCJ9RGrGFT7uTXia9h9mvGsmYmb9rFu0O0C0og/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">杨松</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">请教下  -E 参选  这个的具体用法在哪有解释？这个是elasticsearch特有的还是linux的其他服务也可以带这个-E参数？</div> <span class="time">2019-10-06</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">是ES自己带的。默认会到elasticsearch.yml中读取，通过-E 会overwrite掉yml中的配置</p> <p class="reply-time">2019-10-07</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/18/3b/d9/0c7b11f6.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Ocean</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，您好！如果通过REST API来操作es集群，我应该将请求发送到哪一个节点？将所有的请求都发送到同一个节点会不会有压力。</div> <span class="time">2019-09-26</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/2e/e1/f32ec1ea.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">秦风</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师可以讲下基于文档key-values 报警的elasalert 工具的使用吗？</div> <span class="time">2019-09-20</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">godtrue</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，请教三个问题<br>1：ES集群选主的原理是什么?<br>2：添加一个文档，怎么定位对应的分片?<br>3：集群中的某个节点挂了，故障转移是怎么实现的?</div> <span class="time">2019-09-18</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLqDHFficypYolzgcHRGnFt3YEt68TWmc6GTJl2RMckyIicibictXrLfIVOyMJC0mbdo3Hzr5ibibpEYViaQ/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Geek_0168a2</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，我们在使用es 做查询，经常会遇到Es 在GC时查询超过4000ms，这种性能抖动 怎么优化</div> <span class="time">2019-09-16</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/19/22/ef/d081613a.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">拾光</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">分片数设置过大，会影响搜索结果的相关性打分，影响统计结果的准确性。这个该怎么理解？</div> <span class="time">2019-09-10</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">因为idf 是基于分片上的数据进行计算的，并不是基于所有分片计算。所以数据量少，容易出现不准的情况</p> <p class="reply-time">2019-09-10</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/4f/10/c276c714.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">luke</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师你好，我使用的是您编写的docker-compose启动的集群，集群中有两个节点，stop 节点1之后，集群直接挂掉了，kibana也一直在链接es7_01，没有发生重新选举是为什么呢？</div> <span class="time">2019-08-28</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/18/46/ad/bc7626c4.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">党玚</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，客户端对es中数据的增删改查是针对主分片进行操作吗，之前说的es副本分片可以提高读的吞吐率？如何理解。</div> <span class="time">2019-08-06</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">增删改属于写操作，增加副本只可能降低写入速度。但是会提高数据安全性。<br><br><br>从写的角度看，会把请求分发到不同的副本，只要这些副本在不同的机器，机器的资源又足够多，那就实现了水平的扩展，可以提高读取的并发性</p> <p class="reply-time">2019-08-07</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/18/41/ce/f2fd3de4.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">biubiubiuuu</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师你好，我在停止了一个节点之后，查询集群健康状况返回<br>{<br>  "statusCode": 401,<br>  "error": "Unauthorized",<br>  "message": "Unauthorized"<br>}<br></div> <span class="time">2019-08-04</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">你启动了security插件么？<br></p> <p class="reply-time">2019-08-05</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/2MySaib7VcvH3jpXcJj2Sic0N9PaBibNhqNABNZUqhiaYHRR4ibPUm2LJCcEbR8iaW5TS1xKOTgZaFVRQbV2BpwQARJg/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">ZRRJDD</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">你好，老师。我通过 bin/elasticsearch -E node.name=node0 -E cluster.name=geektime -E path.data=node0_data 这种方式，在本地一台机器上启动了三个节点。 当我关闭一个节点的时候，整个集群都不可用了。请问这是怎么回事？<br>127.0.0.1 34 100 8 2.63   dim - node1<br>127.0.0.1 34 100 8 2.63   dim - node0<br>127.0.0.1 30 100 8 2.63   dim * node2</div> <span class="time">2019-08-03</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">应该是不会的。是不是你关的是9200端口那个节点？你试验着访问下9201端口？</p> <p class="reply-time">2019-08-04</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/da/bb/a20f37b2.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">湘江鸿</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，我启动了2个es节点，node1和node2，配置里设置cluster.initial_master_nodes: ["node1", "node2"]；集群启动后，master节点是node1，我把node1进程杀死，整个集群就不可用了，为啥呢？</div> <span class="time">2019-07-28</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">杀死node1之前，通过_cat/nodes可以看到node2吗？</p> <p class="reply-time">2019-07-29</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/18/5e/65/f9027c76.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">⌚Heavent.</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">请问一下，每个集群都会有一个master节点吗？还是所有集群只有一个master节点？</div> <span class="time">2019-07-27</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">一个集群可以配置一到多个master节点。具体的后面章节会有详细讲解的</p> <p class="reply-time">2019-07-27</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/0c/61/dff3acb5.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">红发-；</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd"><br>感谢老师解答，但是还有有个疑问，创建多个Index，每个Index都对应一个Lucene Index；每个 Lucene Index 都需要消耗一些磁盘，内存和文件描述符；岂不是更消耗资源了，这样看es岂不是用时间来换资源的做法？</div> <span class="time">2019-07-27</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">后续的深入分片原理，会有相关的一些深入讲解</p> <p class="reply-time">2019-07-27</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/0c/61/dff3acb5.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">红发-；</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师您好，请教个问题，7.0之后废除了type，例如：<br>5.0时，beijing、shanghai这两个地点，是在index下建立2个type，或是添加一个字段area来处理。<br>那么在7.0的时候是创建多个index么？</div> <span class="time">2019-07-26</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">原来多type的，现在就对应多个index来处理<br></p> <p class="reply-time">2019-07-26</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/14/55/08/d422d547.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">imddon</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">docke-compose up 在安装kibana的时候好慢呀，都过去不，各位哥有什么办法嘛？帮帮小弟</div> <span class="time">2019-07-24</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">你查一下，好像有同学在评论区提供了镜像</p> <p class="reply-time">2019-07-26</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="" class="avatar">
<div class="info">
	<div class="hd"><span class="username">donkey-chen</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，我运维的集群角色都是分开部署的。<br>我想问一下 开发连接ES的时候，连接那个角色？  Master node  、ingest node  、data node、coordina ting  这四个中具体那个？</div> <span class="time">2019-07-21</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">这个需要你在前段配置相应的loader balancer。<br><br>把读分发到coording node<br>写分发到 ingest node。 <br><br>如果你的集群负载不高，你可以配置一些节点同时具备coording和ingest的能力。然后将读写全部路由到这些节点。不仅配置简单，还节约硬件成本<br></p> <p class="reply-time">2019-07-22</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/ed/d2/e3ae7ddd.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">三木禾</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，每个shard包含的是一种索引文档数据，还是有多种索引的文档数据?</div> <span class="time">2019-07-19</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">一个shard就是一个lucene的index 后续有讲解<br></p> <p class="reply-time">2019-07-20</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/4d/54/9c214885.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">kylexy_0817</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，为什么我把集群中es7_02这个节点下线了，即docker stop后，cerebro就访问不到es了？</div> <span class="time">2019-07-16</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/40/5e/b8fada94.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Ryoma</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">停了 es7_02 节点后，集群的状态还是 green，这是什么问题</div> <span class="time">2019-07-14</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">你需要写入一些数据到index，同时将这个index的replica设置成1。然后你关闭一个节点后，集群会因为无法分配relica变成黄色</p> <p class="reply-time">2019-07-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="" class="avatar">
<div class="info">
	<div class="hd"><span class="username">王嘉伟</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师你好，我在本地用docker起了多节点的es，往里面导数据的时候会有一半的shard是unassigned<br>marketplace.products.punk             4 p STARTED                  master<br>marketplace.products.punk             4 r UNASSIGNED INDEX_CREATED <br>marketplace.products.punk             2 p STARTED                  master<br>marketplace.products.punk             2 r UNASSIGNED INDEX_CREATED <br>marketplace.products.punk             1 p STARTED                  slave<br>marketplace.products.punk             1 r UNASSIGNED INDEX_CREATED <br>marketplace.products.punk             3 p STARTED                  slave<br>marketplace.products.punk             3 r UNASSIGNED INDEX_CREATED <br>marketplace.products.punk             0 p STARTED                  master<br>marketplace.products.punk             0 r UNASSIGNED INDEX_CREATED <br>marketplace.onlinestore.shippingzones 4 p STARTED                  slave<br>marketplace.onlinestore.shippingzones 4 r UNASSIGNED INDEX_CREATED <br>marketplace.onlinestore.shippingzones 2 p STARTED                  slave<br>marketplace.onlinestore.shippingzones 2 r UNASSIGNED INDEX_CREATED <br>marketplace.onlinestore.shippingzones 1 p STARTED                  master<br>marketplace.onlinestore.shippingzones 1 r UNASSIGNED INDEX_CREATED <br>marketplace.onlinestore.shippingzones 3 p STARTED                  master<br>marketplace.onlinestore.shippingzones 3 r UNASSIGNED INDEX_CREATED <br>marketplace.onlinestore.shippingzones 0 p STARTED                  slave<br>marketplace.onlinestore.shippingzones 0 r UNASSIGNED INDEX_CREATED <br>这是cat shard的结果<br>在网上查了一些资料都没具体解释为啥会发生这种状况<br>能麻烦你帮忙解释一下吗</div> <span class="time">2019-07-12</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">会不会是docker的磁盘空间不够导致分片无法分配？尝试着多分配一些磁盘空间试试？</p> <p class="reply-time">2019-07-12</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/18/62/14/9712dd98.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">wangdexing</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">简单说下我的操作流程（操作系统windows）：<br>1.在 cmd控制台中 进入elasticsearch的bin目录下 运行一下命令(必须打开两个cmd窗口 一个窗口运行不了)<br>elasticsearch -E node.name=node1 -E cluster.name=geektime -E path.data=node1_data -d<br>elasticsearch -E node.name=node2 -E cluster.name=geektime -E path.data=node2_data -d<br>2、打开kibana的 配置文件 kibana.yml <br>修改elasyicsearch.hosts<br>elasticsearch.hosts: ["http://localhost:9200","http://localhost:9201"]<br>顺便汉化了一下<br>i18n.locale: "zh-CN"<br>然后运行 kibana.bat kibana在页面上把电商订单 航空公司等测试数据加进去<br>3、修改下logstash.conf<br>修改最后部分的输出的elastichosts<br>output {<br>   elasticsearch {<br>     hosts => ["http://localhost:9200","http://localhost:9201"]<br>还有删除上面的input的sincedb_path路径的文件(如果有的话),不删除数据导不进去<br>最后启动 logstash -f logstash.conf<br><br><br>不知道自己的操作过程是不是有问题 请老师帮忙看一下<br><br></div> <span class="time">2019-07-12</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">应该没有问题，数据导入了，就说明正确了</p> <p class="reply-time">2019-07-12</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/17/52/eb/eec719f3.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">开水</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，问一下貌似没讲ingest节点，ingest节点的作用主要是什么啊？</div> <span class="time">2019-07-12</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">会在第二部分讲。ingest节点可以运行一些pipeline的脚本，在数据写入之前做一些预处理</p> <p class="reply-time">2019-07-12</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/e0/0a/e683a198.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">SoberChina</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师您好，6.x会提示 type不建议用，7.x废除，当然这也是官方某种性能上的考虑，在上一节老师讲了一些基本概念，虽然拿着Index 对应 DB，Type 对应表，Document 对应记录来进行描述，但是type类比于表，7.x随之又将type删除。当然如果真的按照这么来设计的话，会出现一大堆的type。当然还是希望老师能从官方版本的升级 对废弃功能的影响来讲解一些东西，谢谢。</div> <span class="time">2019-07-09</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">1. 单个index下多个types，在7.x 已经是完全不支持了<br>2. Tpye在7.x只是deprecated，还没有完全移除，虽然在7.x目前已经出现了一些typeless的API，但是部分API中还是需要指定type的名称<br><br>你在7.x中执行查询，还是可以在返回信息中看到type的meta信息<br></p> <p class="reply-time">2019-07-09</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/14/e9/91/b2a811f3.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">资宏</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师你好，我用docker搭建了两个es节点，master节点停了后整个集群就挂了。未发生故障转移。是不是每个节点都需要把9200端口映射出来么？</div> <span class="time">2019-07-09</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">master节点需要设置多个，如果就一台master节点，如果出现故障，确实整个集群就不可用了<br></p> <p class="reply-time">2019-07-11</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/17/85/2a/9e32ed50.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">linupy</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，你好，请问认证考试的时候有版本要求吗？</div> <span class="time">2019-07-08</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">认证考试目前还是6.6的版本，不过应该也是会升级的吧<br></p> <p class="reply-time">2019-07-09</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/9c/b0/08d7700d.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">start</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，您好！ 咨询一个节点的问题：一组es机器里面设置了 Hot&Warm 的时候，怎么设定以时间为分割值，进行对冷热数据的区分？数据是否会自动的从Hot节点到Warm节点的转移？</div> <span class="time">2019-07-05</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">我们在后续的章节中会有讲解。es有提供index lifecycle management tool </p> <p class="reply-time">2019-07-05</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJZa7kzYIicRuNgcgbpOX8pv9akNcXFgS1zCcL3Coa7dUMdIBM5AqT0IicicmVIHhdGektnY0JWpxFXA/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">土柱</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">问题：老师，在Cerebro 中看到6个索引，出了三个sample 和 geektime，还有两个 .special(2) 的（.kibana_task_manager  和 .kibana1） 说明 Cerebro 也监控Kibana的实例了吗？ 这是在 kibana镜像中的吗？ <br><br>学习尝试：通过 docker start containerID 关闭掉的 ES 实例可以自动添加到集群中</div> <span class="time">2019-07-05</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">kibana连接es以后，会把相关的数据写入 .kibana开头的index当中。cerebor则会通过ES的_cat/indices获取所有的索引列表。</p> <p class="reply-time">2019-07-05</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/18/46/0f/1b827854.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">LONG</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师kibana支持中文了么？</div> <span class="time">2019-07-04</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">从6.8开始，界面支持中文</p> <p class="reply-time">2019-07-04</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/3XbCueYYVWTiclv8T5tFpwiblOxLphvSZxL4ujMdqVMibZnOiaFK2C5nKRGv407iaAsrI0CDICYVQJtiaITzkjfjbvrQ/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">有铭</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">请问这里为什么会有12个分片？从图上看明明只有8个分片啊</div> <span class="time">2019-07-04</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">哪里看到12个分片？</p> <p class="reply-time">2019-07-04</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/76/23/31e5e984.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">空知</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师 请教下<br>1、主 副分片咋同步数据的?<br>2、副分片 可以直接作为节点数据源读取的?如果可以 主从之间数据一致性问题咋解决?<br>3、正常情况下 节点数目 是否应该等于 主 副分片数和?</div> <span class="time">2019-07-04</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">请关注第二部分的内容。关于如何设置分片数，在第三部分会有讲解</p> <p class="reply-time">2019-07-05</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/52/c7/f9ad5669.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">时彬斌</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师您好，看您的例子里是两个实例，集群一般是需要三个实例起的吧，启动两个实例不会出现脑裂吗，选主出错问题</div> <span class="time">2019-07-04</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">一个节点也可以成为一个集群。关于脑裂，在第二部分有讲解</p> <p class="reply-time">2019-07-04</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/e8/dc/32e78f02.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">乐凡</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，我启动后kibana没有启动成功，而且elasticsearch的status显示red，cerebro也提示了red，请问这种状态如何解决呢<br></div> <span class="time">2019-07-03</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">如果是在docker中启动。可以尝试增加docker的cpu 内存和磁盘</p> <p class="reply-time">2019-07-04</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/e8/dc/32e78f02.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">乐凡</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，为什么我起了单个elasticsearch节点，kibana可以正常启动，当我起了多个节点时，kibana就报错了，这是怎么回事呢？？？？set xpack.reporting.encryptionKey in kibana.yml<br>  log   [15:30:51.369] [info][status][plugin:reporting@7.1.0] Status changed from uninitialized to green - Ready<br>  log   [15:30:51.441] [warning][maps] Error scheduling telemetry task, received [cluster_block_exception] blocked by: [FORBIDDEN/12/index read-only / allow delete (api)];<br>  log   [15:30:51.472] [warning][telemetry] Error scheduling task, received [cluster_block_exception] blocked by: [FORBIDDEN/12/index read-only / allow delete (api)];<br>  log   [15:30:51.506] [error][status][plugin:spaces@7.1.0] Status changed from yellow to red - Index .kibana belongs to a version of Kibana that cannot be automatically migrated. Reset it or use the X-Pack upgrade assistant.<br>  log   [15:30:51.508] [fatal][root] { Error: Index .kibana belongs to a version of Kibana that cannot be automatically migrated. Reset it or use the X-Pack upgrade assistant.<br>    at assertIsSupportedIndex (/home/yuwei/service/kibana-7.1.0/src/legacy/server/saved_objects/migrations/core/elastic_index.js:225:15)<br>    at Object.fetchInfo (/home/yuwei/service/kibana-7.1.0/src/legacy/server/saved_objects/migrations/core/elastic_index.js:46:12)<br>  isBoom: true,<br>  isServer: true,<br>  data: null,<br>  output:<br>   { statusCode: 500,<br>     payload:<br>      { statusCode: 500,<br>        error: 'Internal Server Error',<br>        message: 'An internal server error occurred' },<br>     headers: {} },<br>  reformat: [Function],<br>  [Symbol(SavedObjectsClientErrorCode)]: 'SavedObjectsClient/generalError' }<br><br> FATAL  Error: Index .kibana belongs to a version of Kibana that cannot be automatically migrated. Reset it or use the X-Pack upgrade assistant.<br>老师我第三次提问了你一次都没有回复我。。。。</div> <span class="time">2019-07-02</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">对不起！没能及时回复你的消息。问题比较多，有些还有一些重复。会有漏看。<br><br>从你的出错信息上看，有cluster_block_exception。这应该是你的目录文件的存储空间不足。<br><br>你可以尝试删除一些文件确保磁盘空间够用。如果你是在docker中启动，可以设置docker的磁盘空间大小。<br><br>希望能对你有所帮助。</p> <p class="reply-time">2019-07-04</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/18/1c/59/596b2419.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Coisini</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师 为什么es的主副分片在什么情况下会自动切换呢 ，我第打开cerebro后，过一会刷新 index的祝福分片情况就发生了变化</div> <span class="time">2019-07-02</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/14/4d/d1/68b641e4.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">61</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">主讲人，您好。<br>如果进行扩容时候，需要执行reindex ，集群会发生什么变化，在这个时候我们应该关注什么呢</div> <span class="time">2019-07-02</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">reindex 需要先创建index，设置正确的mapping，然后调用reindex API就可以了。唯一要注意的就是，你index改名了，程序也需要改，所以，可以考虑通过index alias 解决这个问题</p> <p class="reply-time">2019-07-02</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/18/1c/59/596b2419.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Coisini</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">localhost9200可以访问</div> <span class="time">2019-07-02</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Geek_ding</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">你好，老师，我在搭建环境时遇到一个问题，希望老师可以帮我看一下该怎么解决，谢谢。<br>访问9200是正常的，但是springbooot中无法连接到该节点，不知道是不是版本问题。elasticsearch版本是7.1.1，springboot版本是2.1.5.RELEASE，其中es异常信息是：<br>java.lang.IllegalStateException: Received message from unsupported version: [6.4.3] minimal compatible version is: [6.8.0]<br>springboot启动日志error：failed to load elasticsearch nodes : org.elasticsearch.client.transport.NoNodeAvailableException: None of the configured nodes are available<br>老师指点迷津</div> <span class="time">2019-07-01</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">我没有使用过 Spring 的 ES模块，从出错信息上看，使用的了9300的端口，也就是 Transport的 API。你需要去查看一下 是否正确的配置了 localhost 9300？<br><br>当然，版本的兼容性确实也有可能。Elastic 公司是推荐使用 Rest API on 9200 和 ES交互。 Trasport API （on 9300） 并不推荐使用，除非你去开发 ES 的plugin，因为Transport API的向后性兼容性做的并不是很友好。<br><br>找了一篇人家写的spring + ES 的文章，你可以看看。<br>https://dzone.com/articles/spring-boot-elasticsearch</p> <p class="reply-time">2019-07-01</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/67/72/bae0279a.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">惶惶不得终日</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">副本分成为主分片，如果有两个副本且数据不一致，为避免这种情况，是不是副本分片个数必须奇数？</div> <span class="time">2019-06-30</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">没有这个必要，数据分分布式读取和写入在后续会有所介绍</p> <p class="reply-time">2019-07-02</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/14/fd/81/1864f266.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">石将从</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，建议增加一些cerebro的资料，有些同学是新手，不懂啥叫cerebro</div> <span class="time">2019-06-30</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">嗯，后面有一节讲这个。不过关于如何安装，确实讲的不多。我可以在readme中做一个介绍。</p> <p class="reply-time">2019-06-30</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/67/72/bae0279a.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">惶惶不得终日</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">当主分片丢失，集群会选择一个副本分片成为主分片；<br>由于一致性问题，副本分片个数必须是奇数来投票，是这样的吧？</div> <span class="time">2019-06-30</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">第一个问题没错。主分片丢失，副本promote成主分片。<br>至于你说的投票，是指的master eligble 节点数么？</p> <p class="reply-time">2019-06-30</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/65/7b/66b9befd.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Hwan</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师你好，over-sahrding是啥意思呢？然后就是7.x开始，主分片数目默认为1，那会不会一旦数据量大了就得reindex了呢？</div> <span class="time">2019-06-30</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">overshard指的是过度的使用sharding。过分分片会带来一些问题。例如你数据量很少，用了多个分片。tf-idf算分会产生不准的情况。因为es会在每个分片上计算。而idf是一个全局的指标，数据量过少，算得肯定不对。<br><br>这些在后续课程中会有覆盖。简单说，数据量不大，例如几百万，用一个主分片就可以了。早期版本，默认使用5个显然是多多了</p> <p class="reply-time">2019-06-30</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/c5/51/958e5300.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">┍ 赱私貨灬</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">localhost:9000 为啥打不开呢</div> <span class="time">2019-06-29</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">默认端口9200<br></p> <p class="reply-time">2019-06-30</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/8c/9a/c342d114.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">AhaThinking</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">谢谢老师解答，还有2个问题:<br><br>1. 我们集群有两种节点，A: ingest+coordinate  B: data+ingest+coordinate  客户端配置了sniffer，我们期望 sniffer 能均摊请求到所有节点，到实际看绝大部分请求都发到了A类节点，不知道哪里的问题<br><br>2. 我们期望所有请求均摊到所有节点，不知道这种期望是否是最佳实践？还是说建议有 only coordinate 来集中处理客户端请求<br><br>多谢解答</div> <span class="time">2019-06-27</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">我在会后续的内容做一些关于部署的相关讲解。<br><br>简单的规则是：你可以创建一个 Read LB，请求（查询 get 的API）全部发送到ingest结单。创建for write的阶段，将写请求发送到ingest和 data节点。<br><br>注意不要将这些请求route到master节点和warm节点。</p> <p class="reply-time">2019-06-28</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/8c/9a/c342d114.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">AhaThinking</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">看到网上很多文章说的 client 节点通常指的是 ingest 节点还是 coordinate 节点？有点矛盾：<br><br>1. 从很多文章看 client 节点是 node.master 和 node.data 为 false，这样的配置判断看应该是 only ingest 节点<br>2. 从文章分析说 client 节点用来做负载均衡，路由请求，分发索引，处理搜索，这样判断听起来又像是 coordinate 节点<br><br>比较困扰，期待回复，多谢</div> <span class="time">2019-06-27</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">client 节点是老版本中的概念。 Ingest Node和Coordinate 节点是后来引入的节点类型。<br><br>简单说，Ingest用来说数据写入后的抽取和处理，Coordinate负责接受 Rest API，并分发到合适的节点。<br><br>你可以设置 dedicate的 Ingest Node 和 Coordinate node，也可以将节点设置成 Ingest Node + Coordinate Node，你可以可以把这样的节点叫Client 节点。</p> <p class="reply-time">2019-06-27</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTL5m7EKg270xsdpRy1MbO2DANuZI22FQavrmCW7F5gJDznHUacdxMGIhmoxjH1ge5AXoJ1PzmuUIA/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">GavinShang</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">主分片创建索引，一旦创建不能更改 每个分片大概30G，业务如果后期数据量大的话 ，如何平衡性能和每个分片的大小；</div> <span class="time">2019-06-27</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">在上线之前，你先需要评估你的数据流量，根据流量和数据大小确定好分片的数量。每个分片的尺寸不超过 30G，是一个 ES 官方给出的推荐大小。另外，你可以通过 Index Lifecycle Management tool 去管理 time based 的数据。可以将分片按照日期进行划分，并且设置数据 rentention policy，将老化的索引，分配到 warm 节点。</p> <p class="reply-time">2019-06-27</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/86/fa/4bcd7365.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">玉剑冰锋</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">请教老师几个问题(线上环境，每天20t日志，服务器32C，128G，每台服务器两个实例，每个实例32g,SparkStreaming做解析)<br>1.yellow状态和green状态对ES写入速度有没有影响<br>2.节点重启了，分配shards最后二三十个shard很慢才能分下去是不是正常的</div> <span class="time">2019-06-27</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/c1/bd/bb03817c.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">YXY</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">ingest node 和 coordinating node 具体是什么区别？</div> <span class="time">2019-06-27</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">在后续章节会对此详解解释。<br><br>1）Coordinating Node - 当节点接受到 REST API 请求的时候。节点就会承担 Coordiating Node 的角色，负责将请求分发到其他的节点。最终将结果汇总，返回 response<br><br>2）Ingest Node，可以用来承担一些数据管道的数据转换工作，例如，为你的文档增加一个新的字段，例如帮转换文档中的字段。Ingest node 和 pipleine 在第二部分有具体的介绍</p> <p class="reply-time">2019-06-27</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Geek_ding</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">我在elasticsearch7.1.1中使用了x-pack插件，但是不知道怎么在JavaAPI中设置用户名和密码</div> <span class="time">2019-06-27</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">请查阅相关的 API 文档，希望有所帮助。<br><br>https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/_basic_authentication.html<br></p> <p class="reply-time">2019-06-27</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/15/5f/b2/c4780c10.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">曹伟雄</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">感谢老师的回答，在请教个问题，受于资源限制，目前只有3台服务器可用，准备搭建轻量级集群（3个节点），这样的话，master和数据节点有必要分离吗？ 我查了至少7,8个以上才建议分离。如果现在不分离，以后增加机器后，好分离吗？ 谢谢</div> <span class="time">2019-06-27</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">现在可以先不用分离。日后再做分离并不麻烦。</p> <p class="reply-time">2019-06-27</p>
	</div>
</div>
</li></ul></div></div><div data-v-4e11b9bf=""></div></div></div><link href="https://cdn.bootcss.com/dplayer/1.25.0/DPlayer.min.css" rel="stylesheet"><script src="https://cdn.bootcss.com/hls.js/0.10.1/hls.min.js"></script><script src="https://cdn.bootcss.com/dplayer/1.25.0/DPlayer.min.js"></script><script>            const dp = new DPlayer({                container: document.getElementById('DplayerCont'),                video: {                    url: 'https://media001.geekbang.org/dd910b0247cd472cb8fa086998ee7f21/65ed1f2a17d644e5b7ae56e60cfecae7-40f9c38ab4fd42f7648f9d65db583cf5-hd.m3u8',                    type: 'hls'                }            });</script></body></html>