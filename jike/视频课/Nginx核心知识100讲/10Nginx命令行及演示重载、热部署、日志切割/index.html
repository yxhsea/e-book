<html class="cye-disabled cye-lm"><head><meta charset="utf-8"><meta name="Keywords" content="极客时间,极客邦,极客邦科技,极客邦控股,极客时间App,专栏订阅,极客新闻,二叉树,极客Live,QCon,左耳听风,AI技术内参,大航海时代,陈皓,徐飞,洪亮劼,霍泰稳,池建强,Selina,Gary,InfoQ,极客搜索"><meta name="description" content="极客时间是极客邦科技出品的一款 IT 内容知识服务 App，内容包含专栏订阅、极客新闻、热点专题、直播、视频和音频等多形式的知识内容，并设有陈皓专栏、徐飞专栏、洪亮劼专栏等专栏供订阅。"><link rel="apple-touch-icon" sizes="180x180" href="http://static001.geekbang.org/static/icon/time/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="http://static001.geekbang.org/static/icon/time/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="http://static001.geekbang.org/static/icon/time/favicon-16x16.png"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,viewport-fit=cover"><meta name="format-detection" content="telephone=no"><title>10 | Nginx 命令行及演示：重载、热部署、日志切割</title><link href="https://static001.geekbang.org/static/time/css/app.b230db929e53af87acd535637f5011b8.css" rel="stylesheet"><style type="text/css">        @font-face {            font-family: player-font;            src: url("//at.alicdn.com/t/font_509397_9fpjwjp73uqsemi.eot");            src: url("//at.alicdn.com/t/font_509397_9fpjwjp73uqsemi.eot?#iefix") format("embedded-opentype"), url("//at.alicdn.com/t/font_509397_9fpjwjp73uqsemi.woff") format("woff"), url("//at.alicdn.com/t/font_509397_9fpjwjp73uqsemi.ttf") format("truetype"), url("//at.alicdn.com/t/font_509397_9fpjwjp73uqsemi.svg#player-font") format("svg")        }        .player-font {            font-family: player-font !important;            font-size: 16px;            font-style: normal;            -webkit-font-smoothing: antialiased;            -webkit-text-stroke-width: .2px;            -moz-osx-font-smoothing: grayscale        }        .vplayer {            position: relative;            overflow: hidden        }        .vplayer,        .vplayer video {            width: 100%        }        .vplayer .title {            position: absolute;            top: 1rem;            left: 1rem;            right: 1rem;            color: #fff;            font-weight: 400;            font-size: .875rem;            word-break: break-all;            display: -webkit-box;            overflow: hidden;            text-overflow: ellipsis;            -webkit-box-orient: vertical;            -webkit-line-clamp: 1        }        .vplayer .finish-control,        .vplayer .loading {            position: absolute;            top: 0;            left: 0;            background: rgba(0, 0, 0, .5);            color: #fff;            width: 100%;            height: 100%;            z-index: 2;            display: -webkit-box;            display: -ms-flexbox;            display: flex;            -webkit-box-align: center;            -ms-flex-align: center;            align-items: center;            -webkit-box-pack: center;            -ms-flex-pack: center;            justify-content: center        }        .vplayer .finish-control h3,        .vplayer .loading h3 {            position: absolute;            color: #fff;            top: 1rem;            left: 50%;            font-size: 1rem;            font-weight: 400;            -webkit-transform: translate(-50%);            transform: translate(-50%)        }        .vplayer .finish-control p,        .vplayer .loading p {            cursor: pointer;            max-height: 6rem;            text-align: center        }        .vplayer .finish-control .cancel-next,        .vplayer .loading .cancel-next {            margin-left: 4rem        }        .vplayer .finish-control .cancel-next .icon-cancel-next,        .vplayer .loading .cancel-next .icon-cancel-next {            height: 4rem;            line-height: 4rem;            cursor: pointer;            font-size: 3.5rem        }        .vplayer .finish-control .cancel-next .icon-cancel-next i,        .vplayer .loading .cancel-next .icon-cancel-next i {            position: absolute;            top: 0;            left: 0;            margin-left: 8px        }        .vplayer .finish-control .icon-replay,        .vplayer .loading .icon-replay {            height: 4rem;            cursor: pointer;            line-height: 4rem;            font-size: 3rem        }        .vplayer .finish-control {            background: #000        }        .vplayer .no-wifi {            width: 70%;            position: absolute;            left: 50%;            top: 50%;            padding: 1rem;            background: rgba(0, 0, 0, .8);            -webkit-transform: translate(-50%, -50%);            transform: translate(-50%, -50%);            display: -webkit-box;            display: -ms-flexbox;            display: flex;            -webkit-box-orient: vertical;            -webkit-box-direction: normal;            -ms-flex-direction: column;            flex-direction: column;            -webkit-box-pack: center;            -ms-flex-pack: center;            justify-content: center;            -webkit-box-align: center;            -ms-flex-align: center;            align-items: center;            z-index: 3        }        .vplayer .no-wifi p {            line-height: 1.5rem;            margin: 0 auto;            width: 60%;            color: #fff;            font-size: 1rem;            text-align: center        }        .vplayer .no-wifi p span {            font-size: .875rem        }        .vplayer .no-wifi div {            -webkit-box-flex: 1;            -ms-flex-positive: 1;            flex-grow: 1;            margin-top: 1rem        }        .vplayer .no-wifi div a {            color: #fff;            background: #ff5a05;            padding: .3rem .5rem        }        .vplayer .no-wifi div a:last-child {            margin-left: 1rem        }        .vplayer .buy {            position: absolute;            z-index: 4;            top: 0;            left: 0;            width: 100%;            height: 100%;            color: #fff;            display: -webkit-box;            display: -ms-flexbox;            display: flex;            -webkit-box-orient: vertical;            -webkit-box-direction: normal;            -ms-flex-direction: column;            flex-direction: column;            -webkit-box-pack: center;            -ms-flex-pack: center;            justify-content: center;            -webkit-box-align: center;            -ms-flex-align: center;            align-items: center;            background: #000        }        .vplayer .buy p {            text-align: center        }        .vplayer .buy p span {            color: #ff5a05        }        .vplayer .buy .btn {            margin-top: 1rem;            color: #fff;            background: #ff5a05;            padding: .3rem 1.5rem        }        .android .dplayer .dplayer-controller .dplayer-icons .dplayer-full,        .dplayer-setting-item.dplayer-setting-loop {            display: none        }</style><style type="text/css">        .MathJax_Display {            overflow: auto        }        .poster {            position: fixed;            left: -10000px;            top: -10000px;            overflow: hidden;            padding: 1rem;            background: #ececec        }        .richcontent-pre-copy {            font-size: 13px;            color: #888;            position: absolute;            right: 1em;            top: .2em;            cursor: pointer;            -webkit-user-select: none;            -moz-user-select: none;            -ms-user-select: none;            user-select: none        }        .richcontent-pre-copy .iconfont {            font-size: 12px;            margin-right: .2em        }</style><style type="text/css">        .bottom {            width: 100%;            background-color: #f5f5f5;            position: fixed;            bottom: 0;            left: 0;            z-index: 10        }        .bottom,        .bottom .bottom-wrapper {            height: 67px;            display: -webkit-box;            display: -ms-flexbox;            display: flex;            -webkit-box-orient: horizontal;            -webkit-box-direction: normal;            -ms-flex-direction: row;            flex-direction: row        }        .bottom .bottom-wrapper {            -webkit-box-flex: 1;            -ms-flex-positive: 1;            flex-grow: 1;            padding-left: 20px;            padding-right: 20px;            -webkit-box-align: center;            -ms-flex-align: center;            align-items: center;            -webkit-box-pack: justify;            -ms-flex-pack: justify;            justify-content: space-between        }        .bottom .bottom-wrapper a {            height: 48px;            line-height: 51px;            -webkit-box-sizing: border-box;            box-sizing: border-box        }</style><style type="text/css">        .breadcrumb {            padding: 30px 0;            display: -webkit-box;            display: -ms-flexbox;            display: flex;            -webkit-box-orient: horizontal;            -webkit-box-direction: normal;            -ms-flex-direction: row;            flex-direction: row;            -webkit-box-align: center;            -ms-flex-align: center;            align-items: center;            -ms-flex-wrap: wrap;            flex-wrap: wrap;            background: #fff        }        .breadcrumb a.title {            color: #e57c39;            font-size: 15px;            font-weight: 400        }        .breadcrumb span.title {            color: #888;            font-size: 15px;            font-weight: 400        }        .breadcrumb .split {            color: #ccc;            font-size: 10px;            margin-right: 5px        }</style><style type="text/css">        .course-detail[data-v-4e11b9bf] {            max-width: 46.25rem;            margin: 0 auto;            background: #f5f5f5        }        .course-detail .course-main[data-v-4e11b9bf] {            background-color: #fff;            width: 100%;            z-index: 10;            top: 0;            left: 0        }        .course-detail .course-info[data-v-4e11b9bf] {            background: #fff;            cursor: pointer        }        .course-detail .course-info .course-info-top[data-v-4e11b9bf] {            padding: 1rem 0 .4rem .78125rem;            display: -webkit-box;            display: -ms-flexbox;            display: flex;            -webkit-box-pack: justify;            -ms-flex-pack: justify;            justify-content: space-between;            -webkit-box-align: center;            -ms-flex-align: center;            align-items: center        }        .course-detail .course-info .course-info-top h1[data-v-4e11b9bf] {            font-size: 1.03125rem;            font-weight: 400;            text-align: justify-content        }        .course-detail .course-info .course-info-top i[data-v-4e11b9bf] {            font-weight: 400;            width: 40px;            padding-right: .78125rem;            -ms-flex-negative: 0;            flex-shrink: 0;            text-align: right;            color: #dadada        }        .course-detail .course-info .course-info-bottom[data-v-4e11b9bf] {            padding: 0 54px .5rem .78125rem;            border-bottom: 1px solid #e8e8e8;            color: #888;            font-size: .78125rem        }        .course-detail .course-info .course-info-bottom .icon-course-play[data-v-4e11b9bf] {            color: #d9d9d9;            font-size: .75rem        }        .course-detail .video-list[data-v-4e11b9bf] {            background: #fff;            width: 100%;            overflow: hidden;            overflow: auto;            -webkit-overflow-scrolling: touch        }        .course-detail .video-list ul[data-v-4e11b9bf] {            display: -webkit-box;            display: -ms-flexbox;            display: flex;            -webkit-box-orient: horizontal;            -webkit-box-direction: normal;            -ms-flex-direction: row;            flex-direction: row;            padding: .875rem 0        }        .course-detail .video-list ul li[data-v-4e11b9bf] {            margin-left: .71875rem;            position: relative;            border: 1px solid #e8e8e8;            border-radius: 3px;            display: -webkit-box;            display: -ms-flexbox;            display: flex;            height: 4.0625rem;            overflow: hidden;            -webkit-box-pack: center;            -ms-flex-pack: center;            justify-content: center;            -webkit-box-align: center;            -ms-flex-align: center;            align-items: center;            font-size: .78125rem;            -ms-flex-negative: 0;            flex-shrink: 0;            line-height: 1rem;            -webkit-transition: border .5s ease;            transition: border .5s ease        }        .course-detail .video-list ul li img[data-v-4e11b9bf] {            width: 1.78125rem;            height: .84375rem;            position: absolute;            top: 0;            left: 0        }        .course-detail .video-list ul li a[data-v-4e11b9bf] {            -webkit-transition: color .5s ease;            transition: color .5s ease;            padding: 0 .5rem        }        .course-detail .video-list ul li a[data-v-4e11b9bf]:link,        .course-detail .video-list ul li a[data-v-4e11b9bf]:visited {            color: #353535        }        .course-detail .video-list ul li.on[data-v-4e11b9bf] {            border-color: #ff5a05        }        .course-detail .video-list ul li.on a[data-v-4e11b9bf]:link,        .course-detail .video-list ul li.on a[data-v-4e11b9bf]:visited {            color: #ff5a05        }        .article-title[data-v-4e11b9bf] {            color: #353535;            font-weight: 400;            line-height: 1.65rem;            font-size: 1.34375rem        }        .article-info[data-v-4e11b9bf] {            color: #888;            font-size: .9375rem;            margin-top: 1.0625rem        }        .article-content[data-v-4e11b9bf] {            margin-top: 1.0625rem        }        .audio-player[data-v-4e11b9bf] {            width: 100%;            margin: 20px 0        }        .content-box[data-v-4e11b9bf] {            padding: 1px 1.3125rem;            background-color: #fff;            margin-top: .46875rem        }        .to-comment[data-v-4e11b9bf] {            overflow: hidden;            padding-top: 20px;            margin: 0 1.3125rem -10px        }        .to-comment a.button-primary[data-v-4e11b9bf] {            float: right;            height: 20px;            font-size: 12px;            line-height: 20px;            padding: 4px 8px;            cursor: pointer        }        .extra[data-v-4e11b9bf] {            margin-top: .46875rem;            margin-bottom: 67px;            background: #fff;            position: relative        }        .extra .video-comment-box[data-v-4e11b9bf] {            position: absolute;            width: 100%;            top: 0;            left: 0;            z-index: 3;            -webkit-box-sizing: border-box;            box-sizing: border-box;            background: #fff;            padding-left: 1rem;            padding-right: 1rem;            padding-top: .5rem        }        .extra .video-comment-box h3[data-v-4e11b9bf] {            color: #353535;            font-size: .875rem;            line-height: 2rem;            font-weight: 400        }        .extra .comments[data-v-4e11b9bf] {            margin: 0 1.3125rem;            padding-bottom: 50px        }        .extra .comments h2[data-v-4e11b9bf] {            text-align: center;            color: #888;            position: relative;            z-index: 1;            margin-bottom: 14px        }        .extra .comments h2[data-v-4e11b9bf]:before {            border-top: 1px dotted #e8e8e8;            content: "";            position: absolute;            top: 50%;            left: 0;            width: 100%;            z-index: -1        }        .extra .comments h2 span[data-v-4e11b9bf] {            font-size: 15.25px;            font-weight: 400;            padding: 16px 1rem;            background: #fff;            display: inline-block        }        .extra .comments .no-comment[data-v-4e11b9bf] {            text-align: center        }        .extra .comments .no-comment i.icon-cat[data-v-4e11b9bf] {            color: #f5f5f5;            font-size: 100px;            line-height: 1.2;            margin-right: 12px        }        .extra .comments .no-comment .no-comment-text[data-v-4e11b9bf] {            color: #e8e8e8;            font-size: 12.5px;            line-height: 1.6        }        .bottom[data-v-4e11b9bf] {            position: fixed;            bottom: 0;            left: 0;            width: 100%;            height: 67px;            background: #fff;            background-color: #f5f5f5;            z-index: 10        }        .bottom .buy-join[data-v-4e11b9bf],        .bottom[data-v-4e11b9bf] {            display: -webkit-box;            display: -ms-flexbox;            display: flex;            -webkit-box-pack: center;            -ms-flex-pack: center;            justify-content: center        }        .bottom .buy-join[data-v-4e11b9bf] {            -webkit-box-orient: horizontal;            -webkit-box-direction: normal;            -ms-flex-direction: row;            flex-direction: row;            -webkit-box-align: center;            -ms-flex-align: center;            align-items: center;            height: 48px;            line-height: 48px        }        .bottom .buy-join span[data-v-4e11b9bf] {            line-height: 48px;            margin-left: 5px;            color: hsla(0, 0%, 100%, .5);            font-size: 11px;            text-decoration: line-through        }        .bottom .button-cancel[data-v-4e11b9bf] {            height: 51px;            line-height: 51px        }        .bottom-control[data-v-4e11b9bf],        .bottom-sub[data-v-4e11b9bf] {            width: 100%;            -webkit-box-orient: horizontal;            -ms-flex-direction: row;            flex-direction: row;            -ms-flex-pack: distribute;            justify-content: space-around;            -webkit-box-sizing: border-box;            box-sizing: border-box;            padding: 0 1.3125rem        }        .bottom-control .item[data-v-4e11b9bf],        .bottom-control[data-v-4e11b9bf],        .bottom-sub .item[data-v-4e11b9bf],        .bottom-sub[data-v-4e11b9bf] {            display: -webkit-box;            display: -ms-flexbox;            display: flex;            -webkit-box-align: center;            -ms-flex-align: center;            align-items: center;            -webkit-box-direction: normal        }        .bottom-control .item[data-v-4e11b9bf],        .bottom-sub .item[data-v-4e11b9bf] {            -webkit-box-flex: 1;            -ms-flex-positive: 1;            flex-grow: 1;            -webkit-box-orient: vertical;            -ms-flex-direction: column;            flex-direction: column;            -webkit-box-pack: center;            -ms-flex-pack: center;            justify-content: center;            cursor: pointer        }        .bottom-control .item i[data-v-4e11b9bf],        .bottom-sub .item i[data-v-4e11b9bf] {            color: #353535;            font-size: 1.125rem;            line-height: 1.5rem        }        .bottom-control .item span[data-v-4e11b9bf],        .bottom-sub .item span[data-v-4e11b9bf] {            color: #888;            font-size: 11px        }        .button-subscribe[data-v-4e11b9bf] {            -webkit-box-flex: 1;            -ms-flex: 1;            flex: 1;            height: 69px;            color: #fff;            font-size: 15.25px;            text-align: center;            background-color: #ff5a05;            line-height: 69px;            border-radius: 5px        }        .article-sub-bottom[data-v-4e11b9bf] {            z-index: 2        }        @media only screen and (device-width:375px) and (device-height:812px) and (-webkit-device-pixel-ratio:3) {            .bottom[data-v-4e11b9bf],            .comments[data-v-4e11b9bf] {                padding-bottom: 34px            }        }        @media (max-width:769px) {            .course-detail .breadcrumb[data-v-4e11b9bf] {                padding: 10px            }        }        @media screen and (min-width:768px) {            .extra .comments[data-v-4e11b9bf],            .to-comment[data-v-4e11b9bf] {                margin: 0 0 -10px            }        }</style><style type="text/css">        .mobile-tips {            width: 100%;            height: 51px;            background: rgba(0, 0, 0, .8);            position: fixed;            top: 0;            left: 0;            z-index: 20;            display: -webkit-box;            display: -ms-flexbox;            display: flex;            -webkit-box-orient: horizontal;            -webkit-box-direction: normal;            -ms-flex-direction: row;            flex-direction: row;            -webkit-box-align: center;            -ms-flex-align: center;            align-items: center;            -webkit-box-pack: justify;            -ms-flex-pack: justify;            justify-content: space-between;            -webkit-box-sizing: border-box;            box-sizing: border-box;            padding: 0 12px;            -webkit-transition: opacity .35s;            transition: opacity .35s;            opacity: 0;            pointer-events: none        }        .mobile-tips.istop {            opacity: 1;            pointer-events: auto        }        .mobile-tips .mobile-tips-info {            display: -webkit-box;            display: -ms-flexbox;            display: flex;            -webkit-box-orient: horizontal;            -webkit-box-direction: normal;            -ms-flex-direction: row;            flex-direction: row;            -webkit-box-align: center;            -ms-flex-align: center;            align-items: center;            -webkit-box-pack: start;            -ms-flex-pack: start;            justify-content: flex-start        }        .mobile-tips .mobile-tips-info i {            width: 36px;            height: 36px;            background-image: url(data:image/png;base64,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);            background-position: 0 0;            background-repeat: no-repeat;            background-size: contain;            border-radius: 7px        }        .mobile-tips .mobile-tips-info h2 {            font-size: 15px;            color: #fff;            font-weight: 400;            margin-left: 6px        }        .mobile-tips .mobile-tips-info h2 span {            font-size: 11px        }        .mobile-tips a {            width: 72px;            height: 31px;            text-align: center;            border: 1px solid #ff5a05;            border-radius: 3px;            font-size: 13px;            color: #ff5a05;            line-height: 31px        }</style><style type="text/css">        .comment-item {            list-style-position: inside;            width: 100%;            display: -webkit-box;            display: -ms-flexbox;            display: flex;            -webkit-box-orient: horizontal;            -webkit-box-direction: normal;            -ms-flex-direction: row;            flex-direction: row;            margin-bottom: 1rem        }        .comment-item a {            border-bottom: none        }        .comment-item .avatar {            width: 2.625rem;            height: 2.625rem;            -ms-flex-negative: 0;            flex-shrink: 0;            border-radius: 50%        }        .comment-item .info {            margin-left: .5rem;            -webkit-box-flex: 1;            -ms-flex-positive: 1;            flex-grow: 1        }        .comment-item .info .hd {            width: 100%;            display: -webkit-box;            display: -ms-flexbox;            display: flex;            -webkit-box-orient: horizontal;            -webkit-box-direction: normal;            -ms-flex-direction: row;            flex-direction: row;            -webkit-box-pack: justify;            -ms-flex-pack: justify;            justify-content: space-between;            -webkit-box-align: center;            -ms-flex-align: center;            align-items: center        }        .comment-item .info .hd .username {            color: #888;            font-size: 15.25px;            font-weight: 400;            line-height: 1.2        }        .comment-item .info .hd .control {            display: -webkit-box;            display: -ms-flexbox;            display: flex;            -webkit-box-orient: horizontal;            -webkit-box-direction: normal;            -ms-flex-direction: row;            flex-direction: row;            -webkit-box-align: center;            -ms-flex-align: center;            align-items: center        }        .comment-item .info .hd .control .btn-share {            color: #888;            font-size: .75rem;            margin-right: 1rem        }        .comment-item .info .hd .control .btn-praise {            display: -webkit-box;            display: -ms-flexbox;            display: flex;            -webkit-box-orient: horizontal;            -webkit-box-direction: normal;            -ms-flex-direction: row;            flex-direction: row;            -webkit-box-align: center;            -ms-flex-align: center;            align-items: center;            font-size: 15.25px;            text-decoration: none        }        .comment-item .info .hd .control .btn-praise i {            color: #888;            display: inline-block;            font-size: .75rem;            margin-right: .3rem;            margin-top: -.01rem        }        .comment-item .info .hd .control .btn-praise i.on,        .comment-item .info .hd .control .btn-praise span {            color: #ff5a05        }        .comment-item .info .bd {            color: #353535;            font-size: 15.25px;            font-weight: 400;            white-space: normal;            word-break: break-all;            line-height: 1.6        }        .comment-item .info .time {            color: #888;            font-size: 9px;            line-height: 1        }        .comment-item .info .reply .reply-hd {            font-size: 15.25px        }        .comment-item .info .reply .reply-hd span {            margin-left: -12px;            color: #888;            font-weight: 400        }        .comment-item .info .reply .reply-hd i {            color: #ff5a05;            font-size: 15.25px        }        .comment-item .info .reply .reply-content {            color: #353535;            font-size: 15.25px;            font-weight: 400;            white-space: normal;            word-break: break-all        }        .comment-item .info .reply .reply-time {            color: #888;            font-size: 9px        }</style></head><body style=""><div id="app"><div data-v-4e11b9bf="" class="course-detail"><div class="breadcrumb breadcrumb"><span><a href="#" class="title router-link-active">讲堂</a><span class="split iconfont"></span></span><span><span class="title">10 | Nginx 命令行及演示：重载、热部署、日志切割</span></span></div><div data-v-4e11b9bf="" class="course-main main" style="position: relative;"><div data-v-4e11b9bf="" class="vplayer" id ="DplayerCont" style="height: 416.25px;"><h2 class="title">                        10 | Nginx 命令行及演示：重载、热部署、日志切割</h2></div></div><div data-v-4e11b9bf="" class="course-info" style="margin-top: 0px;"><div data-v-4e11b9bf="" class="course-info-top"><h1 data-v-4e11b9bf="" class="course-title"></h1><i data-v-4e11b9bf="" class="iconfont"></i></div></div><div data-v-4e11b9bf=""><div data-v-4e11b9bf="" class="content-box"><div data-v-4e11b9bf="" id="article-content" class="typo common-content"><div class="text">                            <h1>课件下载地址</h1><p><a href="https://github.com/geektime-geekbang/geektime-nginx/blob/master/Nginx%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86100%E8%AE%B2-%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86%E8%AF%BE%E4%BB%B6.pdf">https://github.com/geektime-geekbang/geektime-nginx/blob/master/Nginx核心知识100讲-第一部分课件.pdf</a></p><!-- [[[read_end]]] --></div></div></div></div><div data-v-4e11b9bf="" class="extra" style="margin-bottom: 1rem;"><div data-v-4e11b9bf="" class="comments"><h2 data-v-4e11b9bf=""><span data-v-4e11b9bf="">精选留言</span></h2><ul>                        <li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/04/46/263f1945.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">godz</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>27</span></a></div>
	</div>
	<div class="bd">切割日志的时候，先复制再停止ng，会漏掉从复制到停止中间这段时间的日志吧？</div> <span class="time">2018-11-06</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">是的，这个演示为了方便初学linux的同学理解，所以用了复制。<br>在生产环境中，应该把cp命令改为mv命令，因为linux文件系统中，改名并不会影响已经打开文件的写入操作，内核inode不变，这样就不会出现丢日志了。<br>谢谢你的提醒，视频最后应该提一下这个事的。</p> <p class="reply-time">2018-11-06</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/fc/ac/55c2a6e3.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">风竹</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>5</span></a></div>
	</div>
	<div class="bd">讲的很好，都是干货！<br>看了这节课，有个问题想问问：<br>热部署，在执行完kill -USR2 masterPid 后，如何判断老的master进程不在监听80 or 443端口？<br>热部署，在执行完kill -WINCH masterPid 后，如果没问题，老的master进程是手动 Kill掉吗？<br>热部署，在执行完kill -WINCH masterPid 后，如果有问题，重新执行-s reload重新拉起worker进程，操作流程是先将二进制文件nginx.old还原为nginx， 然后执行nginx -s reload, 那nginx.new的master的进程和worker进程如何关闭呢？</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">先回答第1个问题：用lsof -p 进程号，可以看到进程打开的句柄，也包括监听的端口。用netstat命令也可以看到一些端口被哪些进程打开。或者直接在&#47;proc目录中找进程的相关信息也可以。<br>第2个问题：可以用kill -QUIT把老master杀掉。<br>第3个问题：直接用kill -USR1来执行reload，不要用-s reload，这样还是老的nginx worker起来</p> <p class="reply-time">2018-11-17</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/fd/fe/620e0e0a.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">正经儿🐾海森</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>3</span></a></div>
	</div>
	<div class="bd">大赞，讲的很好，关键是还每个留言都回复，超棒的老师，每个留言都看一遍也是收获满满</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">谢谢！</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/04/46/263f1945.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">godz</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>3</span></a></div>
	</div>
	<div class="bd">切割日志文件时，先复制再停止ng，会漏掉复制后到停止中间这段时间的日志吧？？ </div> <span class="time">2018-11-06</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">是的，这个演示为了方便初学linux的同学理解，所以用了复制。<br>在生产环境中，应该把cp命令改为mv命令，因为linux文件系统中，改名并不会影响已经打开文件的写入操作，内核inode不变，这样就不会出现丢日志了。<br>谢谢你的提醒，视频最后应该提一下这个事的。</p> <p class="reply-time">2018-11-06</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/43/e0/66b71c1f.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">哈哈</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>1</span></a></div>
	</div>
	<div class="bd">必须要点赞，讲的非常好，最主要作者特别认真和耐心(每个评论都有回复)。必须点赞。</div> <span class="time">2019-01-25</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">：-）</p> <p class="reply-time">2019-01-25</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/ee/7e/955b686d.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">AA星星点灯</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>1</span></a></div>
	</div>
	<div class="bd">热部署失败之后到底用kill -USR1呢，还是用kill -HUP呢？有点儿不明白，他们两个的问题把我搞糊涂了，或是老师给说说热部署失败之后如何回退呢？</div> <span class="time">2018-11-25</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">USR1是切割日志的，对应reopen命令。而HUP是对应reload命令，它会在没有worker进程时启动worker进程。所以，回退应该用HUP信号。</p> <p class="reply-time">2018-11-26</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/25/23/06a37753.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">jesse</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>1</span></a></div>
	</div>
	<div class="bd">老师，您好，我在做nginx热部署的时候遇到一个问题，您说，在发送USR2信号后，旧的nginx进程不再监听端口，但是我测试的时候，出现如下情况（新旧进程都在监听端口），麻烦您看一下，是哪里出了问题？<br>[root@VM_0_5_centos sbin]# kill -USR2 11848<br>[root@VM_0_5_centos sbin]# ps -ef | grep nginx<br>root     11848     1  0 16:34 ?        00:00:00 nginx: master process .&#47;nginx<br>nobody   11849 11848  0 16:34 ?        00:00:00 nginx: worker process<br>root     18313 11848  0 16:53 ?        00:00:00 nginx: master process .&#47;nginx<br>nobody   18314 18313  0 16:53 ?        00:00:00 nginx: worker process<br>root     18318  8534  0 16:53 pts&#47;7    00:00:00 grep --color=auto nginx<br>[root@VM_0_5_centos sbin]# lsof -i:8000 -NP<br>COMMAND   PID   USER   FD   TYPE   DEVICE SIZE&#47;OFF NODE NAME<br>nginx   11848   root    6u  IPv4 58659472      0t0  TCP *:8000 (LISTEN)<br>nginx   11849 nobody    6u  IPv4 58659472      0t0  TCP *:8000 (LISTEN)<br>nginx   18313   root    6u  IPv4 58659472      0t0  TCP *:8000 (LISTEN)<br>nginx   18314 nobody    6u  IPv4 58659472      0t0  TCP *:8000 (LISTEN)</div> <span class="time">2018-11-18</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">旧nginx进程仍然在LISTEN，只是不会去处理这个socket，因为没有把它加到epoll中。master进程打开监听端口，但不处理，由worker进程处理。另外，旧master是新master的父进程，所以新master才能共享打开的监听端口。</p> <p class="reply-time">2018-11-19</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/bHJo9C9uHz9fYkshxJSAiaXRUAIB9sORzpqy5z04DpfIm6J5qBgwugfEqfIHIuLn0FPV1dfTEVB3BcwmqSjJ21g/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Linc</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">热部署回退那里不是很明白。旧的nginx命令改为nginx.old，再把新的nginx命令复制过来，执行kill -USR2 master_old_pid后，会生成master_new_pid，再执行kill -WINCH master_old_pid后，旧master不再处理业务。假设现在要回退<br>1，执行kill -USR1master_old_pid 就行了吗？<br>2，是否要把旧版本的二进制文件(即nginx命令)先回复为nginx.old，再执行kill -USR1 master_old_pid呢？</div> <span class="time">2019-01-30</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">首先，旧的master进程，就是用老的二进制文件启的。<br>所以，回退时，对旧master进程调用kill -SIGHUP（等同-s reload），这样老worker就又起来了。再把新worker退出。<br>这一课只是简单的示例，WINCH只是取消accept新连接，它适用于灵活的控制新老nginx是否处理新连接。详细的介绍请参见第2部分第25课。</p> <p class="reply-time">2019-01-31</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEKkXmlsKCY7hhNIjJFd0wxtd7CDySRrvdknyUoZd02vUWq4o1HS6r8y5nAAcCypvuxDdQK5BGV4Eg/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">目标就是这么明确</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">如果新master运行没问题：<br>可以执行kill -QUIT old-nginx-master-pid把老master进程杀掉。<br>如果新master运行有问题，需要版本回退：<br>执行kill -HUP old-nginx-master-pid把老master reload了（不能用nginx -s reload,因为当前的nginx二进制文件已经是新的，不会对老的nginx起作用），这时候老master会起来自己的worker进程，但是老worker进程不会监听80或443端口，必须执行kill -WINCH new-nginx-master-pid（使新master结束自己的worker进程）后，老worker进程才会监听80端口，接收新情求。<br></div> <span class="time">2019-01-12</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">reload新启的老worker在启动后就会监听端口处理请求。可以用access日志看下，其中每条access日志上输出进程id。</p> <p class="reply-time">2019-01-14</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/f2/d3/0475d9e5.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">尘哥、👀</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">[root@izbp16ya3zehbpo5a7yxgdz sbin]# .&#47;nginx -s reload<br>nginx: [error] open() &quot;&#47;home&#47;geek&#47;nginx&#47;logs&#47;nginx.pid&quot; failed (2: No such file or directory)<br><br>老师这个是什么原因导致的啊 没生成这个文件吗</div> <span class="time">2019-01-12</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">nginx没启动成功吧？<br>或者你启动的nginx，与你现在执行命令的nginx不是同一个？</p> <p class="reply-time">2019-01-14</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/98/b4/e77be7fb.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Gokotta</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">[root@local sbin]# .&#47;nginx -s reload<br>nginx: [error] open() &quot;&#47;home&#47;lfm&#47;nginx&#47;logs&#47;nginx.pid&quot; failed (2: No such file or directory)<br>我看见评论里有个很类似的错误，但是重试之后还是不能行，这个是哪里有问题啊</div> <span class="time">2019-01-11</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">两个可能：<br>1、nginx进程在吗？用ps命令看一下。nginx未启动或者启动失败，则不会生成nginx.pid文件。<br>2、用nginx -V看下有没有设定pid文件的位置，参数为--pid-path=；在nginx.conf里看一下pid这个指令指定的路径 。</p> <p class="reply-time">2019-01-14</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/RNO4yZyBvic914hewmNNE8iblYDcfv5yGHZ9OnKuCuZXNmGR0F5qV3icKLT2xpMt66GyEpicZVvrmz8A6TIqt92MQg/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">啊啊啊哦哦</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">接着上面的路飞君。 直接将nginx 复制后。 直接执行 -s reload  不行的原因是 只是重新加载了配置文件。不会升级新的二进制文件吗。搜百度 都是直接-s reload</div> <span class="time">2019-01-05</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">是的，-s reload只是重启worker进程，但用的程序文件不会重新读取磁盘中的nginx，而是最初启动nginx时的文件（载入内存中了）</p> <p class="reply-time">2019-01-07</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="" class="avatar">
<div class="info">
	<div class="hd"><span class="username">李明华</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">kill -WINCH PID 之后  老的master成为了新的master的父进程，那就是说老的master进程要一直存在，不能杀死了吗  老师</div> <span class="time">2019-01-03</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">可以杀死的，父进程杀死后，不会导致子进程也被杀死的，此时子进程的父进程为linux系统上的第1个进程。</p> <p class="reply-time">2019-01-03</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/14/80/2c/bd51e532.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">周楠</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，您在评论区里说的热部署之后如果没问题可以用kill -QUIT把老master杀掉，我试过了，但是新的进程也都被杀掉了。我想应该是因为老master是新master的父进程，所以也会把新的一起带走。那是不是说老master进程就应该一直保留着不能杀掉了？</div> <span class="time">2019-01-02</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">不是的，虽然老master是新master的父进程，但不会停止新master进程。<br>你可以这么检查步骤：<br>1、kill -USR2后，观察是否同时有2个master进程，以及同时有两批worker进程，进程数量与你的配置一致。如果不是，说明你配置或者编译出的nginx有问题。<br>2、再执行QUIT，查看error.log中是否有错误日志。</p> <p class="reply-time">2019-01-03</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/a9/29/dad1f942.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">en</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师我用lsof -p后面跟新老worker的pid，发现显示的都一样，您是怎么判断的老的worker不监听呢？我用netstat也只能查出来是老的master在监听80(执行kill -USR2  masterPid后),可以详细给我讲一下吗？</div> <span class="time">2018-12-28</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">1、确保日志上出现gracefully shutting down这条notice级别的error.log；<br>2、确保nginx worker进程的名字被改成worker process is shutting down。<br>这两者是同时出现的，此时这个旧worker进程就不再监听，你再用netstat观察该worker进程。</p> <p class="reply-time">2018-12-29</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/14/b5/42/21ed2f7b.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">俗人or诗</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，nginx: [alert] kill(20630, 1) failed (1: Operation not permitted)，这个提示不是意味着必须用root用户运行命令</div> <span class="time">2018-12-22</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">root用户肯定可以，实际上，确保shell用户有权限对master进程发起信号。</p> <p class="reply-time">2018-12-24</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/86/fa/4bcd7365.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">玉剑冰锋</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">按照您课程里面讲的我理解的只是升级版本，原来的配置不应该更改，也就是说配置应该还是原来的配置，如果用新的配置干脆直接停止老版本，启动新版本不就行了，这样不就起不到平滑升级的目的了吧？我就是想问问，课程讲解的时候没有加载新配置文件，我自己的为啥加载新配置文件了？</div> <span class="time">2018-12-21</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">1.nginx启动时可以通过-c这个命令行指定配置文件<br>2.如果没指定，那么有一个默认位置的配置文件，如果恰好这个位置有nginx.conf，就会读取<br>3.这个默认位置，可以通过编译时，configure的参数指定。</p> <p class="reply-time">2018-12-22</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/86/fa/4bcd7365.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">玉剑冰锋</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">您好，老师，接上次问题，版本更新后程序直接读取新的配置文件，日志同样也输入到新版本安装目录</div> <span class="time">2018-12-21</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">你的目的是输出到老的目录吗？可以通过编译时的参数控制的</p> <p class="reply-time">2018-12-21</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/86/fa/4bcd7365.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">玉剑冰锋</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">您好，由于工作原因无法实时跟着课程来学习，之前反馈版本平滑升级时会报错403，自己找到原因了，1.在您讲课时候没有看到nginx.conf中添加user root;(或者其他用户)，我这必须指定以后才可以正常访问，想问一下是否必须配置？2.平滑升级以后又报错403，其实还是因为新版本的配置文件没有添加user root;请问平滑升级为啥直接加载了新版本的默认配置文件？</div> <span class="time">2018-12-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">1、我的开发环境下因为要模拟各种例外示例，所以为了效率我就加user root，这意味着worker进程是root用户起的，在生产环境下这样有安全问题，还是建议用非root用户。当然你要确保资源可以被指定用户访问。<br>2、不太明白你的意思。你是说升级后，没有去读老nginx.conf文件吗？</p> <p class="reply-time">2018-12-17</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/ce/8f/6daf02db.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">心灵捕手</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">[root@10-255-0-145 sbin]# kill -USR2 1915<br>[root@10-255-0-145 sbin]# ps -ef | grep nginx<br>root      1915     1  0 17:27 ?        00:00:00 nginx: master process .&#47;nginx -c &#47;home&#47;geek&#47;nginx-1.14.2&#47;conf&#47;nginx.conf<br>nobody    1920  1915  0 17:27 ?        00:00:00 nginx: worker process<br>root      7290  1117  0 18:53 pts&#47;2    00:00:00 grep --color=auto nginx<br>老师,我kill 后再执行ps 没啥变化,是因为没有自动重启么</div> <span class="time">2018-12-15</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">kill USR2后是应当有变化的，变化是：生成一个新master进程及相应worker进程。<br>没有变化的原因很可能是出现错误了，你看一下error.log日志文件。</p> <p class="reply-time">2018-12-17</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/ce/8f/6daf02db.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">心灵捕手</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">[root@10-255-0-145 sbin]# .&#47;nginx -s reload<br>nginx: [alert] could not open error log file: open() &quot;home&#47;geek&#47;nginx&#47;logs&#47;error.log&quot; failed (2: No such file or directory)<br>2018&#47;12&#47;13 11:53:54 [emerg] 5132#0: open() &quot;home&#47;geek&#47;nginx&#47;conf&#47;nginx.conf&quot; failed (2: No such file or directory)<br>老师,我的这个是不是因为Nginx没启动没有日志造成的?该怎么解决呢</div> <span class="time">2018-12-13</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">指定prefix目录时，是不是少打了&#47;前缀？应该是&#47;home&#47;geek吧？</p> <p class="reply-time">2018-12-17</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/39/b8/e4b6a677.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">YUANWOW</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">热部署新的nginx的编译参数必须和老的完全一样吗？</div> <span class="time">2018-12-06</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">如果需要兼容老配置,那么编译参数通常只增不减</p> <p class="reply-time">2018-12-06</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/86/fa/4bcd7365.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">玉剑冰锋</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师您好，切换之前nginx可以正常访问,切换完成后提示403，是什么原因；直接kill掉重新试了一遍同样是403</div> <span class="time">2018-12-02</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">观察下error.log日志。</p> <p class="reply-time">2018-12-03</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/e8/d5/16450867.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">路飞君1234</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">再练习的时候，不考虑版本回退，将新版本nginx拷贝到对应目录下，执行nginx -s reload，是否可以呢</div> <span class="time">2018-12-01</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">不可以</p> <p class="reply-time">2018-12-01</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/9d/ee/2d02a9c0.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">水哥</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师可以附加一下kill信号和nginx命令对应的解释吗</div> <span class="time">2018-11-28</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">第2部分课程23里的PPT有详细介绍kill信号和nginx命令</p> <p class="reply-time">2018-11-29</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="" class="avatar">
<div class="info">
	<div class="hd"><span class="username">浪里小白龙</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师你好<br>我下载了新的nginx .&#47;configure --prefix=新目录  make，然后把编译好的sbin&#47;nginx覆盖了以前的sbin&#47;nginx， nginx -t显示 显示我的配置文件在新目录下。不是很理解</div> <span class="time">2018-11-24</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">--prefix指示的目录，被编译进nginx文件中了</p> <p class="reply-time">2018-11-26</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/14/18/40/a516412f.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">小小萝</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">个人觉得日志切割这块使用cronlog工具也是蛮方便的</div> <span class="time">2018-11-24</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">切割日志的可选项很多，这里只是nginx官方推荐的一种。</p> <p class="reply-time">2018-11-26</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/cd/f7/69856ef4.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">脚下的路</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师想请教一下切割日志倒是是用 nginx -s reopen 还是用kill -usr1 ？那个更加合理些尼？</div> <span class="time">2018-11-24</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">用-s reopen更不易犯猎，所以更合理一些。</p> <p class="reply-time">2018-11-26</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/4f/2d/7b5ed6c2.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">章星</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">nginx: worker process 进程怎么判断是属于哪个master进程呢？</div> <span class="time">2018-11-22</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">看worker父进程的pid，比较master进程的pid</p> <p class="reply-time">2018-11-23</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/cf/ce/9261eae7.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">arvin</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">我用的docker搭建了ubuntu，然后在里面操作的：<br>从源码编译 --prefix=&#47;home&#47;nginx, 然后 make &amp;&amp; make install了，<br>这时候在 &#47;home&#47;nginx里面生成相关文件，然后 &#47;usr&#47;sbin&#47;nginx 和 &#47;etc&#47;nginx 这两个地方怎么也存在了? <br>这个地方没理解，怎么会有 “两份”？</div> <span class="time">2018-11-21</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">这应该不是make install生成的，你可以比较下文件的创建时间，可能是你两次安装独立生成的。</p> <p class="reply-time">2018-11-21</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/94/55/afc64956.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">三年过后</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">前面留言有提到版本回退发送的信号，先向老master进程发送HUP信号，保证老的worker进程重新启动，再向新master发送QUIT，停掉新的worker进程。<br><br>这个过程如果还原原来的nginx.old .  1.先向老master发出HUP后，2.还原旧的nginx.old替换nginx 3.再向新master发出QUIT,KILL掉新的workder进程。  是这步骤流程吗？</div> <span class="time">2018-11-20</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">是的，2、3步没有顺序要求</p> <p class="reply-time">2018-11-21</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/29/41/b570fe1b.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">我想问问天</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">请问一下,日志分割可以指定某个日志文件分割吗?比如说server里面有好多个不同的log,只想切割某一个日志文件,其他的log都不动.</div> <span class="time">2018-11-19</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">这种日志分割方法是不行的，因为USR1信号是重新打开所有日志文件。</p> <p class="reply-time">2018-11-20</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/f8/b5/82b64369.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">阿涛</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师可以讲一下USER1和USER2吗</div> <span class="time">2018-11-18</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">USR1信号对应于reopen命令，用于重新打开文件，即切割日志用的；USR2信号用于升级nginx，它会以子进程方式启动另一个nginx。第2部分解说信号那一课有详细的描述：-）</p> <p class="reply-time">2018-11-19</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/da/bb/a20f37b2.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">湘江鸿</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师请教一下，热部署时，对老进程发送USR2信号后，老进程不再监听80或443端口，那么此时正在处理的http请求还能正常返回客户端吗？因为80或443端口已经不属于这个进程了，通过什么端口返回响应？</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">不再监听，不代表已经建立的TCP连接被关闭了，所以正在处理的http请求仍然可以返回客户端，且报文的源端口仍然可以是80或者443，它与监听与否无关。</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/7f/88/c4263c58.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">五年</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">新的版本是哪里来的呀...本身不是1.4了吗...这段好像剪掉了没看到.</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">新的版本是由新的源代码目录安装的，你可以在官网上下载任意的nginx版本源代码。</p> <p class="reply-time">2018-11-17</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/7f/88/c4263c58.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">五年</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">为什么要 reopen; 移走之后不会自动写新的日志吗?</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">如果用mv移走，其实还在写移动了目录的老文件，因为进程中的句柄没变。用reopen重新打开这个目录下的文件，因为文件已经不存在，所以会重新创建</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/ibZVAmmdAibBeVpUjzwId8ibgRzNk7fkuR5pgVicB5mFSjjmt2eNadlykVLKCyGA0GxGffbhqLsHnhDRgyzxcKUhjg/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">pyhhou</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">陶老师，我用ubuntu16.04的环境之前跟着你之前的视频编译了一遍，make install后需要start nginx吗，之前感觉没啥问题，但是因为现在reload不了，而且nginx也没有在后台运行，使用.&#47;nginx -s reload 就会报错：<br>nginx: [error] invalid PID number &quot;&quot; in &quot;&#47;home&#47;vagrant&#47;nginx&#47;logs&#47;nginx.pid&quot;<br><br>我看网上的一些安装例子，在系统的&#47;var&#47;... 和&#47;etc&#47;...目录下建立了nginx的相关文件和目录，但是发现问题还是没有解决。nginx完全没有启动，之前在ubuntu里都是直接apt-get install 直接安装nginx，第一次手动compile，还是希望老师指点指点</div> <span class="time">2018-11-15</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">需要启动nginx进程。你直接到安装目录的nginx执行即可，比如&#47;usr&#47;local&#47;nginx&#47;sbin&#47;nginx，如果没有任何报错信息就启动成功了，然后再用ps -ef | grep nginx看一下nginx进程是否存在 </p> <p class="reply-time">2018-11-15</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/c8/9f/b4a404f0.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">是谁</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">陶老师，热部署 把新版本1.15.6 编译好的二进制文件拷贝到1.14.1 --prefix指定目录中进程运行使用的nginx文件去，这个过程中新版本的编译需要执行make install 嘛，还是说只需要 .&#47;configure 指定目录 make 就行，然后再将 objs&#47;nginx 拷贝过去嘛，谢谢。</div> <span class="time">2018-11-14</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">新版本不需要make install，只要拷贝过去就行了cp -f</p> <p class="reply-time">2018-11-15</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/72/5a/6c6f423a.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">旭楠</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">很棒棒～确实都是干货,就是有点太干了,初学者表示一脸懵,然后出去找其他资源补充了一下nginx基础，再回来看第二遍，妥妥的～[得意]</div> <span class="time">2018-11-14</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">谢谢,后面的课程我会增加一些依赖知识的说明:-)</p> <p class="reply-time">2018-11-14</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/b0/1c/2e30eeb8.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">旺旺</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，在做热部署的时候，为什么只更新nginx二进制文件即可？<br>不同的版本（比如从nginx&#47;1.10.3升级到nginx&#47;1.14.1）会不会有配置语法的更改？如果有这样的配置语法的更改，只更新nginx的二进制文件是不是就不可以了？</div> <span class="time">2018-11-12</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">热部署，意味着老nginx已经在为用户服务了，nginx.conf已经被自定义修改过了，所以，换新版本nginx无须用新版本的自定义nginx.conf去替换。课程里表达的是这个意思。并不是说nginx.conf不需要做任何改变。</p> <p class="reply-time">2018-11-19</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/13/00/a4a2065f.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Michael</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">如果版本回退发送的信号是哪个？具体怎么操作</div> <span class="time">2018-11-11</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">先向老master进程发送HUP信号，保证老的worker进程重新启动，再向新master发送QUIT，停掉新的worker进程</p> <p class="reply-time">2018-11-12</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/bd/0d/f4799191.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">main</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师您好，centos，1.12版本执行了USR2操作后并不会有两个master进程，没有两个master就没法执行WINCH，不知道1.12是不是不支持这样热备。另外，一般都是将可执行文件放到&#47;usr&#47;bin目录下，热备后替换这个文件会提示busy无法替换，这个怎么解决啊？？？希望老师多讲讲信号这块，优雅停止，停止，平滑重启啥的，另外-g这个操作具体是干啥的啊？？？？老师加油！</div> <span class="time">2018-11-09</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">1.12支持热部署的，留意下error.log，看看有什么反馈。busy时就加-f参数，强制替换。信号第2部分会说的。-g就是把指令放在命令行中。</p> <p class="reply-time">2018-11-09</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/bd/0d/f4799191.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">main</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师好！1.12版本的USR2运行后实测没有出来两个master进程，而且WINCH好像也没有升级成功……一般都是将nginx可执行文件放到&#47;usr&#47;bin目录下，如果成功热部署了，那么还是需要更换这个bin下的二进制文件的吧，这样的话就会提示这个二进制文件busy更换不了……建议老师您再讲讲信号吧，平滑重庆、重启、优雅停止和停止啥的，那个-g其实我挺想听的</div> <span class="time">2018-11-09</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">嗯，可执行文件可以放在你习惯放置的路径下的。提示文件busy时，可以在cp命令上加-f强制替换。第2部分会从进程角度，再谈到信号 、重启、平滑升级的。-g参数使用很简单，把nginx.conf里的指令放在这里用的。</p> <p class="reply-time">2018-11-09</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/3c/cf/fa5c5123.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">阿星</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">kill -WINCH 13195   使用该命令使老的worker进程优雅退出，那老的Master进程不需要让它退出吗？还是一直留着便于回到老版本？</div> <span class="time">2018-11-08</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">当新版本已经稳定运行，测试用例都通过，且用户没有反馈出现大问题，就可以让它退出了。</p> <p class="reply-time">2018-11-09</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/e5/b2/f8f056be.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">🌟</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">有些真的讲的太快了，没搞清楚这些命令的作用，就一下过去了，然后给的pdf有没有相关的命令笔记。。。</div> <span class="time">2018-11-07</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">谢谢你的反馈，后续课程中我会把命令尽量都列在pdf中。这里的内容，在第2部分会再次深入描述一次，包括这些命令是怎样与信号结合的。</p> <p class="reply-time">2018-11-08</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/b2/55/61b3e9e3.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">承君此诺</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">日志切割，为什么不用linux自带的logrotate，nginx也有提供logrotate配置文件。</div> <span class="time">2018-11-07</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">nginx官方没有提供logrotate，因为我们mv后直接reopen或者发送USR1信号就可以了。由nginx来做reopen更简单纯粹，因为nginx进程收到信号后，会把cycle里保存的所有打开的文件句柄，关闭掉再打开即可，就会生成新的日志文件。</p> <p class="reply-time">2018-11-08</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/59/f6/ed66d1c1.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">chengzise</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">前面问题”环境ubuntu16.04, 没法以守护进程方式运行”,找到原因了。gnome terminal中现在都是使用新的session，终端中开始的那些守护进程都会挂在upstart进程下面，不会在pid1下面。通过ssh连接启动没有这个问题。参考: https:&#47;&#47;unix.stackexchange.com&#47;questions&#47;194182&#47;orphan-processs-parent-id-is-not-1-when-parent-process-executed-from-gnome-term</div> <span class="time">2018-11-07</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">：-）</p> <p class="reply-time">2018-11-07</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/59/f6/ed66d1c1.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">chengzise</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">环境ubuntu16.04, 没法以守护进程方式运行，master进程ppid是upstart, 老师热部署命令USR2没有效果，有同学碰到这个问题不？</div> <span class="time">2018-11-07</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">只有守护进程方式才能实现热部署哦。我们先看下为什么不能以守护进程方式运行哈，master_process on;设置下看看？</p> <p class="reply-time">2018-11-07</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/e2/50/9cc482c6.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">嘿嘿和哈哈</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师讲的很容易理解。视频中过滤掉的东西也有很关键的。对于初学者来说似乎有点过滤的太多。</div> <span class="time">2018-11-07</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">这部分内容在第2部分的进程结构里会再说到的，比如信号的发送，热部署的流程等等，再对照着看应该就更清晰了</p> <p class="reply-time">2018-11-07</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/12/59/89859f03.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">张营</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">买了你的书，但是没有看完这次一定跟着学完!</div> <span class="time">2018-11-06</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">谢谢，用好nginx一定对你有帮助的！</p> <p class="reply-time">2018-11-06</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/ef/10/2a3eaf65.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Dante.Fung</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">干货，涨姿势</div> <span class="time">2018-11-06</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">谢谢</p> <p class="reply-time">2018-11-06</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/c3/1f/2533f4a4.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">比小白兔还白的小白</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">为何每次到输命令的时候视频就过得很快。。。而且命令kill USR2  和 WINCH什么意思啊？</div> <span class="time">2018-11-05</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">我们的剪辑老师考虑到输命令以及执行的时间比较长,所以就没有显示过程。我会向剪辑老师反馈。<br><br>另外，USR2和WINCH是信号，而kill是linux提供的一个命令，用来对nginx进程发送信号。<br><br>USR2信号用于告诉nginx更换新的二进制文件，而WINCH用于告诉同时并存的新老nginx中的老nginx，停止对外服务，关掉worker进程。在第二部分我会详述热部署流程。<br><br>nginx的命令行可以发信号，但有些信号nginx还不支持，比如热部署时，只能手动用kill发信号。在第二部分的进程信号一节中，我会详细再解释信号与命令行的关系 。</p> <p class="reply-time">2018-11-06</p>
	</div>
</div>
</li></ul></div></div><div data-v-4e11b9bf=""></div></div></div><link href="https://cdn.bootcss.com/dplayer/1.25.0/DPlayer.min.css" rel="stylesheet"><script src="https://cdn.bootcss.com/hls.js/0.10.1/hls.min.js"></script><script src="https://cdn.bootcss.com/dplayer/1.25.0/DPlayer.min.js"></script><script>            const dp = new DPlayer({                container: document.getElementById('DplayerCont'),                video: {                    url: 'https://res001.geekbang.org/media/video/70/18/704eb79ce9735c6ffddc88bf24315618/hd/hd.m3u8',                    type: 'hls'                }            });</script></body></html>