<html class="cye-disabled cye-lm"><head><meta charset="utf-8"><link rel="apple-touch-icon" sizes="180x180" href="http://static001.geekbang.org/static/icon/time/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="http://static001.geekbang.org/static/icon/time/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="http://static001.geekbang.org/static/icon/time/favicon-16x16.png"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,viewport-fit=cover"><meta name="format-detection" content="telephone=no"><title>02  | 日志系统：一条SQL更新语句是如何执行的？</title><link href="https://static001.geekbang.org/static/time/css/app.b230db929e53af87acd535637f5011b8.css" rel="stylesheet"><style id="nightModeStyle">    html.cye-enabled.cye-nm:not(*:-webkit-full-screen) body,html.cye-enabled.cye-nm:not(*:-webkit-full-screen) #cye-workaround-body {-webkit-filter:contrast(91%) brightness(84%) invert(1);}</style><style id="cyebody">html.cye-enabled.cye-lm body{background-color:#cce8cf !important;border-color:rgb(51, 58, 51) !important;background-image:none !important;color:#000000  !important}</style><style id="cyediv">html.cye-enabled.cye-lm div{background-color:#cce8cf !important;border-color:rgb(51, 58, 51) !important;background-image:none !important;color:#000000  !important}</style><style id="cyetable">html.cye-enabled.cye-lm th{background-color:#cce8cf !important;border-color:rgb(51, 58, 51) !important;background-image:none !important;color:#000000  !important}html.cye-enabled.cye-lm td{background-color:#cce8cf !important;border-color:rgb(51, 58, 51) !important;background-image:none !important;color:#000000  !important}</style><style id="cyetextInput">html.cye-enabled.cye-lm input[type=text]{background-color:#cce8cf !important;border-color:rgb(51, 58, 51) !important;background-image:none !important;color:#000000  !important}html.cye-enabled.cye-lm textarea{background-color:#cce8cf !important;border-color:rgb(51, 58, 51) !important;background-image:none !important;color:#000000  !important}</style><style id="cyeselect">html.cye-enabled.cye-lm select{background-color:#cce8cf !important;border-color:rgb(51, 58, 51) !important;background-image:none !important;color:#000000  !important}</style><style id="cyeul">html.cye-enabled.cye-lm ul{background-color:#cce8cf !important;border-color:rgb(51, 58, 51) !important;background-image:none !important;color:#000000  !important}</style><style id="cyeChangeByClick">html.cye-enabled.cye-lm .cye-lm-tag,html.cye-enabled.cye-lm.cye-lm-tag{background-color:#cce8cf !important;border-color:rgb(51, 58, 51) !important;background-image:none !important;color:#000000  !important}</style><style type="text/css">    .hljs-ln {      border-collapse: collapse    }    .hljs-ln td {      padding: 0    }    .hljs-ln-n:before {      content: attr(data-line-number)    }</style><style type="text/css">    #iv-container {      position: fixed;      background: #0d0d0d;      width: 100%;      height: 100%;      top: 0;      left: 0;      display: none;      z-index: 1000    }    .iv-container {      overflow: hidden    }    .iv-close {      width: 26px;      height: 26px;      position: absolute;      right: 20px;      top: 20px;      cursor: pointer;      text-align: center;      overflow: hidden;      text-shadow: 0 0 3px #6d6d6d;      -webkit-transition: all .2s ease;      -moz-transition: all ease .2s;      -o-transition: all ease .2s;      transition: all .2s ease    }    .iv-close:after,    .iv-close:before {      content: "";      height: 2px;      width: 26px;      background: #fff;      position: absolute;      left: 0;      top: 50%;      margin-top: -2px;      border-radius: 2px    }    .iv-close:before {      -webkit-transform: rotate(45deg);      -moz-transform: rotate(45deg);      -ms-transform: rotate(45deg);      -o-transform: rotate(45deg);      transform: rotate(45deg)    }    .iv-close:after {      -webkit-transform: rotate(-45deg);      -moz-transform: rotate(-45deg);      -ms-transform: rotate(-45deg);      -o-transform: rotate(-45deg);      transform: rotate(-45deg)    }    .iv-close:hover {      -webkit-transform: rotate(90deg);      -moz-transform: rotate(90deg);      -ms-transform: rotate(90deg);      -o-transform: rotate(90deg);      transform: rotate(90deg)    }    .iv-image-view {      position: absolute;      height: 100%;      width: 100%    }    .iv-image-wrap {      display: inline-block    }    .iv-image-wrap:active {      cursor: move    }    .iv-large-image {      cursor: move;      max-width: 100%;      max-height: 100%;      background-color: #ececec;      -moz-transform: translateZ(0);      -o-transform: translateZ(0)    }    .iv-large-image,    .iv-loader {      position: absolute;      -webkit-transform: translateZ(0);      -ms-transform: translateZ(0);      transform: translateZ(0)    }    .iv-loader {      top: 50%;      left: 50%;      border-radius: 50%;      width: 32px;      height: 32px;      z-index: 100;      margin-top: -16px;      margin-left: -16px;      font-size: 5px;      text-indent: -9999em;      border-top: 1em solid hsla(0, 0%, 100%, .2);      border-right: 1em solid hsla(0, 0%, 100%, .2);      border-bottom: 1em solid hsla(0, 0%, 100%, .2);      border-left: 1em solid #fff;      -webkit-animation: load8 1.1s infinite linear;      animation: load8 1.1s infinite linear    }    .iv-loader:after {      width: 10em;      height: 10em;      border-radius: 50%    }    @-webkit-keyframes load8 {      0% {        -webkit-transform: rotate(0deg);        transform: rotate(0deg)      }      to {        -webkit-transform: rotate(1turn);        transform: rotate(1turn)      }    }    @keyframes load8 {      0% {        -webkit-transform: rotate(0deg);        transform: rotate(0deg)      }      to {        -webkit-transform: rotate(1turn);        transform: rotate(1turn)      }    }</style><style type="text/css">    .vue-pull-to-wrapper[data-v-12abd9fb] {      display: -webkit-box;      display: -webkit-flex;      display: flex;      -webkit-box-orient: vertical;      -webkit-box-direction: normal;      -webkit-flex-direction: column;      flex-direction: column;      height: 100%    }    .scroll-container[data-v-12abd9fb] {      -webkit-box-flex: 1;      -webkit-flex: 1;      flex: 1;      overflow-y: auto;      -webkit-overflow-scrolling: touch    }    .vue-pull-to-wrapper .action-block[data-v-12abd9fb] {      position: relative;      width: 100%    }    .default-text[data-v-12abd9fb] {      height: 100%;      line-height: 50px;      text-align: center    }</style><style type="text/css">    .button-cancel[data-v-87ffcada] {      color: #888;      border: 1px solid #888;      border-radius: 3px;      margin-right: 12px    }    .button-cancel[data-v-87ffcada],    .button-primary[data-v-87ffcada] {      -webkit-box-flex: 1;      -ms-flex-positive: 1;      flex-grow: 1;      height: 35px;      display: inline-block;      font-size: 15px;      text-align: center;      line-height: 36px    }    .button-primary[data-v-87ffcada] {      color: #fff;      background-color: #ff5a05;      border-radius: 3px    }    .article[data-v-87ffcada] {      max-width: 46.25rem;      margin: 0 auto    }    .article .article-unavailable[data-v-87ffcada] {      color: #fff;      text-align: center;      font-size: .875rem;      font-weight: 400;      width: 100%;      -webkit-box-sizing: border-box;      box-sizing: border-box;      padding: 0 15%;      height: 4.9rem;      background-image: url(data:image/jpeg;base64,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);      background-position: 0 0;      background-repeat: no-repeat;      background-size: cover;      display: -webkit-box;      display: -ms-flexbox;      display: flex;      -webkit-box-orient: vertical;      -webkit-box-direction: normal;      -ms-flex-direction: column;      flex-direction: column;      -webkit-box-align: center;      -ms-flex-align: center;      align-items: center;      -webkit-box-pack: center;      -ms-flex-pack: center;      justify-content: center    }    .article .main[data-v-87ffcada] {      padding: 1.25rem 1.375rem;      margin-top: 52px;      margin-bottom: 52px    }    .article-title[data-v-87ffcada] {      color: #353535;      font-weight: 400;      line-height: 1.65rem;      font-size: 1.34375rem    }    .article-info[data-v-87ffcada] {      color: #888;      font-size: .9375rem;      margin-top: 1.0625rem    }    .article-content[data-v-87ffcada] {      margin-top: 1.0625rem    }    .article-content.android video[data-v-87ffcada]::-webkit-media-controls-fullscreen-button {      display: none    }    .audio-player[data-v-87ffcada] {      width: 100%;      margin: 20px 0    }    .to-comment[data-v-87ffcada] {      overflow: hidden;      margin-bottom: -30px    }    .to-comment a.button-primary[data-v-87ffcada] {      float: right;      height: 20px;      font-size: 12px;      line-height: 20px;      padding: 4px 8px;      cursor: pointer    }    .article-comments[data-v-87ffcada] {      margin-top: 2rem    }    .article-comments h2[data-v-87ffcada] {      text-align: center;      color: #888;      position: relative;      z-index: 1;      margin-bottom: 1rem    }    .article-comments h2[data-v-87ffcada]:before {      border-top: 1px dotted #888;      content: "";      position: absolute;      top: 56%;      left: 0;      width: 100%;      z-index: -1    }    .article-comments h2 span[data-v-87ffcada] {      font-size: 15.25px;      font-weight: 400;      padding: 0 1rem;      background: #fff;      display: inline-block    }    .article-sub-bottom[data-v-87ffcada] {      z-index: 10;      cursor: pointer    }    @media (max-width:769px) {      .article .breadcrumb[data-v-87ffcada] {        padding: 10px 0      }    }</style><style type="text/css">    .share-poster-wrapper {      position: fixed;      background-color: #fff;      left: 0;      bottom: 0;      z-index: 100;      display: -webkit-box;      display: -ms-flexbox;      display: flex;      overflow: hidden;      width: 100%;      -webkit-box-orient: vertical;      -webkit-box-direction: normal;      -ms-flex-direction: column;      flex-direction: column;      -moz-user-select: -moz-none;      -webkit-user-select: none;      -ms-user-select: none;      user-select: none    }    .share-poster-wrapper .poster-bottom,    .share-poster-wrapper .poster-middle,    .share-poster-wrapper .poster-top {      -ms-flex-negative: 0;      flex-shrink: 0    }    .share-poster-wrapper .poster-middle {      padding: 16px 32px;      -webkit-box-sizing: border-box;      box-sizing: border-box    }    .share-poster-wrapper .poster-middle .poster-userinfo {      display: -webkit-box;      display: -ms-flexbox;      display: flex;      -webkit-box-align: center;      -ms-flex-align: center;      align-items: center;      padding-bottom: 18px    }    .share-poster-wrapper .poster-middle .poster-userinfo .poster-avatar {      min-width: 45px;      min-height: 45px;      width: 7vw;      height: 7vw;      border-radius: 50%;      -ms-flex-negative: 0;      flex-shrink: 0    }    .share-poster-wrapper .poster-middle .nickname {      font-size: 5vw;      font-weight: 400;      margin-left: 18px    }    .share-poster-wrapper .poster-middle .time {      font-size: 3.2vw    }    .share-poster-wrapper .poster-middle .poster-middle-content {      font-size: 4vw;      font-weight: 400;      white-space: normal;      word-wrap: break-word;      word-break: break-word;      letter-spacing: 1px    }    .share-poster-wrapper .poster-middle .poster-middle-content p {      margin-bottom: 22px    }    .share-poster-wrapper .poster-middle .quote-content {      font-size: 3.7vw;      padding: 32px 0    }    .share-poster-wrapper .poster-middle .quote-content p {      margin-bottom: 22px    }    .share-poster-wrapper .poster-middle .quote-info {      border-left: 1px solid #000;      padding-left: 10px;      margin-top: 38px    }    .share-poster-wrapper .poster-middle .quote-info p {      font-size: 3.2vw;      line-height: 1.5    }    .share-poster-wrapper.theme0 .poster-top {      width: 100%;      height: 25px;      margin-top: 27px;      background: url("https://static001.geekbang.org/static/time/page/img/sharePoster/theme1/top.png") no-repeat 15px 1px    }    .share-poster-wrapper.theme0 .poster-middle {      width: 100%;      padding-left: 56px;      padding-right: 56px;      background-image: url("https://static001.geekbang.org/static/time/page/img/sharePoster/theme1/middle.png");      background-repeat: repeat-y;      background-position: 15px 0    }    .share-poster-wrapper.theme0 .poster-middle .time {      margin-bottom: 45px    }    .share-poster-wrapper.theme0 .poster-middle .quote-content {      border-top: 1px solid #e3e1dc;      margin-top: 30px    }    .share-poster-wrapper.theme0 .poster-bottom {      width: 100%;      height: 25px;      margin-bottom: 27px;      background: url("https://static001.geekbang.org/static/time/page/img/sharePoster/theme1/bottom.png") no-repeat 15px -10px    }    .share-poster-wrapper.theme1 .poster-top {      width: 100%;      height: 25px;      margin-top: 27px;      background: url("https://static001.geekbang.org/static/time/page/img/sharePoster/theme0/top.png") no-repeat 38px 1px    }    .share-poster-wrapper.theme1 .poster-middle {      width: 100%;      padding: 0 42px 10px;      background: url("https://static001.geekbang.org/static/time/page/img/sharePoster/theme0/middle.png") repeat-y 38px 0    }    .share-poster-wrapper.theme1 .poster-middle .poster-userinfo {      border-bottom: 1px solid #b5a899    }    .share-poster-wrapper.theme1 .poster-middle .poster-userinfo .poster-avatar {      margin-left: 38px    }    .share-poster-wrapper.theme1 .poster-middle .poster-middle-wrapper {      display: -webkit-box;      display: -ms-flexbox;      display: flex;      -webkit-box-orient: horizontal;      -webkit-box-direction: normal;      -ms-flex-direction: row;      flex-direction: row;      min-height: 260px;      border-bottom: 1px solid #b5a899    }    .share-poster-wrapper.theme1 .poster-middle .time {      max-width: 65px;      display: -webkit-box;      display: -ms-flexbox;      display: flex;      -webkit-box-orient: vertical;      -webkit-box-direction: normal;      -ms-flex-direction: column;      flex-direction: column;      -webkit-box-pack: center;      -ms-flex-pack: center;      justify-content: center;      -webkit-box-align: center;      -ms-flex-align: center;      align-items: center;      text-align: center;      vertical-align: middle;      border-right: 1px solid #b5a899    }    .share-poster-wrapper.theme1 .poster-middle .time span {      white-space: nowrap;      -webkit-transform: rotate(90deg);      transform: rotate(90deg)    }    .share-poster-wrapper.theme1 .poster-middle .poster-middle-content {      padding: 30px    }    .share-poster-wrapper.theme1 .poster-middle .quote-content {      font-size: 3.7vw;      margin-left: 36px;      margin-right: 36px    }    .share-poster-wrapper.theme1 .poster-middle .quote-info {      margin-left: 36px;      margin-right: 36px    }    .share-poster-wrapper.theme1 .poster-middle .footer {      display: -webkit-box;      display: -ms-flexbox;      display: flex;      -webkit-box-orient: horizontal;      -webkit-box-direction: normal;      -ms-flex-direction: row;      flex-direction: row;      margin-right: 30px    }    .share-poster-wrapper.theme1 .poster-bottom {      width: 100%;      height: 25px;      margin-bottom: 27px;      background: url("https://static001.geekbang.org/static/time/page/img/sharePoster/theme0/bottom.png") no-repeat 38px -10px    }    .share-poster-wrapper .share-poster {      background: #fefdf8;      -webkit-box-sizing: border-box;      box-sizing: border-box;      color: #9b8d73;      -webkit-box-flex: 1;      -ms-flex-positive: 1;      flex-grow: 1;      overflow: auto;      display: -webkit-box;      display: -ms-flexbox;      display: flex;      -webkit-box-orient: vertical;      -webkit-box-direction: normal;      -ms-flex-direction: column;      flex-direction: column;      -webkit-overflow-scrolling: touch;      -webkit-box-align: center;      -ms-flex-align: center;      align-items: center    }    .share-poster-wrapper .share-poster.color0 {      background-color: #fefdf8    }    .share-poster-wrapper .share-poster.color1 {      background-color: #4d4d4d    }    .share-poster-wrapper .share-poster .footer {      margin-top: 2rem;      position: relative;      display: -webkit-box;      display: -ms-flexbox;      display: flex;      -webkit-box-orient: horizontal;      -webkit-box-direction: normal;      -ms-flex-direction: row;      flex-direction: row;      -webkit-box-pack: end;      -ms-flex-pack: end;      justify-content: flex-end;      -webkit-box-align: end;      -ms-flex-align: end;      align-items: flex-end    }    .share-poster-wrapper .share-poster .footer p {      margin: 0;      line-height: 1.4;      margin-left: 20px;      text-align: right;      padding-right: 20px    }    .share-poster-wrapper .controls {      background: #fff;      border-top: 1px solid #f5f5f5;      width: 100%;      padding-top: 5px;      -webkit-box-shadow: 0 -4px 10px 0 rgba(0, 0, 0, .1);      box-shadow: 0 -4px 10px 0 rgba(0, 0, 0, .1);      z-index: 1;      -ms-flex-negative: 0;      flex-shrink: 0    }    .share-poster-wrapper .controls>div {      display: -webkit-box;      display: -ms-flexbox;      display: flex;      -webkit-box-orient: horizontal;      -webkit-box-direction: normal;      -ms-flex-direction: row;      flex-direction: row;      -webkit-box-pack: center;      -ms-flex-pack: center;      justify-content: center;      -webkit-box-align: center;      -ms-flex-align: center;      align-items: center;      padding: 10px 0    }    .share-poster-wrapper .controls>div span {      font-size: .85rem    }    .share-poster-wrapper .controls>div button {      width: 100px;      height: 24px;      background: #eee;      margin: 0 10px;      border-radius: 5px;      border: 2px solid #b2b2b2;      outline: none    }    .share-poster-wrapper .controls>div button.on {      border: 2px solid #ff5a05    }    .share-poster-wrapper .controls .controls-themes button {      color: #b2b2b2;      font-size: 12px;      background: #fff;      text-align: center    }    .share-poster-wrapper .controls .controls-themes button.on {      color: #ff5a05    }    .share-poster-wrapper .buttons {      background: #fff;      border-top: 1px solid #f5f5f5;      display: -webkit-box;      display: -ms-flexbox;      display: flex;      -webkit-box-orient: horizontal;      -webkit-box-direction: normal;      -ms-flex-direction: row;      flex-direction: row;      -ms-flex-negative: 0;      flex-shrink: 0    }    .share-poster-wrapper .buttons a {      -webkit-box-flex: 1;      -ms-flex-positive: 1;      flex-grow: 1;      text-align: center;      color: #000;      font-weight: 400;      height: 3rem;      line-height: 3rem    }    .share-poster-wrapper .buttons a:last-child {      border-left: 1px solid #f5f5f5    }    .share-poster-wrapper img {      max-width: 100%    }    .share-poster-wrapper.android .poster-middle .nickname {      font-size: 10vw    }    .share-poster-wrapper.android .poster-middle .time {      font-size: 6.4vw    }    .share-poster-wrapper.android .poster-middle .poster-middle-content {      font-size: 8vw    }    .share-poster-wrapper.android .poster-middle .quote-content {      font-size: 7.4vw    }    .share-poster-wrapper.android .poster-middle .quote-info p {      font-size: 6.4vw    }</style><style type="text/css">    .mobile-tips {      width: 100%;      height: 51px;      background: rgba(0, 0, 0, .8);      position: fixed;      top: 0;      left: 0;      z-index: 20;      display: -webkit-box;      display: -ms-flexbox;      display: flex;      -webkit-box-orient: horizontal;      -webkit-box-direction: normal;      -ms-flex-direction: row;      flex-direction: row;      -webkit-box-align: center;      -ms-flex-align: center;      align-items: center;      -webkit-box-pack: justify;      -ms-flex-pack: justify;      justify-content: space-between;      -webkit-box-sizing: border-box;      box-sizing: border-box;      padding: 0 12px;      -webkit-transition: opacity .35s;      transition: opacity .35s;      opacity: 0;      pointer-events: none    }    .mobile-tips.istop {      opacity: 1;      pointer-events: auto    }    .mobile-tips .mobile-tips-info {      display: -webkit-box;      display: -ms-flexbox;      display: flex;      -webkit-box-orient: horizontal;      -webkit-box-direction: normal;      -ms-flex-direction: row;      flex-direction: row;      -webkit-box-align: center;      -ms-flex-align: center;      align-items: center;      -webkit-box-pack: start;      -ms-flex-pack: start;      justify-content: flex-start    }    .mobile-tips .mobile-tips-info i {      width: 36px;      height: 36px;      background-image: url(data:image/png;base64,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);      background-position: 0 0;      background-repeat: no-repeat;      background-size: contain;      border-radius: 7px    }    .mobile-tips .mobile-tips-info h2 {      font-size: 15px;      color: #fff;      font-weight: 400;      margin-left: 6px    }    .mobile-tips .mobile-tips-info h2 span {      font-size: 11px    }    .mobile-tips a {      width: 72px;      height: 31px;      text-align: center;      border: 1px solid #ff5a05;      border-radius: 3px;      font-size: 13px;      color: #ff5a05;      line-height: 31px    }</style><style type="text/css">    .mini-audio-player {      width: 100%;      height: 5.25rem;      border: 1px solid #d9d9d9;      background: #fafafa;      -webkit-box-sizing: border-box;      box-sizing: border-box;      padding: 1rem;      display: -webkit-box;      display: -ms-flexbox;      display: flex;      -webkit-box-orient: horizontal;      -webkit-box-direction: normal;      -ms-flex-direction: row;      flex-direction: row;      -webkit-box-align: center;      -ms-flex-align: center;      align-items: center;      -webkit-box-pack: justify;      -ms-flex-pack: justify;      justify-content: space-between;      margin: 1rem 0    }    .mini-audio-player>a {      border: none;      -ms-flex-negative: 0;      flex-shrink: 0    }    .mini-audio-player .btn-play {      background-image: url(data:image/png;base64,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)    }    .mini-audio-player .btn-pause,    .mini-audio-player .btn-play {      width: 2.6875rem;      height: 2.6875rem;      background-repeat: no-repeat;      background-position: 0 0;      background-size: contain;      text-decoration: none    }    .mini-audio-player .btn-pause {      background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAI0AAACNCAYAAACKXvmlAAABS2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxMzggNzkuMTU5ODI0LCAyMDE2LzA5LzE0LTAxOjA5OjAxICAgICAgICAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSJyIj8+IEmuOgAAEiNJREFUeJztnXmUFdWZwH+3XtMuhKVBxYyCECQzQFgUWVT0qCROdCJqTIxxyTYxc2aixMgZ0RDGcwyajiYYEzw5ExOTQ+KSmLiOS0yCoATFREODSgaQ/YwQhIbuNKQbXtX88VV5b3W/pV53vXpV3fd3zu2+tb13697v3fW736caGxvpIyjgA8AYYKQfhgPHAMcCQ4EB/r0DgDrgMNDqn2sF9gC7gXeB7cAWP2wANgFeld8hFdTVOgFV5IPATGAGMAH4EPC+Cj+jDmjw4w3AiBL3/g14E1gDvAKsANZX+H2ZoDcJzYnAR/1wNlJ7JMn7gOl+uNY/txt4EXjODzsSTlNVyLrQjAY+BXwSmBzh/r8Cb6GblU1IU7PHv7bfv68VaZrq0E3WIOA4pBk7BmnqRvphnH+tM8cCl/kBYDXwCPAL4O0I6U0lWRSaQcDVwGeBqSXu2wu8DKwE/gisBXZW+F2HgWY/3owIWjGGARP9NJ0BnA4M6XTPZD/c7qdpCfAztLBmApWhjvAU4HrgcuCoAtc7kH5E0BS8QW07pgrpRwVN5kygvsB9B5Ha53vAa4mlrgekXWgUcCEwFzi3wPUO4Hkk058g3b/YgcDFiNCfT2EBegG4G/gfUjwSc2qdgCIoYDbwZyQDOwvMWmAO8H7gIqSaT7PAALQgTdFFSLrnIO9hci7wJNL3mY3kQ+pIo9CcA7yK1ByTjPOHgYeRvsJE4PtIvyWL7EXSPxGZEngYeb+Aicj7v4rkR6pIk9CcDDyKVNGnGecPAt/1r38amQPpTaxC3utk5D0PGtdOQ/LjUf96KkiD0BwF3IZMjF1qnG9Hfo2jga8CW5NPWqJsRd5zNNIpbjeuXYrkz20UHgQkSq2FZibSfi9Adww94CFkRncO8E5tklYz3gG+grz/Q+gOcT2ST6uBs2qTNKFWQnMk8G1gOZI5AX9G5jiuBLbVIF1pYhuSD2cArxvnPwgsA76D5GPi1EJoxiHt+Fzj+9v846n0vj5LT3kFmIbkT5t/zgFuRDrK45JOUNJCczUyEzrROLcUWVBcBOQTTk9WyCP5MwHJr4AJSH5ek2RikhKafsBiZJ7iaP9cBzAP+AiwOaF0ZJ3NSH7NQ/IPJD+XIPnbL4lEJCE0DcCzwJeNc5uQtvpOwE0gDb0JF8m305F8DPgyks8NhR6Kk2oLzUjgJWCWce4ZZP4hE+ssKeZ1JB+fMc7NQvJ7ZDW/uJpCMwlZZR7vH3vAQmQavbnYQ5aKaEbyc6FxbjyS75MKPhED1RKaaUiH7Xj/uANRZViAbY7ixkXy9fPAIf/c8Uj+T6vGF1ZDaM4CfofWJWkFLkA6wZbq8VMknwOd5iFIOcQ+ERi30EwHnkJruzUjagBLiz5hiZPfI6OroPkfgJTH9Di/JE6hmYB0ygb5x7uRpX47WZcsq4DzkPwHKY9nkPKJhbiE5kTCTdI+ROKbYvp8S2WsRvJ/n388BKmFhsfx4XEITSDJgWJ1C6LeaAWmtjQh5dDiHx8LPI1uCbpNT4WmH6LrEVR9Hcgy/qoefq4lHlYh5RHMHk9AyqtHM8c9FZo7kfYz4IvYTm/aWAr8q3F8HlJu3aYnQnMFcINx3IgdVqeVnyPlE3ADUn7dortC80/Aj43jZ4H53U2EJRHmI+UU8GOkHCumO0JTDzyAXq3eBFyFnelNOy5STsHOzqOBBym8laYk3RGahcCpfrwD2cdj15KyQTOyjTnoGJ9CeN0qEpUKzZmIBlnAAuxqddZ4Dfi6cTwXKdfIVCI0RwD3Gc+8gOj5WrLHd9CjXAcp1yOiPlyJ0MwHxvrxNmR4bfsx2cRFyi/QOR5LBQOZqEIzGrjJOP4vwlpjluyxGeleBNxExA15UYXm2+jq6zXgnshJs6QZ01LFEcBdUR6KIjSzgEv8uIds5LK7BnoHeWRDYrAh7xLCM/wFKSc0ivBM4sPAH7qTOktqWYns5AxopIy1inJCMxu9Gb8duLnbSbOkmVvQe8enIuVelFJCo5AN5wE/xG6V7a1sQ8o34DZK1DalhGY2eifkAeCOHifNkmbuQMoZpNyL1jalhMZcwb6Pyo0cWrLFTuC/jeMbit1YzLrnaWgLTIeRfcSpZd7qm0HVgfL643ELOLNQjAP+DryI5y4Gdzl5T6a1qmKUTEE/B+BsUF8CdTpiOnYrnvcMnvcNHNqoy/Otcam1c/hdxBhmHVL+0xAjAyGK1TTXG/FHyUJfRnljILcO5cxHMQMxjHgc8AmUswzl3FyR6UMP+bkcihhcD1ALwFkO6irEzvBAYAJKzUM5bwIfSKcVvffYBvzaOL6u0E2FaprBiDHngFTXMgAo6kAtRwwgFsH5Jg5NwLMoStvOdBGFyJPykKP8YkkdsMu5iDbnNuqKfLBSJ4GzDDc/inTPc92NrIQDfAKZx9ln3lCoprkKbaJrLVnQ91XOdeC8v6QkKMBx7iXvwWEP8iWC6/9vU9FCq1K4uR/glJJEDzw1nHzu3+J+/ZhZhfh3AJGDKzvfUEhoPm/Ef1jgegpxLit7iwcoRpFT48g5lAx1DjgOtNRBcx3sLxFa6mBPbjLtnECuTBoUgHNpmbvSwH1G/AudL3YWmpMRy+AgijoPVilRcdMQyVazUqAYCR6oEsHxwPPgby60uNBaIuxzod07gZyKkAQPPG9YDO9bbR5AK2pNodNCZuc+zeVG/HmyY6c3uopGPq/KjqBySCd4L9L7KDUxcRgYgMeAXNgScLZpRsr/Y/7x5RjzdJ2zwxSaX1Q3XbESXWiUclFQMuD/7xcx5JRbwcgsKzpIZvmbchESmn9AzwAfQsytW/ouT6KbqEmIfABhobkA/Ttbgd7OaembtBDWaLgwiJhC889G3DTJZem7PG3Ezw8iptCcY8Sfr3ZqLJnAlINzCCYN/BP/iPb5uJeuLmUsfZM30CPoY/GtywdCY+57WUmKHVRZEsUj3K85E7TQmOa1rDqnxWSlEZ8OWmhMT7N2x6TFxJSHSSBC46Bt/YLtz1jCmPLwIWRVjlFAf//kLqyGniXMTrRM9AdGOYQXo9YlniRLFviLER/jELajvyXRpFiygrkFe5SDqCUGvI3F0hXTtdJIB7EBHLA94cRYsoGpIz7cQc8Eg+0EWwqzy4gf46CtjEN2lK4sybLHiA91gKFFLlosAWZlMsRBtqwEWIOLlkKYlUmDQ1hbNiuqiJYa4qDtAQMcrFVCLKmmzYj3dwg7V+jAYumKuc+izkH7PYSE/DpbMoe51emwg7ZJAuGmymIJ6G/E2xzCWnpJOHe3ZByHsEWAqnuPt2QScy6v2SE8Bh+CxdKV0KqBQ3i2bygWS1dCqwYO2hUvQBYsGliSx5SLdx1gh3FiRMKJsWQDUy62O4QVbEYnnBhLNhhlxLd0FpqRyabFkhFM7c4tDrDRODEWi6UrpoPU9UFNEyxIDQOOTzxJljRjykQbsNlB1CHeNG6akHSqLKlmohF/E3CDZYMm48IULBbNqUZ8Nei1JtNWcEWeUy29HlMeXgUtNCuMC2dQJe8BlsyhCAvNCtBCsx49MzwE2ehtsYxHrzvtRuTkPaHxgGXGzedjsYTtMC7HV6Mx9WdM+2r/kkSKLKnHlIPfBBFTaEyLnmcibmcsfZeBSP824D35MIXm/9BD73rKOL+09Hpmo32xNyHyAXRV7/ylEf8Ulr6MWf6mXHQRmkeM+PlkR/0z+hSB5yk8KBnw/0f1Kpf3VAUpyMJ0RgPhwVBIaDp7YdkAvI7MAtYjDsMWVzN1seCRi1QUHuDkcuKip8R9CvHEMkSV93npAvXkyEe0oqvKeoVKA1ci5Q8iD+aidkF3hD9BTx1fSxaEBvailPhoKoYL1HswgK2RN10cjODDSQEuO8gToQ5R4HnvRvvymvIlI/6TzhcLCc3PgTsRV3QTEduxKXdJ6D0OnFXyliOBfWxno7smkmltBxihZPtgOY+TitWo3E6iaQj8uvwtNWUaepHyICIPIQr95PYBvzKOvxp/umLGcxfjuTtL/tTrFbTk/50NHmyMEDZ54LhQ70JdmZBzPVT+P/DKtXneNnLuD+J+/Zgxy/tXdHJ6CsX9ci8GrvHjlyE6oul1s+x5HXjeTBRLKaTn7CloOXwjw9ynOYFoXVEPadIORLjfA5T7GLi3gPompjve96LeBsjPwnHT7H9uBOIhN+DeQjcVa9xfRS8r1FHCG3xqUOptvPxYPPd24I+Iv6JNwBLy+Rl47t2AuHePEtqDz43y3cEftxHPPRvPewi8rUALrvcKyrsVlR8HbE+514mvoCuSZRTplqjGxqLe6C8GHvfjBxClc2uTr/cyDPmRBfv5LwGeKHRjqWHEU2j/zEcDX4srdZZU8jW0wKxByr8gpYTGBW41jq8Fhvc4aZY0MpzwMPtWSlhFKzdh8QTaC8eRQNG2zJJpGpHyBSnvgs1SQDmh8YCbjeNPE175tGSf05FyDZhHmSnNKFOjv0N3iBXwPcjEVLilPDng++gx4uPA78s9FNWI0U3oQegUYE6lqbOkkjno3SftSDmXJarQbADuMo6/QXh/ryV7jELKMeAupJzLUom5tIVovz/9gR9V+LwlPTjAfWhben9Byjfyw1FpB76IHoqdB8yt4HlLepgLzPLjHjKd0l789jCV1hR/ABYZxwuBUyr8DEttOYVwrbKI8L63snSneZmPvz0TUdR5hLB/BUt6GYxo4QUKVqvpxkx/d4SmA9HsCuwPjwYe6OZnWZJDIeUU+Cw9gGhmVmylvrsFvQ5pBwMuBG7v5mdZkmEhUk4B1wJvdeeDelI7PAjcYxzPQyTXkj6uAm4xju9Byq9b9LRJ+U9gqR9XwP3IqMqSHs5DyiWY9V1KxEm8YvRUaA4BH0d7ia8HHkP0ii21ZzrwKLrjuxYprx5524mj87ofuAhtdWIg8BxhC0qW5JmElMMg/3g3oli3v6cfHNeIZyvwYbQ7w8HIQuekmD7fUhmTgd+ip0KakfLZXPSJCohzmLwGuADRzQVx3fwCtqlKmulIvyVwnd2ClMuaok9USNxzK6uQpqrVP25AJP7cmL/HUphZSH4H26lbkfKIdd9aNSbkXgQ+gm6qBiBt69VV+C6L5nOIOZAB/nEzUg4vxv1F1ZrFXYXULsHuhXpgCbIUb2eO48VB8vV+9ChpF5L/VdkZW80CbEJUQ4NZRwV8HdFyz4o1irQzGHgSyddgHuYtRIWzqdhDPaXav/rNwEykQxxwIbKZ7dSCT1iicirwJ8Imzl5A8juWUVIxkmgqmhGDf+YWz9HAy8jMpG2uKsNBZuJfJuw1514kn5sLPRR3ApLgEHAd8Bn06ng98C2kt29VR6MxCsmvO9H9lwPAZ5H8PVTkuVhJ+lf+M2AqetkBZG1kLWKtwO5yKEwOyZ+1hNf21iL5uSTJxNSiaXgLsYGyCK062t8/fhmYUYM0pZkZSL4sQuv0usDdSD52S72hJ9SqP/F3RE/1HHwr2D5TgZXIsn1fd404AsmHlUi+BKxHhtM3IvmYOLXuhL6ErJMsRK+8KmTH33pE76Ov+Z86Hnnv/0XyIRhKdyD5NJkqTNhVQq2FBsRE1wLEDv9jxvkjkM1cm5Cq+KTkk5YoJyHv+Tby3kca1x5D8mcBkl81JQ1CE7AR0fWYhcw/BByFGFXaCDyEtOO9iWnIe21E3vNo49qfkNXpj9PJwmYtSZPQBCxFMvISwiuzdcAVyNR4EzLEzOrMcgOS/ibkfa4gbMpuDXApkg9l91YnTRqFBmQD1xPIHp2Lkb6PyURk4/pOZFniGtLvy2Egks6ngHeQ9HdWVHsJed9TkM34qTS2VsxQY1pwkbWVJ5ERxPWIIcGj/Ov1wMf80IFs+nrOD29Q20xXiN+sj/phJnpCzuQgYkVzMb7ntrRTyuZeWhmMqFl8jtL+Nvciw9UViKGeNcBfq5iu45CaYwrixeZMtIOtQrwG/BSx09vF7GqayaLQmIwBPumHyRHu34V4fN1ihN3AHkSgAq3D/Ugt56B1bAcigjEU0YobaYTxiKHDcqxGapVfEtFCQxpJe/NUjg3AHX44Ed0UnI1WdzQZRrTCjYvdyJxK0GTuSPC7q0bWhcZkB2L+5Ef+8VhEr2QGouA+Hj0NXw3akFqsCXgFmfpfV8Xvqxm9SWg6s84P9/vHDrJKPAbdrAwHjkFqpaFoVclB/v0uestHK9KM7QbeBbajm7iNyCRkUYuYvYn/B8j3LlZxsulHAAAAAElFTkSuQmCC)    }    .mini-audio-player .audio-info {      display: -webkit-box;      display: -ms-flexbox;      display: flex;      -webkit-box-flex: 1;      -ms-flex-positive: 1;      flex-grow: 1;      -webkit-box-orient: vertical;      -webkit-box-direction: normal;      -ms-flex-direction: column;      flex-direction: column;      margin-left: .6875rem;      min-width: 0    }    .mini-audio-player .audio-info h3 {      color: #353535;      font-size: 15.25px;      margin: 0;      white-space: nowrap;      overflow: hidden;      text-overflow: ellipsis    }    .mini-audio-player .audio-info p {      margin: 0;      margin-top: .125rem;      font-size: 11px;      line-height: 1rem    }    .mini-audio-player .audio-info p span {      color: #888    }    .mini-audio-player .btn-download {      width: 1.25rem;      height: 1.25rem;      position: relative;      background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAA+CAYAAACbQR1vAAABS2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxMzggNzkuMTU5ODI0LCAyMDE2LzA5LzE0LTAxOjA5OjAxICAgICAgICAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSJyIj8+IEmuOgAAA4hJREFUaIHtm8lOFFEUhr9qCWGHGxcaY1joK2h0YRzAtYmsWbAGGidEXOACbAYRxfgAPoEPoInGxJgg86gsJTHMw86EhS7O7TDk3uqq6qo6HahvQ7pOce7//1U0feve9vr6+lAiD3QC/4AC8FZDRJXGoMB14PWB1yPANPA1bSG5tAc0XLEcu5y6CvQCOGU5pnI3agVQMWQBaAvQJgtAW4A2WQDaArTJAtAWoE0WgLYAbbIAtAVokwWgLUCbLABtAdpkAfjU6oC7wKV0pCTCRcRDnesEVwDNwC/gg/nZHbeyFOgGltj30Gw7yRZALfAOqDavPeA50BO7xOToQTR75nU14qn26Im2AM4DNZbjz4DeePQlSi+i9Sg1iLdD2AJYApYdzbuo7BBeIBptLCPeDmELYA9oBHYdjbqQpaxKowA8ddR2gXuIt0O43gRHgTu4Q+ikskIoIJps7AINwA9b0e/fYJAQ1FZWD9CP2/wOUI/DPJT+IDRqGrhCeGIEaNEPdDhqO8iVH/NrEOST4BgSwo6j3gEMBOgTNwP4m6+nhHkI/lG4VAiPgcGAveJg0IxpYxvROh6kUZi5wLhpvO2oPyKdEF6asWyEMg/hJ0PjyN+VXwhDIXuGYQh46KhtIeYnwjSMMhss3glbjvoDkglhyPS2Eck8RJ8OTyB3gl8IryL2tjGM2/wmYn4ySuNyngdMmIE3HfX7iHDPUQ+CZ3q0O+qbyIWIZB7KfyAyaQS4QmhH7oQoIZQyv0EZV75IHE+EJvG/E9oJfyd4yC6yvKO+gQQ/FaKnlbgeiU0hIWw46nnEUJAQiubbHPV1M1bZ5iHeZ4KlQmgD3uAfgofsGfQz34DsKYyFuLemTSMhfATOWOqtiMk/llrRfIuj9zpwG5gtX+Y+SezNK4bwCXsILdgDaAXOOnomYh6Seyw+gwhed9TPWY75mb9FAuYh2XWBWUS4K4QgrAE3gblYFFlIemFkDjEQJYQ1JMD5WBUdIY2VoXkkhLUQv7NqfidR85De0liYEFaRK7+QqCJDmmuDC0gIqz7nrJhzUjEP6S+O+oWwglz5xTQFaawOLwI3gO8Hjo2ZY6maB72vzPwErgEXkO8MuVaiEkcrgCK/lcfPNkhkAWgL0KYKmZiMIG9Ktn0Bx5G/wDcgXwW8R6avJ41G4HQOufInlas5ZO5+UpnJAU3AFyy7J44xe8BnoOk/JruwYo92bigAAAAASUVORK5CYII=);      background-repeat: no-repeat;      background-position: 0 0;      background-size: contain;      text-decoration: none;      padding-right: .25rem    }    .mini-audio-player .btn-download .icon-download-done {      width: .45rem;      height: .45rem;      position: absolute;      bottom: 0;      right: 0;      display: inline-block;      background-image: url(data:image/png;base64,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);      background-repeat: no-repeat;      background-position: 0 0;      background-size: contain    }</style><style type="text/css">    .MathJax_Display {      overflow: auto    }    .poster {      position: fixed;      left: -10000px;      top: -10000px;      overflow: hidden;      padding: 1rem;      background: #ececec    }    .richcontent-pre-copy {      font-size: 13px;      color: #888;      position: absolute;      right: 1em;      top: .2em;      cursor: pointer;      -webkit-user-select: none;      -moz-user-select: none;      -ms-user-select: none;      user-select: none    }    .richcontent-pre-copy .iconfont {      font-size: 12px;      margin-right: .2em    }</style><style type="text/css">    .comment-item {      list-style-position: inside;      width: 100%;      display: -webkit-box;      display: -ms-flexbox;      display: flex;      -webkit-box-orient: horizontal;      -webkit-box-direction: normal;      -ms-flex-direction: row;      flex-direction: row;      margin-bottom: 1rem    }    .comment-item a {      border-bottom: none    }    .comment-item .avatar {      width: 2.625rem;      height: 2.625rem;      -ms-flex-negative: 0;      flex-shrink: 0;      border-radius: 50%    }    .comment-item .info {      margin-left: .5rem;      -webkit-box-flex: 1;      -ms-flex-positive: 1;      flex-grow: 1    }    .comment-item .info .hd {      width: 100%;      display: -webkit-box;      display: -ms-flexbox;      display: flex;      -webkit-box-orient: horizontal;      -webkit-box-direction: normal;      -ms-flex-direction: row;      flex-direction: row;      -webkit-box-pack: justify;      -ms-flex-pack: justify;      justify-content: space-between;      -webkit-box-align: center;      -ms-flex-align: center;      align-items: center    }    .comment-item .info .hd .username {      color: #888;      font-size: 15.25px;      font-weight: 400;      line-height: 1.2    }    .comment-item .info .hd .control {      display: -webkit-box;      display: -ms-flexbox;      display: flex;      -webkit-box-orient: horizontal;      -webkit-box-direction: normal;      -ms-flex-direction: row;      flex-direction: row;      -webkit-box-align: center;      -ms-flex-align: center;      align-items: center    }    .comment-item .info .hd .control .btn-share {      color: #888;      font-size: .75rem;      margin-right: 1rem    }    .comment-item .info .hd .control .btn-praise {      display: -webkit-box;      display: -ms-flexbox;      display: flex;      -webkit-box-orient: horizontal;      -webkit-box-direction: normal;      -ms-flex-direction: row;      flex-direction: row;      -webkit-box-align: center;      -ms-flex-align: center;      align-items: center;      font-size: 15.25px;      text-decoration: none    }    .comment-item .info .hd .control .btn-praise i {      color: #888;      display: inline-block;      font-size: .75rem;      margin-right: .3rem;      margin-top: -.01rem    }    .comment-item .info .hd .control .btn-praise i.on,    .comment-item .info .hd .control .btn-praise span {      color: #ff5a05    }    .comment-item .info .bd {      color: #353535;      font-size: 15.25px;      font-weight: 400;      white-space: normal;      word-break: break-all;      line-height: 1.6    }    .comment-item .info .time {      color: #888;      font-size: 9px;      line-height: 1    }    .comment-item .info .reply .reply-hd {      font-size: 15.25px    }    .comment-item .info .reply .reply-hd span {      margin-left: -12px;      color: #888;      font-weight: 400    }    .comment-item .info .reply .reply-hd i {      color: #ff5a05;      font-size: 15.25px    }    .comment-item .info .reply .reply-content {      color: #353535;      font-size: 15.25px;      font-weight: 400;      white-space: normal;      word-break: break-all    }    .comment-item .info .reply .reply-time {      color: #888;      font-size: 9px    }</style><style type="text/css">    .breadcrumb {      padding: 30px 0;      display: -webkit-box;      display: -ms-flexbox;      display: flex;      -webkit-box-orient: horizontal;      -webkit-box-direction: normal;      -ms-flex-direction: row;      flex-direction: row;      -webkit-box-align: center;      -ms-flex-align: center;      align-items: center;      -ms-flex-wrap: wrap;      flex-wrap: wrap;      background: #fff    }    .breadcrumb a.title {      color: #e57c39;      font-size: 15px;      font-weight: 400    }    .breadcrumb span.title {      color: #888;      font-size: 15px;      font-weight: 400    }    .breadcrumb .split {      color: #ccc;      font-size: 10px;      margin-right: 5px    }</style></head><body style=""><div id="app"><div data-v-87ffcada="" class="article"><div data-v-87ffcada="" class="main main-app" style="margin-top: 0px;"><h1 data-v-87ffcada="" class="article-title">          02  | 日志系统：一条SQL更新语句是如何执行的？</h1><div data-v-87ffcada="" class="article-info"><span data-v-87ffcada="">2018-11-16</span><span data-v-87ffcada="">林晓斌</span></div><div data-v-87ffcada="" class="article-content typo common-content"><img data-v-87ffcada="" src="https://static001.geekbang.org/resource/image/d0/ec/d05de7616d91d99c3afe11ebd66497ec.jpg"><div data-v-87ffcada="" class="mini-audio-player"><a href="javascript:;" class="btn-play"></a><div class="audio-info"><h3>02  | 日志系统：一条SQL更新语句是如何执行的？</h3><p><span>朗读人：秭明&nbsp;&nbsp;&nbsp;</span><span>00:15:07 | 8867</span></p></div><audio title="02  | 日志系统：一条SQL更新语句是如何执行的？" src="https://res001.geekbang.org/resource/audio/d7/a9/d717e876e054d27aeade4fc8f4f9fea9.mp3" controls="controls"></audio></div><div data-v-87ffcada="" id="article-content" class=""><div class="text">              <p>前面我们系统了解了一个查询语句的执行流程，并介绍了执行过程中涉及的处理模块。相信你还记得，一条查询语句的执行过程一般是经过连接器、分析器、优化器、执行器等功能模块，最后到达存储引擎。</p><p>那么，一条更新语句的执行流程又是怎样的呢？</p><p>之前你可能经常听DBA同事说，MySQL可以恢复到半个月内任意一秒的状态，惊叹的同时，你是不是心中也会不免会好奇，这是怎样做到的呢？</p><p>我们还是从一个表的一条更新语句说起，下面是这个表的创建语句，这个表有一个主键ID和一个整型字段c：</p><pre><code>mysql&gt; create table T(ID int primary key, c int);
</code></pre><p>如果要将ID=2这一行的值加1，SQL语句就会这么写：</p><pre><code>mysql&gt; update T set c=c+1 where ID=2;
</code></pre><p>前面我有跟你介绍过SQL语句基本的执行链路，这里我再把那张图拿过来，你也可以先简单看看这个图回顾下。首先，可以确定的说，查询语句的那一套流程，更新语句也是同样会走一遍。</p><p><img src="https://static001.geekbang.org/resource/image/0d/d9/0d2070e8f84c4801adbfa03bda1f98d9.png" alt=""></p><center><span class="reference">MySQL的逻辑架构图</span></center><p>你执行语句前要先连接数据库，这是连接器的工作。</p><p>前面我们说过，在一个表上有更新的时候，跟这个表有关的查询缓存会失效，所以这条语句就会把表T上所有缓存结果都清空。这也就是我们一般不建议使用查询缓存的原因。</p><p>接下来，分析器会通过词法和语法解析知道这是一条更新语句。优化器决定要使用ID这个索引。然后，执行器负责具体执行，找到这一行，然后更新。</p><!-- [[[read_end]]] --><p>与查询流程不一样的是，更新流程还涉及两个重要的日志模块，它们正是我们今天要讨论的主角：redo log（重做日志）和 binlog（归档日志）。如果接触MySQL，那这两个词肯定是绕不过的，我后面的内容里也会不断地和你强调。不过话说回来，redo log和binlog在设计上有很多有意思的地方，这些设计思路也可以用到你自己的程序里。</p><h1>重要的日志模块：redo log</h1><p>不知道你还记不记得《孔乙己》这篇文章，酒店掌柜有一个粉板，专门用来记录客人的赊账记录。如果赊账的人不多，那么他可以把顾客名和账目写在板上。但如果赊账的人多了，粉板总会有记不下的时候，这个时候掌柜一定还有一个专门记录赊账的账本。</p><p>如果有人要赊账或者还账的话，掌柜一般有两种做法：</p><ul>
<li>一种做法是直接把账本翻出来，把这次赊的账加上去或者扣除掉；</li>
<li>另一种做法是先在粉板上记下这次的账，等打烊以后再把账本翻出来核算。</li>
</ul><p>在生意红火柜台很忙时，掌柜一定会选择后者，因为前者操作实在是太麻烦了。首先，你得找到这个人的赊账总额那条记录。你想想，密密麻麻几十页，掌柜要找到那个名字，可能还得带上老花镜慢慢找，找到之后再拿出算盘计算，最后再将结果写回到账本上。</p><p>这整个过程想想都麻烦。相比之下，还是先在粉板上记一下方便。你想想，如果掌柜没有粉板的帮助，每次记账都得翻账本，效率是不是低得让人难以忍受？</p><p>同样，在MySQL里也有这个问题，如果每一次的更新操作都需要写进磁盘，然后磁盘也要找到对应的那条记录，然后再更新，整个过程IO成本、查找成本都很高。为了解决这个问题，MySQL的设计者就用了类似酒店掌柜粉板的思路来提升更新效率。</p><p>而粉板和账本配合的整个过程，其实就是MySQL里经常说到的WAL技术，WAL的全称是Write-Ahead Logging，它的关键点就是先写日志，再写磁盘，也就是先写粉板，等不忙的时候再写账本。</p><p>具体来说，当有一条记录需要更新的时候，InnoDB引擎就会先把记录写到redo log（粉板）里面，并更新内存，这个时候更新就算完成了。同时，InnoDB引擎会在适当的时候，将这个操作记录更新到磁盘里面，而这个更新往往是在系统比较空闲的时候做，这就像打烊以后掌柜做的事。</p><p>如果今天赊账的不多，掌柜可以等打烊后再整理。但如果某天赊账的特别多，粉板写满了，又怎么办呢？这个时候掌柜只好放下手中的活儿，把粉板中的一部分赊账记录更新到账本中，然后把这些记录从粉板上擦掉，为记新账腾出空间。</p><p>与此类似，InnoDB的redo log是固定大小的，比如可以配置为一组4个文件，每个文件的大小是1GB，那么这块“粉板”总共就可以记录4GB的操作。从头开始写，写到末尾就又回到开头循环写，如下面这个图所示。</p><p><img src="https://static001.geekbang.org/resource/image/b0/9c/b075250cad8d9f6c791a52b6a600f69c.jpg" alt=""></p><p>write pos是当前记录的位置，一边写一边后移，写到第3号文件末尾后就回到0号文件开头。checkpoint是当前要擦除的位置，也是往后推移并且循环的，擦除记录前要把记录更新到数据文件。</p><p>write pos和checkpoint之间的是“粉板”上还空着的部分，可以用来记录新的操作。如果write pos追上checkpoint，表示“粉板”满了，这时候不能再执行新的更新，得停下来先擦掉一些记录，把checkpoint推进一下。</p><p>有了redo log，InnoDB就可以保证即使数据库发生异常重启，之前提交的记录都不会丢失，这个能力称为<strong>crash-safe</strong>。</p><p>要理解crash-safe这个概念，可以想想我们前面赊账记录的例子。只要赊账记录记在了粉板上或写在了账本上，之后即使掌柜忘记了，比如突然停业几天，恢复生意后依然可以通过账本和粉板上的数据明确赊账账目。</p><h1>重要的日志模块：binlog</h1><p>前面我们讲过，MySQL整体来看，其实就有两块：一块是Server层，它主要做的是MySQL功能层面的事情；还有一块是引擎层，负责存储相关的具体事宜。上面我们聊到的粉板redo log是InnoDB引擎特有的日志，而Server层也有自己的日志，称为binlog（归档日志）。</p><p>我想你肯定会问，为什么会有两份日志呢？</p><p>因为最开始MySQL里并没有InnoDB引擎。MySQL自带的引擎是MyISAM，但是MyISAM没有crash-safe的能力，binlog日志只能用于归档。而InnoDB是另一个公司以插件形式引入MySQL的，既然只依靠binlog是没有crash-safe能力的，所以InnoDB使用另外一套日志系统——也就是redo log来实现crash-safe能力。</p><p>这两种日志有以下三点不同。</p><ol>
<li>
<p>redo log是InnoDB引擎特有的；binlog是MySQL的Server层实现的，所有引擎都可以使用。</p>
</li>
<li>
<p>redo log是物理日志，记录的是“在某个数据页上做了什么修改”；binlog是逻辑日志，记录的是这个语句的原始逻辑，比如“给ID=2这一行的c字段加1 ”。</p>
</li>
<li>
<p>redo log是循环写的，空间固定会用完；binlog是可以追加写入的。“追加写”是指binlog文件写到一定大小后会切换到下一个，并不会覆盖以前的日志。</p>
</li>
</ol><p>有了对这两个日志的概念性理解，我们再来看执行器和InnoDB引擎在执行这个简单的update语句时的内部流程。</p><ol>
<li>
<p>执行器先找引擎取ID=2这一行。ID是主键，引擎直接用树搜索找到这一行。如果ID=2这一行所在的数据页本来就在内存中，就直接返回给执行器；否则，需要先从磁盘读入内存，然后再返回。</p>
</li>
<li>
<p>执行器拿到引擎给的行数据，把这个值加上1，比如原来是N，现在就是N+1，得到新的一行数据，再调用引擎接口写入这行新数据。</p>
</li>
<li>
<p>引擎将这行新数据更新到内存中，同时将这个更新操作记录到redo log里面，此时redo log处于prepare状态。然后告知执行器执行完成了，随时可以提交事务。</p>
</li>
<li>
<p>执行器生成这个操作的binlog，并把binlog写入磁盘。</p>
</li>
<li>
<p>执行器调用引擎的提交事务接口，引擎把刚刚写入的redo log改成提交（commit）状态，更新完成。</p>
</li>
</ol><p>这里我给出这个update语句的执行流程图，图中浅色框表示是在InnoDB内部执行的，深色框表示是在执行器中执行的。</p><p><img src="https://static001.geekbang.org/resource/image/2e/be/2e5bff4910ec189fe1ee6e2ecc7b4bbe.png" alt=""></p><center><span class="reference">update语句执行流程</span></center><p>你可能注意到了，最后三步看上去有点“绕”，将redo log的写入拆成了两个步骤：prepare和commit，这就是"两阶段提交"。</p><h1>两阶段提交</h1><p>为什么必须有“两阶段提交”呢？这是为了让两份日志之间的逻辑一致。要说明这个问题，我们得从文章开头的那个问题说起：<strong>怎样让数据库恢复到半个月内任意一秒的状态？</strong></p><p>前面我们说过了，binlog会记录所有的逻辑操作，并且是采用“追加写”的形式。如果你的DBA承诺说半个月内可以恢复，那么备份系统中一定会保存最近半个月的所有binlog，同时系统会定期做整库备份。这里的“定期”取决于系统的重要性，可以是一天一备，也可以是一周一备。</p><p>当需要恢复到指定的某一秒时，比如某天下午两点发现中午十二点有一次误删表，需要找回数据，那你可以这么做：</p><ul>
<li>首先，找到最近的一次全量备份，如果你运气好，可能就是昨天晚上的一个备份，从这个备份恢复到临时库；</li>
<li>然后，从备份的时间点开始，将备份的binlog依次取出来，重放到中午误删表之前的那个时刻。</li>
</ul><p>这样你的临时库就跟误删之前的线上库一样了，然后你可以把表数据从临时库取出来，按需要恢复到线上库去。</p><p>好了，说完了数据恢复过程，我们回来说说，为什么日志需要“两阶段提交”。这里不妨用反证法来进行解释。</p><p>由于redo log和binlog是两个独立的逻辑，如果不用两阶段提交，要么就是先写完redo log再写binlog，或者采用反过来的顺序。我们看看这两种方式会有什么问题。</p><p>仍然用前面的update语句来做例子。假设当前ID=2的行，字段c的值是0，再假设执行update语句过程中在写完第一个日志后，第二个日志还没有写完期间发生了crash，会出现什么情况呢？</p><ol>
<li>
<p><strong>先写redo log后写binlog</strong>。假设在redo log写完，binlog还没有写完的时候，MySQL进程异常重启。由于我们前面说过的，redo log写完之后，系统即使崩溃，仍然能够把数据恢复回来，所以恢复后这一行c的值是1。<br>
但是由于binlog没写完就crash了，这时候binlog里面就没有记录这个语句。因此，之后备份日志的时候，存起来的binlog里面就没有这条语句。<br>
然后你会发现，如果需要用这个binlog来恢复临时库的话，由于这个语句的binlog丢失，这个临时库就会少了这一次更新，恢复出来的这一行c的值就是0，与原库的值不同。</p>
</li>
<li>
<p><strong>先写binlog后写redo log</strong>。如果在binlog写完之后crash，由于redo log还没写，崩溃恢复以后这个事务无效，所以这一行c的值是0。但是binlog里面已经记录了“把c从0改成1”这个日志。所以，在之后用binlog来恢复的时候就多了一个事务出来，恢复出来的这一行c的值就是1，与原库的值不同。</p>
</li>
</ol><p>可以看到，如果不使用“两阶段提交”，那么数据库的状态就有可能和用它的日志恢复出来的库的状态不一致。</p><p>你可能会说，这个概率是不是很低，平时也没有什么动不动就需要恢复临时库的场景呀？</p><p>其实不是的，不只是误操作后需要用这个过程来恢复数据。当你需要扩容的时候，也就是需要再多搭建一些备库来增加系统的读能力的时候，现在常见的做法也是用全量备份加上应用binlog来实现的，这个“不一致”就会导致你的线上出现主从数据库不一致的情况。</p><p>简单说，redo log和binlog都可以用于表示事务的提交状态，而两阶段提交就是让这两个状态保持逻辑上的一致。</p><h1>小结</h1><p>今天，我介绍了MySQL里面最重要的两个日志，即物理日志redo log和逻辑日志binlog。</p><p>redo log用于保证crash-safe能力。innodb_flush_log_at_trx_commit这个参数设置成1的时候，表示每次事务的redo log都直接持久化到磁盘。这个参数我建议你设置成1，这样可以保证MySQL异常重启之后数据不丢失。</p><p>sync_binlog这个参数设置成1的时候，表示每次事务的binlog都持久化到磁盘。这个参数我也建议你设置成1，这样可以保证MySQL异常重启之后binlog不丢失。</p><p>我还跟你介绍了与MySQL日志系统密切相关的“两阶段提交”。两阶段提交是跨系统维持数据逻辑一致性时常用的一个方案，即使你不做数据库内核开发，日常开发中也有可能会用到。</p><p>文章的最后，我给你留一个思考题吧。前面我说到定期全量备份的周期“取决于系统重要性，有的是一天一备，有的是一周一备”。那么在什么场景下，一天一备会比一周一备更有优势呢？或者说，它影响了这个数据库系统的哪个指标？</p><p>你可以把你的思考和观点写在留言区里，我会在下一篇文章的末尾给出我的答案。</p><p>感谢你的收听，也欢迎你把这篇文章分享给更多的朋友一起阅读。</p><p><img src="https://static001.geekbang.org/resource/image/ce/d9/ce7f4e35916ed1aa49206a53a0547bd9.jpg" alt=""></p></div></div></div><div data-v-87ffcada="" class="article-comments"><h2 data-v-87ffcada=""><span data-v-87ffcada="">精选留言</span></h2><ul data-v-87ffcada="">            <li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/74/8b/840afbd8.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">super blue cat</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>171</span></a></div>
	</div>
	<div class="bd">我可以认为redo log 记录的是这个行在这个页更新之后的状态，binlog 记录的是sql吗？</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">Redo log不是记录数据页“更新之后的状态”，而是记录这个页 “做了什么改动”。<br><br>Binlog有两种模式，statement 格式的话是记sql语句， row格式会记录行的内容，记两条，更新前和更新后都有。<br>（谢谢你提这个问题，为了不打断文章思路，这个点没在正文写，但是又是很重要的点😄😄）</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/f5/de/c33e531e.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Jason</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>131</span></a></div>
	</div>
	<div class="bd">首先谈一下，学习后的收获<br>redo是物理的，binlog是逻辑的；现在由于redo是属于InnoDB引擎，所以必须要有binlog，因为你可以使用别的引擎<br>保证数据库的一致性，必须要保证2份日志一致，使用的2阶段式提交；其实感觉像事务，不是成功就是失败，不能让中间环节出现，也就是一个成功，一个失败<br>如果有一天mysql只有InnoDB引擎了，有redo来实现复制，那么感觉oracle的DG就诞生了，物理的速度也将远超逻辑的，毕竟只记录了改动向量<br>binlog几大模式，一般采用row，因为遇到时间，从库可能会出现不一致的情况，但是row更新前后都有，会导致日志变大<br>最后2个参数，保证事务成功，日志必须落盘，这样，数据库crash后，就不会丢失某个事务的数据了<br>其次说一下，对问题的理解<br>备份时间周期的长短，感觉有2个方便<br>首先，是恢复数据丢失的时间，既然需要恢复，肯定是数据丢失了。如果一天一备份的话，只要找到这天的全备，加入这天某段时间的binlog来恢复，如果一周一备份，假设是周一，而你要恢复的数据是周日某个时间点，那就，需要全备+周一到周日某个时间点的全部binlog用来恢复，时间相比前者需要增加很多；看业务能忍受的程度<br>其次，是数据库丢失，如果一周一备份的话，需要确保整个一周的binlog都完好无损，否则将无法恢复；而一天一备，只要保证这天的binlog都完好无损；当然这个可以通过校验，或者冗余等技术来实现，相比之下，上面那点更重要<br><br>不对的地方，望大神指点</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">👍🏿置顶了<br><br>你说的物理复制业界有团队在做了<br><br>而且官方新版本也把MySQL的表结构都收归InnoDB管理了😄</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/aa/21/81ee4e60.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">lfn</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>23</span></a></div>
	</div>
	<div class="bd">老师,今天MYSQL第二讲中提到binlog和redo log, 我感觉binlog很多余，按理是不是只要redo log就够了?[费解] <br>您讲的时候说redo log是InnoDB的要求，因为以plugin的形式加入到MySQL中，此时binlog作为Server层的日志已然存在，所以便有了两者共存的现状。但我觉得这并不能解释我们在只用InonoDB引擎的时候还保留Binlog这种设计的原因.</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">binlog还不能去掉。<br><br>一个原因是，redolog只有InnoDB有，别的引擎没有。<br><br>另一个原因是，redolog是循环写的，不持久保存，binlog的“归档”这个功能，redolog是不具备的。  </p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/f7/69/d8dba3de.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">DanielAnton</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>20</span></a></div>
	</div>
	<div class="bd">有个问题请教老师，既然write pos和checkout都是往后推移并循环的，而且当write pos赶上checkout的时候要停下来，将checkout往后推进，那么是不是意味着write pos的位置始终在checkout后面，最多在一起，而这和老师画的图有些出入，不知道我的理解是不是有些错误，请老师指教。</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">因为是“循环”的，图中这个状态下，write_pos 往前写，写到3号文件末尾，就回到0号继续写，这样你再理解看看“追”的状态。<br><br>刚好借你这个问题，说明一下，文中“write pos和checkpoint之间的是’粉板’上还空着的部分，可以用来记录新的操作。” <br>这句话，说的“空着的部分”，就是write pos 到3号文件末尾，再加上0号文件开头到checkpoint 的部分。</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/97/59/6f9c036e.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Godruoyi</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>18</span></a></div>
	</div>
	<div class="bd">Bin log 用于记录了完整的逻辑记录，所有的逻辑记录在 bin log 里都能找到，所以在备份恢复时，是以 bin log 为基础，通过其记录的完整逻辑操作，备份出一个和原库完整的数据。<br><br>在两阶段提交时，若 redo log 写入成功，bin log 写入失败，则后续通过 bin log 恢复时，恢复的数据将会缺失一部分。(如 redo log 执行了 update t set status = 1，此时原库的数据 status 已更新为 1，而 bin log 写入失败，没有记录这一操作，后续备份恢复时，其 status = 0，导致数据不一致）。<br><br>若先写入 bin log，当 bin log 写入成功，而 redo log 写入失败时，原库中的 status 仍然是 0 ，但是当通过 bin log 恢复时，其记录的操作是 set status = 1，也会导致数据不一致。<br><br>其核心就是， redo log 记录的，即使异常重启，都会刷新到磁盘，而 bin log 记录的， 则主要用于备份。<br><br>我可以这样理解吗？还有就是如何保证 redo log 和 bin log 操作的一致性啊？</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">几乎全对，除了这个“两阶段提交时，若redo log写入成功，但binlog写入失败…”这句话。<br><br>实际上，因为是两阶段提交，这时候redolog只是完成了prepare, 而binlog又失败，那么事务本身会回滚，所以这个库里面status的值是0。<br><br>如果通过binlog 恢复出一个库，status值也是0。<br><br>这样不算丢失，这样是合理的结果。<br><br>两阶段就是保证一致性用的。<br>你不用担心日志写错，那样就是bug了…</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/bb/10/f01eafe4.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">ricktian</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>7</span></a></div>
	</div>
	<div class="bd">redo log的机制看起来和ring buffer一样的；<br>另外有个和高枕、思雨一样的疑问，如果在重启后，需要通过检查binlog来确认redo log中处于prepare的事务是否需要commit，那是否不需要二阶段提交，直接以binlog的为准，如果binlog中不存在的，就认为是需要回滚的。这个地方，是不是我漏了什么，拉不通。。。 麻烦老师解下疑，多谢～ </div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">文章中有提到“binlog没有被用来做崩溃恢复”，<br><br>历史上的原因是，这个是一开始就这么设计的，所以不能只依赖binlog。<br><br>操作上的原因是，binlog是可以关的，你如果有权限，可以set sql_log_bin=0关掉本线程的binlog日志。 所以只依赖binlog来恢复就靠不住。<br><br>@高枕、@思雨 也看下这个讨论😄</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/85/43/3dc8222d.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">小张</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>6</span></a></div>
	</div>
	<div class="bd">老师您好，有一个问题，如果在非常极端的情况下，redo log被写满，而redo log涉及的事务均未提交，此时又有新的事务进来时，就要擦除redo log，这就意味着被修改的的脏页此时要被迫被flush到磁盘了，因为用来保证事务持久性的redo log就要消失了。但如若真的执行了这样的操作，数据就在被commit之前被持久化到磁盘中了。当真的遇到这样的恶劣情况时，mysql会如何处理呢，会直接报错吗？还是有什么应对的方法和策略呢？</div> <span class="time">2018-11-27</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">👍🏿，会想到这么细致的场景<br><br>这些数据在内存中是无效其他事务读不到的（读到了也放弃），同样的，即使写进磁盘，也没关系，再次读到内存以后，还是原来的逻辑</p> <p class="reply-time">2018-11-27</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/43/38/72feb2e0.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">哇！怎么这么大个</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>1</span></a></div>
	</div>
	<div class="bd">老师您好，我之前是做运维的，通过binlog恢复误操作的数据，但是实际上，我们会后知后觉，误删除一段时间了，才发现误删除，此时，我把之前误删除的binlog导入，再把误删除之后binlog导入，会出现问题，比如主键冲突，而且binlog导数据，不同模式下时间也有不同，但是一般都是row模式，时间还是很久，有没什么方式，时间短且数据一致性强的方式</div> <span class="time">2018-12-20</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">其实恢复数据只能恢复到误删之前到一刻，<br>误删之后的，不能只靠binlog来做，因为业务逻辑可能因为误删操作的行为，插入了逻辑错误的语句，<br><br>所以之后的，跟业务一起，从业务快速补数据的。只靠binlog补出来的往往不完整</p> <p class="reply-time">2018-12-20</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/fe/68/e0bebd9a.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">高枕</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>161</span></a></div>
	</div>
	<div class="bd">我再来说下自己的理解 。<br>1 prepare阶段 2 写binlog 3 commit<br>当在2之前崩溃时<br>重启恢复：后发现没有commit，回滚。备份恢复：没有binlog 。<br>一致<br>当在3之前崩溃<br>重启恢复：虽没有commit，但满足prepare和binlog完整，所以重启后会自动commit。备份：有binlog. 一致</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">👍🏿，get 完成</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/f8/70/f3a33a14.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">某、人</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>110</span></a></div>
	</div>
	<div class="bd">1.首先客户端通过tcp&#47;ip发送一条sql语句到server层的SQL interface<br>2.SQL interface接到该请求后，先对该条语句进行解析，验证权限是否匹配<br>3.验证通过以后，分析器会对该语句分析,是否语法有错误等<br>4.接下来是优化器器生成相应的执行计划，选择最优的执行计划<br>5.之后会是执行器根据执行计划执行这条语句。在这一步会去open table,如果该table上有MDL，则等待。<br>如果没有，则加在该表上加短暂的MDL(S)<br>(如果opend_table太大,表明open_table_cache太小。需要不停的去打开frm文件)<br>6.进入到引擎层，首先会去innodb_buffer_pool里的data dictionary(元数据信息)得到表信息<br>7.通过元数据信息,去lock info里查出是否会有相关的锁信息，并把这条update语句需要的<br>锁信息写入到lock info里(锁这里还有待补充)<br>8.然后涉及到的老数据通过快照的方式存储到innodb_buffer_pool里的undo page里,并且记录undo log修改的redo<br>(如果data page里有就直接载入到undo page里，如果没有，则需要去磁盘里取出相应page的数据，载入到undo page里)<br>9.在innodb_buffer_pool的data page做update操作。并把操作的物理数据页修改记录到redo log buffer里<br>由于update这个事务会涉及到多个页面的修改，所以redo log buffer里会记录多条页面的修改信息。<br>因为group commit的原因，这次事务所产生的redo log buffer可能会跟随其它事务一同flush并且sync到磁盘上<br>10.同时修改的信息，会按照event的格式,记录到binlog_cache中。(这里注意binlog_cache_size是transaction级别的,不是session级别的参数,<br>一旦commit之后，dump线程会从binlog_cache里把event主动发送给slave的I&#47;O线程)<br>11.之后把这条sql,需要在二级索引上做的修改，写入到change buffer page，等到下次有其他sql需要读取该二级索引时，再去与二级索引做merge<br>(随机I&#47;O变为顺序I&#47;O,但是由于现在的磁盘都是SSD,所以对于寻址来说,随机I&#47;O和顺序I&#47;O差距不大)<br>12.此时update语句已经完成，需要commit或者rollback。这里讨论commit的情况，并且双1<br>13.commit操作，由于存储引擎层与server层之间采用的是内部XA(保证两个事务的一致性,这里主要保证redo log和binlog的原子性),<br>所以提交分为prepare阶段与commit阶段<br>14.prepare阶段,将事务的xid写入，将binlog_cache里的进行flush以及sync操作(大事务的话这步非常耗时)<br>15.commit阶段，由于之前该事务产生的redo log已经sync到磁盘了。所以这步只是在redo log里标记commit<br>16.当binlog和redo log都已经落盘以后，如果触发了刷新脏页的操作，先把该脏页复制到doublewrite buffer里，把doublewrite buffer里的刷新到共享表空间，然后才是通过page cleaner线程把脏页写入到磁盘中<br>老师，你看我的步骤中有什么问题嘛？我感觉第6步那里有点问题,因为第5步已经去open table了，第6步还有没有必要去buffer里查找元数据呢?这元数据是表示的系统的元数据嘛,还是所有表的？谢谢老师指正</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">其实在实现上5是调用了6的过程了的，所以是一回事。MySQL server 层和InnoDB层都保存了表结构，所以有书上描述时会拆开说。<br><br>这个描述很详细，同时还有点到我们后面要讲的内通（编辑快来，有人来砸场子啦😄😄）<br><br></p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/d4/e0/513d185e.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">文@雨路</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>37</span></a></div>
	</div>
	<div class="bd">老师，我想问下如果提交事务的时候正好重启那么redo log和binlog会怎么处理？此时redo log处于prepare阶段，如果不接受这条log，但是binlog已经接受，还是说binlog会去检查redo log的状态，状态为prepare的不会恢复？</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">好问题👍🏿表示中间那段你都听明白了👍🏿<br><br>Binlog如果已经接受，那么redolog是prepare, binlog已经完整了对吧，这时候崩溃恢复过程会认可这个事务，提交掉。 （你可以分析下这种情况下，是否符合我们要达到的“用binlog恢复的库跟原库逻辑相同” 这个要求）</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/44/cc/3e62d111.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">justd</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>32</span></a></div>
	</div>
	<div class="bd">一个完整的交易过程：账本记上 卖一瓶可乐（redo log为 prepare状态），然后收钱放入钱箱（bin log记录）然后回过头在账本上打个勾（redo log置为commit）表示一笔交易结束。<br>如果收钱时交易被打断，回过头来整理此次交易，发现只有记账没有收钱，则交易失败，删掉账本上的记录（回滚）；如果收了钱后被终止，然后回过头发现账本有记录（prepare）而且钱箱有本次收入（bin log），则继续完善账本（commit），本次交易有效。<br></div> <span class="time">2018-11-17</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/2d/6a/21edc91e.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Mao</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>25</span></a></div>
	</div>
	<div class="bd">老师，您好。您说MySQL 使用WAL，先写日志再写磁盘。请教一个问题，<br><br>执行一条Update 语句后，马上又执行一条 select * from table limit 10。<br><br>如果刚刚update的记录，还没持久化到磁盘中，而偏偏这个时候的查询条件，又包含了刚刚update的记录。<br><br>那么这个时候，是从日志中获取刚刚update的最新结果，还是说，先把日志中的记录先写磁盘，再返回最新结果？</div> <span class="time">2018-11-19</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/d4/e0/513d185e.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">文@雨路</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>21</span></a></div>
	</div>
	<div class="bd">老师，也就是说状态恢复的过程会去同时检查redo log和binlog？不然怎么能确定一个prepare的redo log已经写好了binlog，因为不检查的话不能确定到底是写好了binlog之后奔溃的还是写之前奔溃的，也就不能确定这个prepare log的合法性。如果检查的话那么不用两阶段提交好像也没什么问题，无论先写哪个日志都可以。</div> <span class="time">2018-11-16</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/e2/9d/fbbd4611.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">cyberbit</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>20</span></a></div>
	</div>
	<div class="bd">我理解备份就是救命药加后悔药，灾难发生的时候备份能救命，出现错误的时候备份能后悔。事情都有两面性，没有谁比谁好，只有谁比谁合适，完全看业务情况和需求而定。一天一备恢复时间更短，binlog更少，救命时候更快，但是后悔时间更短，而一周一备正好相反。我自己的备份策略是设置一个16小时延迟复制的从库，充当后悔药，恢复时间也较快。再两天一个全备库和binlog，作为救命药,最后时刻用。这样就比较兼顾了。</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">你是有故事的人😄</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/df/e7/e3c450c2.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">lionetes</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>16</span></a></div>
	</div>
	<div class="bd">昨天上午 恢复别人误操作配置表数据，幸好有xtarbackup凌晨的全量备份，只提取了改表的ibd文件，然后在本地 做了 一个一样的空表，释放该表空间，加载 提取后的ibd文件，提取昨天零晨到九点的binlog文件 筛选改表这个时段的操作记录 增量更新到本地导出csv 导入线上  。binlog太tm重要了</div> <span class="time">2018-11-17</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">你选择了最优路径👍🏿</p> <p class="reply-time">2018-11-18</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/e9/0b/53bf91d3.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">WL</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>14</span></a></div>
	</div>
	<div class="bd">为该讲的内容总结了几个问题, 大家复习的时候可以先尝试回答这些问题检查自己的掌握程度:<br>   1. redo log的概念是什么? 为什么会存在.<br>   2. 什么是WAL(write-ahead log)机制, 好处是什么.<br>   3. redo log 为什么可以保证crash safe机制.<br>   4. binlog的概念是什么, 起到什么作用, 可以做crash safe吗? <br>   5. binlog和redolog的不同点有哪些? <br>   6. 物理一致性和逻辑一直性各应该怎么理解? <br>   7. 执行器和innoDB在执行update语句时候的流程是什么样的?<br>   8. 如果数据库误操作, 如何执行数据恢复?<br>   9. 什么是两阶段提交, 为什么需要两阶段提交, 两阶段提交怎么保证数据库中两份日志间的逻辑一致性(什么叫逻辑一致性)?<br>  10. 如果不是两阶段提交, 先写redo log和先写bin log两种情况各会遇到什么问题?</div> <span class="time">2018-11-24</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/07/8c/51401220.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">小美</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>10</span></a></div>
	</div>
	<div class="bd">老师，我这想请教两个问题：<br>1.写redo日志也是写io（我理解也是外部存储）。同样耗费性能。怎么能做到优化呢<br>2.数据库只有redo commit 之后才会真正提交到数据库吗</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">1. Redolog是顺序写，并且可以组提交，还有别的一些优化，收益最大是是这两个因素；<br><br>2.是这样，正常执行是要commit 才算完，但是崩溃恢复过程的话，可以接受“redolog prepare 并且binlog完整” 的情况</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/70/51/eb68ec53.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Lugyedo</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>9</span></a></div>
	</div>
	<div class="bd">redo log和bin log怎么对应</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">事务ID （比较细节，就没在正文里写了</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/70/97/e5bf9ddb.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">jacket</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>9</span></a></div>
	</div>
	<div class="bd">【回答问题】<br>备份数据库的周期直接影响到了恢复的速度，一天一备的话，恢复时只需要重新执行最近一天的数据库修改操作。而一周一备则需要做很多。所以在对于系统恢复速度很敏感的系统，最好使用一天一备，甚至一小时一备等等。</div> <span class="time">2018-11-16</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/dc/b7/e59c22f0.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">黄金的太阳</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>8</span></a></div>
	</div>
	<div class="bd">请教老师，redo log是为了快速响应SQL充当了粉板，这里有两个疑问<br>1. redo log本身也是文件，记录文件的过程其实也是写磁盘，那和文中提到的离线写磁盘操作有何区别？<br>2.响应一次SQL我理解是要同时操作两个日志文件？也就是写磁盘两次？</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">你的理解是对的。<br>1. 写redo log是顺序写，不用去“找位置”，而更新数据需要找位置<br><br>2. 其实是3次（redolog两次 binlog 1次）。不过在并发更新的时候会合并写</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/e2/cb/6bc95e09.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">喔～</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>7</span></a></div>
	</div>
	<div class="bd">redo 是引擎提供的，binlog 是server 自带的，文中提到前者用在crash的恢复，后者用于库的恢复<br>两者是否在某种程度上是重复的？如果在都是追加写的情况下，是否两种日志都能用于 crash 与 库 的恢复呢？</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">Crash-safe是崩溃恢复，就是原地满血复活；binlog恢复是制造一个影分身（副本）出来</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/7a/e0/3d5b28ef.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">清歌</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>6</span></a></div>
	</div>
	<div class="bd">binlog为什么说是逻辑日志呢？它里面有内容也会存储成物理文件，怎么说是逻辑而不是物理</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">这样理解哈。 <br><br>逻辑日志可以给别的数据库，别的引擎使用，已经大家都讲得通这个“逻辑”；<br><br>物理日志就只有“我”自己能用，别人没有共享我的“物理格式”</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/4e/3a/2aa0f5cf.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">linqw</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>5</span></a></div>
	</div>
	<div class="bd">学习后的收获总结：<br>1、首先数据库更新操作都是基于内存页，更新的时候不会直接更新磁盘，如果内存有存在就直接更新内存，如果内存没有存在就从磁盘读取到内存，在更新内存，并且写redo log，目的是为了更新效率更快，等空闲时间在将其redo log所做的改变更新到磁盘中，innodb_flush_log_at_trx_commit设置为1时，也可以防止服务出现异常重启，数据不会丢失<br>2、redo log两阶段提交，是为了保证redo log和binlog的一致性，如果redo log写入成功处于prepare阶段，写binlog失败，事务回滚，redo log会回滚到操作之前的状态<br>3、redo log也是写磁盘，写redo log是顺序写，update直接更新磁盘，需要找到数据，再对此数据进行更新，如果没有使用索引，数据量大会导致更新效率慢，不对的地方，望老师指点哦</div> <span class="time">2018-11-28</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">很好👍🏿<br><br>最后一段，“有索引”写数据也慢，因为是随机写</p> <p class="reply-time">2018-11-28</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/54/ce/ed58c82d.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">为你而来</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>5</span></a></div>
	</div>
	<div class="bd">记笔记:<br>redo  log 记录 做了什么改动（比如把某个字段从0改成了1）<br><br>binlog 记录 是怎么修改的（记录sql语句或者 记录更新前后的行）</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">好习惯：）</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/d2/c9/f262f947.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">卜卜口</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>4</span></a></div>
	</div>
	<div class="bd">老师，有个疑问，怎么知道binlog是完整的？这个想不通</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">一个事务的完整binlog是有固定格式，也就是说有固定结尾的😄</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/8a/9a/7270d764.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Enterprize</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>4</span></a></div>
	</div>
	<div class="bd">爱学习的我表示可以更新快一些，每次看一篇不过瘾</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">👍🏿爱学习，周末休息下，下一篇是下周一凌晨啦😄</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/c6/e4/ec572f55.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">沙亮亮</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>4</span></a></div>
	</div>
	<div class="bd">redo_log恢复是以什么状态为依据，是prepare，还是commit</div> <span class="time">2018-11-16</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/dd/5d/ea2e41d0.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Victor</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>4</span></a></div>
	</div>
	<div class="bd">感谢老师分享，很有深度，有个问题，一直有疑惑？Buffer Pool中的脏页刷新到磁盘中，只能由ckeckpoint操作触发么？有没有可能未提交的事务也刷新到磁盘中啦？</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">不止是checkpoint, 有别的时机的。 这个展开比较复杂，会在第十讲说到</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/fe/68/e0bebd9a.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">高枕</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>4</span></a></div>
	</div>
	<div class="bd">老师 与思雨有同样疑惑<br>也就是说状态恢复的过程会去同时检查redo log和binlog？不然怎么能确定一个prepare的redo log已经写好了binlog，因为不检查的话不能确定到底是写好了binlog之后奔溃的还是写之前奔溃的，也就不能确定这个prepare log的合法性。如果检查的话那么不用两阶段提交好像也没什么问题，无论先写哪个日志都可以</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">很好的思考，你考虑一下这个场景，redolog没写，binlog写好了，怎么算。 注意由于binlog写完了，在备份恢复回来以后是会重放这个事务的。 </p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="" class="avatar">
<div class="info">
	<div class="hd"><span class="username">小妖精</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>4</span></a></div>
	</div>
	<div class="bd">老师讲解的真好，期待更新</div> <span class="time">2018-11-16</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/ea/9a/02d589f9.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">斜面镜子 Bill</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>3</span></a></div>
	</div>
	<div class="bd">备份时间周期的长短，理解需要考虑<br>1.业务实际的数据存量，如果大到一天没有办法备份完成，只能一周一次，甚至更长<br>2.业务数据的增量，如果增量非常大，如果一周备份一次，增量备份的考验会比较大，极大的概率会出现增量备份失败问题，另外恢复时长和成功率也比较困难<br>3.业务比较重要并且对恢复时间的忍受程度低，并且历史上多次出现类似数据回滚的需求，而且增量还不小优先一天一备份，相反业务实际不重要，出问题后可以容忍一定的不可用，而且增量还不多，出于成本考虑可以用一周一备份备份<br>4.文件的恢复效率很高的话，大多业务增量一周的恢复时长还是可以保证的，这时候就是提供SLA让业务决策了<br><br>综合数据存量、增量、备份成本、恢复效率、业务SLA选择，我理解就有答案了！</div> <span class="time">2018-11-21</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/f8/34/2ce5e546.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Elvis</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>3</span></a></div>
	</div>
	<div class="bd">请教下redo log 和 binlog 也是需要写文件的，也会消耗IO，这个不会影响数据库的性能吗？ 从内容看redo log首先写道缓存中，如果这个时候断电了，缓存也清空了，尚未写道磁盘，这个时候不是redo log 不完整的如何保证恢复的完整性呢？麻烦老师指教下</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">要写IO，是会影响，但是为了数据可靠性，还是要做的。<br><br>Redolog是直接写盘的，更新的内存是数据的内存。<br><br>如果没有写完就重启，就回滚，不算的丢数据</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/f8/ba/14e05601.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">约书亚</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>3</span></a></div>
	</div>
	<div class="bd">看到了文@雨路的留言，和我的疑问一模一样。另外有个没提到，如果认可这个事务可以从crash恢复，起码要求服务器告知客户端事务成功了吧，那您说redo log prepare + bin log ok，就可以恢复了，说明bin log写入成功就算事务成功了？那最后一步确实没什么用呀。</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">有用，如果redolog 已经commit了，崩溃恢复就不需要去找binlog. </p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/f8/ba/14e05601.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">约书亚</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>3</span></a></div>
	</div>
	<div class="bd">疑问，redo log是否必须处于commit状态，才能用于crash后的恢复？这样会不会在bin log写入，redo log commit之前发生crash？这样不是和您说情况2一样？<br>如果不是，那似乎又和情况1一样？<br>且如果最后commit之前crash，我理解是事务执行失败吧？那binlog这条记录不能用作恢复吧？<br>难道commit同时代表redo log和bin log生效?</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">Commit确实表示这两个日志都生效了。<br><br>可以看一下@高枕 在15:19 的评论</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="" class="avatar">
<div class="info">
	<div class="hd"><span class="username">有铭</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>3</span></a></div>
	</div>
	<div class="bd">我觉得有些问题文中没有说的很清楚：<br>*. 文中说有可能先写在黑板上，暂时不会写到账本，是指的redo log本身，还是数据？如果是数据的话，那就有个新问题了，你update后数据不在硬盘上，此时select得到的数据不就是旧数据吗？<br>*. 从理论上讲，可不可以认为InnoDB引擎的事务特性完全是由redo log日志完成的？</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">确实没写到数据上，但是不影响查询正确性，因为写了内存，下次查询是从内存里面读的。 <br><br>内存可能会被淘汰，又会触发相应的写盘操作。<br>这个在第十讲中会提到。<br><br>确实一篇文章没里办法全部展开，继续关注后面的文章哈</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/ad/37/abb7bfe3.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Allen</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>3</span></a></div>
	</div>
	<div class="bd">看了正文还有些不太能消化，再看看留言，还来也是有很重要的内容。看来留言也不能忽略，想当于大家学习后的交流和巩固</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">作者也很爱评论区，笔芯😁</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/14klQsmQShM1177FnuuN77X9u1QX9icktEec6dmmQwC3mRiaEJY1NFOzLRxG7tZFrjMmiaxhdouAmYgkLLqsRtyeg/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">T^T</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>3</span></a></div>
	</div>
	<div class="bd">老师可以把redo log和binlog日志贴一点点吗？有助于直观感受</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">额，我主要怕有占篇幅之嫌… binlog的我加到答疑篇，redo的… 对于非数据库内核开发人员是不可读的数据， 基本大家用不到</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="" class="avatar">
<div class="info">
	<div class="hd"><span class="username">哈乐笑</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>2</span></a></div>
	</div>
	<div class="bd">看了作者的文章，我感觉redo log和binlog都有恢复数据库的功能，不过redo log是，当mysql服务挂掉之后，重启的时候回复用的恶，而binlog是用于数据库损坏或者误删等整体大规模恢复用的。不知道这样理解对不对</div> <span class="time">2018-11-20</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/c9/46/094b06bf.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">菠菜</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>2</span></a></div>
	</div>
	<div class="bd">俩问题，一个是当mysql重启，对于innodb的启动是如何实现的，听文章说redo log会很大，比如一个G，需要全都加载一边才能算启动完成吗？另一个，二段提交，如果在commit之前crash了，innodb是如何界定这一条数据全是丢弃还是不丢弃？因为有两种情况，一种是bin log写成功了，但是commit没成功，另一个是bin log压根就没写成功</div> <span class="time">2018-11-20</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">1. 从checkpoint开始到writepos结束，不需要全部4G<br><br>2. Binlog写成功事务算成功，就提交事务；binlog没写成功就回滚</p> <p class="reply-time">2018-11-20</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/f9/03/23706390.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">魔都浪子</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>2</span></a></div>
	</div>
	<div class="bd">在binlog写入磁盘后，commit提交前发生crash，由于commit没有成功，那返回给客户端的消息是事物失败，但是在系统恢复的时候却会重新提交事物，使之成功，这不是在欺骗客户端嘛？问题很大啊</div> <span class="time">2018-11-17</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">不是，并没有返回“事务失败”呀，而是“执行异常”。执行异常本来就可能成功也可能失败的。你想一下这个场景：执行全部完成了，在回复客户端的时候网络断了，这怎么算😄</p> <p class="reply-time">2018-11-17</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/9d/84/171b2221.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">jeffery</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>2</span></a></div>
	</div>
	<div class="bd">binglog 一般建议设置啥模式 假如row模式binglog 怎么回复</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">建议设置row模式，row模式日志一样的可以用于重放的</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/2a/a5/e80c3a39.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">　</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>2</span></a></div>
	</div>
	<div class="bd">频繁的更新写入，导致redolog过大，适合短周期的备份？</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">Redolog固定大小，不会“导致过大”的</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/ea/dc/e3fcd3ee.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">一梦如是</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>2</span></a></div>
	</div>
	<div class="bd">老师，undolog记录的是修改前的内容，这个是在什么时间写入和提交的呢？</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">第三讲会讲到哦</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/46/48/e959b1e0.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">amazon1011</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>2</span></a></div>
	</div>
	<div class="bd">老师可以分享下MySQL 的redo和Oracle的redo有什么不一样吗?之前在书上看M中的的redo是物理逻辑日志，就是说记录到物理页面的，但记录页面的内容是逻辑的，基于这个原因，有了double write的设计，就是一定要保证数据页面是完整的才能应用redo，而O因为是真正的物理日志，才没有double write的设计，不知道理解的对不对，请指教，谢谢</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">Double write buffer这里理解不太对，是要保证数据页完整才能“写入磁盘”。 这个过程跟我们今天的内容关系不大哈。我们可以在第10讲讨论这个问题</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/c0/6c/efbb9020.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">随心而至</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>2</span></a></div>
	</div>
	<div class="bd">当每天需要进行大量的更新操作时，使用一天一备份较好，这样备份库使用bin log备份时可以更快地完成，而且备份库的数据不会落后主库太多</div> <span class="time">2018-11-16</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/ibZVAmmdAibBeVpUjzwId8ibgRzNk7fkuR5pgVicB5mFSjjmt2eNadlykVLKCyGA0GxGffbhqLsHnhDRgyzxcKUhjg/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">pyhhou</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>2</span></a></div>
	</div>
	<div class="bd">老师讲的浅显易懂，我这个数据库小白感觉收获颇多。有两个地方不太理解，一是，binlog也可以被引擎操作，那么binlog除了由执行器记录逻辑信息，是否引擎也会参与进binlog的记录？另外就是小结中提到的将log文件在磁盘中持久化，这是一个怎样的操作？因为一想到外部磁盘总感觉和内存相比会很慢，每次更新都持久化磁盘会不会影响效率？望老师指正</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">记录binlog这个动作是执行器做的，引擎会提供信息；<br><br>嗯，写盘点代价比内存高的。但是这个是没法避免的。除非业务可以接受主机掉电丢数据。对于不能接受的业务，这个是绕不开的成本。 <br><br>所以幸好我们已经过了机械硬盘时代（弹冠相庆.gif)</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/d2/cd/6fb14677.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">苍茫</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>1</span></a></div>
	</div>
	<div class="bd">我想问下，逻辑日志和物理日志有啥区别，能不能详细解答一下？</div> <span class="time">2019-01-23</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">第15篇和第23篇有提哈，你看下</p> <p class="reply-time">2019-01-23</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/14/16/a8/75476086.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">act</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>1</span></a></div>
	</div>
	<div class="bd">执行一条Update 语句后，马上又执行一条 select * from table limit 10。<br><br>如果刚刚update的记录，还没持久化到磁盘中，而偏偏这个时候的查询条件，又包含了刚刚update的记录。<br><br>那么这个时候，是从日志中获取刚刚update的最新结果，还是说，先把日志中的记录先写磁盘，再返回最新结果？</div> <span class="time">2018-12-17</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">都不是，<br>直接读内存😄</p> <p class="reply-time">2018-12-17</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/f8/70/f3a33a14.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">某、人</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>1</span></a></div>
	</div>
	<div class="bd">老师,打搅了,吃盘回锅肉,还有个问题想请假下。<br>开启了半同步复制after_sync以后，假设一个事务在已经把binlog sync到磁盘了,在传输binlog到从库上时,主库挂了。如果这时发生了主从切换,从库是没有这个事务的.但是挂掉的主库重新启起来,由于binlog已经fsync到磁盘,虽然引擎层未commit,但是会根据binlog来恢复这个事务.这个时候就是主从不一致了,那么和after_commit那就没区别呀。请问这个事务是恢复还是回滚呢？如果是回滚,内部又是怎么判断的呢？</div> <span class="time">2018-12-09</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">复习的好习惯呀👍🏿<br><br>如果你设置来双MM，启动以后binlog还会传到新主库的。<br><br>但是如果你设置的是单向的，那就会不一致了…<br></p> <p class="reply-time">2018-12-09</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="" class="avatar">
<div class="info">
	<div class="hd"><span class="username">null</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>1</span></a></div>
	</div>
	<div class="bd">思考题：<br>针对一周一备的情况下，假设最后一天因为误操作导致数据丢失，我们得找到上一周的整库备份文件进行恢复，同时还需要重放这周 7 天的 binlog 日志，恢复时间较长。而同样情况下，一天一备的场景，只需要重放今天的 binlog 日志便恢复数据了。<br><br>---<br><br>疑问：<br>为什么说“只依靠 binlog 是没有 crash-safe 能力的”？<br><br>原文提到：有了 redo log，InnoDB 就可以保证数据库发生异常重启，之前提交的记录都不会丢失，这种能力称之为 crash-safe。<br><br>假设我们将图“update 语句执行流程”中的“写入 redo log” 操作剔除，流程变成：... -&gt; “新行更新到内存” -&gt; “写 binlog” -&gt; “提交事务”。<br>1. 新行更新到内存，写 binlog 前发生异常重启，binlog 和 磁盘均无记录。（这种情况算数据丢失么？是否应该先写日志再更新内存呢？这样即使在写日志后，更新内存前，发生异常重启，数据在日志里未丢失。）<br>2. 写 binlog 之后发生异常，binlog 有记录，磁盘无记录，重放 binlog，磁盘状态与 binlog 一致，数据未丢失。<br><br>从上面 2 点来看，binlog 也可以保证数据库发生异常重启，之前提交的记录也不会丢失，即拥有 crash-safe 能力。<br><br>谢谢老师！</div> <span class="time">2018-12-06</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">WAL机制里面有“已经提交但是还没落盘”的数据，binlog恢复不了这些</p> <p class="reply-time">2018-12-06</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/13/7d/1454db9c.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">还来得及</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>1</span></a></div>
	</div>
	<div class="bd">我有点蒙，<br>1.如果把innodb_flush_log_at_trx_commit设置成1每次都写入到磁盘，那不就等于是掌柜的每次记账都记到账本上嘛，那还要小黑板干嘛呢？感觉我从文中没理解到各位大神已知的信息一样。<br>2.binlog是逻辑，redolog是物理，两者都能记录历史，如果发生异常情况binlog就可以恢复数据，为什么说只有redolog才能算是crash-safe了呢。<br>可能是我基础不够就看大神的文章，有些懵，还烦老师给解一下疑惑～谢谢。</div> <span class="time">2018-11-30</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">1. Redolog是顺序写，数据文件是随机写。虽然都写盘，顺序写还是快很多的<br><br>2. 这个我在答疑文章中展开哈</p> <p class="reply-time">2018-12-01</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/1c/f9/abb7bfe3.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">查尔斯</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>1</span></a></div>
	</div>
	<div class="bd">有个疑问是，我们保证断电数据不丢失，可以在事务每次commit时候直接写磁盘落地，当然这性能太差，我们采取写日志的形式，日志是顺序写的，性能会高些，那这样的话我觉得可以直接使用binlog做断电后的恢复，每次写入binlog后再做commit，不写binlog当他没提交，这样理论上和直接写数据感觉是一样的，为什么还是要是用redo log呢？<br><br>~~~~~~~~~~~~~~~~~~~~~~~~~<br><br>书接上文，不支持直接回复有些难受<br><br>感谢您对我的解答，我的意思是使用binlog做断电数据恢复，没写log的不提交，但是 回滚操作使用undolog实现，redo log不写的话感觉不影响的呀</div> <span class="time">2018-11-26</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">Undolog是依赖redo来恢复的，没有redo的话，undolog就不完整…</p> <p class="reply-time">2018-11-26</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/e8/90/d63f8347.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">yushing</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>1</span></a></div>
	</div>
	<div class="bd">文本提到“如果每一次的更新操作都需要写进磁盘，磁盘还要找到对应的那条记录再更新，整个过程IO和查找成本都很高，于是使用WAL技术进行优化”，我的疑问是redo log和binlog不是也要写入磁盘么，那么使用redo log和binlog怎么能够解决更新时磁盘IO和查找成本高的问题呢？还望老师能够解答，谢谢~</div> <span class="time">2018-11-21</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/68/73/3cda533e.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">乔良qiaoliang</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>1</span></a></div>
	</div>
	<div class="bd">&quot;先写日志在写磁盘&quot; 这里的是日志和磁盘是逻辑上的所指？ 日志（粉板）本身不也在磁盘上么？</div> <span class="time">2018-11-21</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/0e/fe/00a9b201.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Albert</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>1</span></a></div>
	</div>
	<div class="bd">请问redo log是写磁盘吗？如果是，那这种写字盘和把数据直接写到磁盘上，如果有什么区别？如果不是那怎么保证灾难发生之后可以重新恢复？谢谢！</div> <span class="time">2018-11-20</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/f6/b0/837f5d36.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Mackie .Weng</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>1</span></a></div>
	</div>
	<div class="bd">老师，非常感谢你的优质文章，你的每篇文章，我都要研究一段时间，而且一直做笔记，而且真的使我对mysql一个全新的认识，因为之前总感觉一直止步于数据恢复等业务操作都无法前行了。<br>恕我冒昧我突然想到前不久刚遇到的一个mysql的问题，我总感觉和我们学习的有很大关系，不知道是不是通过binlog来修复的。<br>情形是这样的，我们因为磁盘IO异常导致数据库异常重启了，并发现某个表数据损坏了（无数据备份）且mysql无法开启，一开始的做法innodb_force_recovery设置到1-6直到数据库可以启动，然后进行mysqldump备份，然而并不能备份，报错是mysqldump: Error 2013: Lost connection to MySQL server during query when dumping table `XX表` at row: 31961089。于是就跳过这个表进行备份，并修复了其他数据库，但是这个表的数据丢失最终请了外援修复好了，但是具体没告诉我们，不知道和我们这个有没联系？有没提示让我学学习下这方面？是可以用ibd文件修复吗？</div> <span class="time">2018-11-19</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">你说的这个case我分析了一下。<br>1. 这个现象应该是数据页（page) 的内容错了。InnoDB在读到数据页的时候会判断checksum，碰到有不对的页，就会自己crash掉<br>2. 修改 force_recovery启动以后，mysqldump会显示Lost connection，表示出错的表是在主键索引上（如果是叶子节点，dump的时候是不会访问到的）<br>3. 这种场景的坏表修复，有一种方法，是把错误的page先忽略掉。每个page有checksum，可以扫文件找到checksum不对的page，清空掉内容，初始化成空的。（另一种做法是修改MySQL的代码让MySQL忽略这个错误，而不是crash）<br>4. 总之第3步的目的就是跳过那些已经错了的数据页，把表里面别的数据取出来<br>5. 按照前说的，可以判断出这个错误的页是在主键上面，所以会丢几行的。<br>6. 找回这几行的方法，有几个地方： 这个表其他索引里面有部分字段；undolog；binlog；业务对账。 但是这些都不能保证能够100%拿回全部数据。 <br>一般尽量用binlog，业务对账已经是属于数据库本身没辙了。<br><br>我碰到过这种情况，没有binlog的情况下，做到第5步，业务就满意了。<br><br>最后总结一下 ：一定要备份，包括数据和binlog。</p> <p class="reply-time">2018-11-19</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/49/a5/e4c1c2d4.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">qpm</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>1</span></a></div>
	</div>
	<div class="bd">老师我问个笨问题，更新停留在redo-log bin-log上时，查询是如何把新数据也包括进来？是在查询启动的时候把redo-log的数据刷新到页数据里面么？同一个数据库里，查询和更新同样多时，岂不是会让redo-log的“粉笔板”效果失效？</div> <span class="time">2018-11-19</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">不会，最新的结果会保存在内存里面，就是“掌柜的记忆”，查询直接从内存返回就可以了<br></p> <p class="reply-time">2018-11-19</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/13/35/b6328a05.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">如余</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>1</span></a></div>
	</div>
	<div class="bd">如果binlog写入成功，而此时事务正在提交时crash了，那不是redo log  与 binlog 不一致，同时如果用binlog 恢复数据，是不是也会造成数据不一致，望老师解惑</div> <span class="time">2018-11-19</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">这时候崩溃恢复时，事务会提交的</p> <p class="reply-time">2018-11-19</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/57/d8/abb7bfe3.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Andylee</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>1</span></a></div>
	</div>
	<div class="bd">刚开始我也是比较疑惑既然有了binlog，为何还需要redolog。把老师的文章反复看了几遍大概弄明白了，redolog是innodb引擎特有的，为了WAL而存在,更新操作是先写入redolog，之后异步写到数据的磁盘文件中。假设现在前后更新了2条记录并且都写入binlog后突然宕机，在服务重启后，如果只根据binlog是无法获知当前磁盘上的数据文件中那2条记录的状态是否是最新的（除非从头开始跑一遍binlog），所以一定要借助redolog才能知道宕机前有哪些记录还没更新到磁盘。如果存储引擎不支持WAL，也不支持事务回滚，每次更新都是直接更新到数据磁盘中，这应该不需要考虑宕机的问题。因为WAL的异步写入存在，所以需要解决宕机的恢复问题，需要redolog的协助，而redolog需要和binlog保持状态一致，这又要依靠两阶段提交。</div> <span class="time">2018-11-19</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/14/06/b1/ba6b4335.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">高强</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>1</span></a></div>
	</div>
	<div class="bd">两阶段提交是针对自动提交事务的语句来说的吗？<br>如果是手动提交事务呢？<br>执行更新语句，只更新当前session缓存。当手动commit的时候，才是  记录redo log  处于prepare状态，执行器执行，记录binlog，然后 redlog commit<br>是这样吗<br><br>-------<br>如果用户手动commit，但是第三步redlog变成  commit的时候挂掉，这时候用户收到的执行结果是什么?---这时候恢复的时候是认可这次commit的</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">不是，这个跟手动还是自动无关。你说的commit是一个命令，“提交这个事务”，包含了整个提交过程（也就是说两次redolog和一次binlog操作，都是在你的这个commit **命令**中做的）</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="" class="avatar">
<div class="info">
	<div class="hd"><span class="username">wida</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>1</span></a></div>
	</div>
	<div class="bd">先写日志后写文件如何理解 日志不是在文件里吗？ 是不是redolog 是先在内存里头的？</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">我们分成日志 (redolog)和 数据文件 ，不在一起的</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/f3/1e/8ea92c76.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">毓殇笳</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>1</span></a></div>
	</div>
	<div class="bd">讲得非常好，有条不紊，温文尔雅</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">哎呀作者害羞了😁</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="" class="avatar">
<div class="info">
	<div class="hd"><span class="username">ghostfevil</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>1</span></a></div>
	</div>
	<div class="bd">老师能讲的时候讲讲源码吗</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">这个专栏不太会讲源码，会讲原理+实践</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/A94RKUfWfwzRzb68T9xskctQ43TBgXSBIL78p0N0ria2tQxmsTTJebYmefhkbHK7zwpoxokxs43UxpgDTdwm5tg/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">慕塔</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>1</span></a></div>
	</div>
	<div class="bd">多写场景需要吧 指标应该是RTO。有个问题既然innodb事务性这么强，为什么在恢复临时库不用redo恢复呢？直接对页进行恢复 数据一致性强，恢复时长也短，不用多写一份binlog，减少写放大。这样做主从直接redo同步岂不是更好吗(就是redo量有点大) 谢谢</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">很好的提问方式👍🏿<br><br>Redo主要就是因为循环使用会覆盖；不过你说的这个逻辑，业界已经有团队通过改造InnoDB行为在做了，只是不是官方做的，所以正文中没提</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/46/48/e959b1e0.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">amazon1011</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>1</span></a></div>
	</div>
	<div class="bd">老师，明白double write是为了保证数据页面的完整性，我上午问的是db 异常关闭起来需要做恢复的时候，因为MySQL 的redo 是物理逻辑日志，记录的是页面逻辑的改动，所以要保证数据页面的完整性，这个就是靠double write 去保证的，是这样吗？而Oracle因为redo是物理日志，所以不需要double write技术的保证?</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">对，这样说就精确👍🏿 <br><br>不过现在有些硬盘支持16K的原子写保证，就可以关掉double write buffer. <br>MariaDB 就提供了这个参数允许关掉</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/a1/07/abb7bfe3.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">杨智晓 ✟</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>1</span></a></div>
	</div>
	<div class="bd">Redis还有HBASE的思路好像也是用redo log的方式，先写log，然后写入内存，最后再根据log把数据更新到磁盘</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">嗯嗯，WAL 是数据库的通用设计思路：）</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/36/d2/c7357723.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">发条橙子 。</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>1</span></a></div>
	</div>
	<div class="bd">innodb结构为内存池和后台线程 ， 其中内存池里存在redo日志缓冲 和 缓冲池，其中缓冲池以页为单位缓冲磁盘数据 。<br><br>问题： <br>1.之前老师说更新语句时执行器调用innodb存储引擎先从内存读数据，指的就是从innodb缓存池中读取数据把，没有的话就去读取磁盘找， 找到后再同步到缓冲池。<br><br>2. 在 server层中， 连接器先 查询缓存 ， 这个缓存指的也是 innodb 的缓冲池么。mysql 通过公有的缓冲组件调用 innodb 的缓冲池来获取值。 获取不到在走 分析器 --&gt; 优化器 --&gt; 执行器的流程 。<br><br>3. 从缓冲中取的时候 ，为什么没有  分析器 --&gt; 优化器 --&gt; 执行器 的流程呢</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">1 是的<br>2 不是，server 层的查询缓存就是（query_cache) Server层跟innodb的buffer pool是没有交集的，引擎没有暴露这个接口，只有操作数据的接口<br>3 跟2 类似，不是一个东西哦</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/e7/b7/5aa9a011.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">代贤君</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>1</span></a></div>
	</div>
	<div class="bd">备份也是有锁的，特别是myisam引擎</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">是的，我们在 第六讲会提到</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/c6/e4/ec572f55.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">沙亮亮</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>1</span></a></div>
	</div>
	<div class="bd">redo_log分为两阶段提交的一个原因是不是为了恢复binlog的时候不用去检查redo_log中对应语句的状态，因为binlog恢复的时候不可能每句都去检查redo_log是否提交成功，那样太繁琐？</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">崩溃恢复用的是redolog</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/ce/db/9dba29ea.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">暴君•熊</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>1</span></a></div>
	</div>
	<div class="bd">头一次觉得概念变得如此清晰</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">👍🏿听得认真就有奖励😄</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/76/93/c78a132a.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">果然如此</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>1</span></a></div>
	</div>
	<div class="bd">一天一备份恢复的时候重放的时间更短。<br>有个问题：更新流程中，更新之前先返回这行数据，这里返回也是内存吧，这个内存和更新后写入的内存有什么区别？</div> <span class="time">2018-11-16</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/e3/44/ecc6e5b5.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Jager</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>1</span></a></div>
	</div>
	<div class="bd">在频繁更新的场景下，binlog会非常大，这时候通过更高频率的备份就可以缩短binlog的保留时长，减少磁盘空间占用，另外就是在这种更新频繁的场景下，如果一周一次备份，恢复起来没有一天一个备份那么快，我想到的一个点，不知道有没有挨到边？</div> <span class="time">2018-11-16</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">一步</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>1</span></a></div>
	</div>
	<div class="bd">老师，在两阶段提交那部分，每当一个动作完成后，会有事件通知吗？比如在binlog写入成功后，进行commit redo log，这个commit动作在成功或者失败后，会有回调或者事件通知吗？我感觉如果有通知机制的话，能更好的保持两个log的一致性，老师怎么认为呢？</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">这个就涉及“组提交”概念。是的，有通知，commit完成然后才继续后面的流程（比如返回ack给客户端）</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/ec/01/978d54af.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Justin</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>1</span></a></div>
	</div>
	<div class="bd">老师 我有一个问题 比如因为删表等操作需要回滚，但不希望数据库执行binlog中全部的语句 比如说删除语句不执行的话 可以通过自己手动筛选数据库执行的binlog类型吗？还是必须都要执行呢？</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">可以在线程里面单独设置 是否使用binlog, 也可以单独设置binlog格式，前提是要有super权限</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://wx.qlogo.cn/mmopen/vi_32/ZP5xhL8zv874pBibuLof7bzkZpD6k5dW6wdqpdRncH8O82KAtEGRG8ResUibabVcogd4CfTaDBPM9KprGbPLtcDg/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">angeltails</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>1</span></a></div>
	</div>
	<div class="bd">redo log 是记录记录这个数据改动后的值<br>而bin log 是记录这个数据是如何改动的这样吗？</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">看一下置顶评论哦</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/18/ba/b7194745.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">动脉</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>1</span></a></div>
	</div>
	<div class="bd">真好</div> <span class="time">2018-11-16</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="" class="avatar">
<div class="info">
	<div class="hd"><span class="username">何小鸟</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">Red inno独有.不持久保存<br>bin持久存档<br>任何引擎可以使用</div> <span class="time">2019-02-11</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/ec/fd/bad2abf5.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">帽子掉了</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师您好，我翻遍了答案，感觉您还是没有解释这个问题。<br>二阶段提交能够解决，binlog和redolog的一致性问题，这个是能够得到证明的。但是我的疑惑是，二阶段提交相对于之前的一个方案的优势在哪里？ 具体是先写redolog，再写binlog，然后通过判断binlog是否写完成了同一个事务，来决定redolog是否需要回滚。  <br>因为两阶段提交也要检查binlog和redolog的一致性来决定redolog是否回滚。</div> <span class="time">2019-02-09</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">这样是担心如果binlog写不成功（比如磁盘满了），事务就来不及回滚了。<br><br>可以看下15篇哈</p> <p class="reply-time">2019-02-11</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/e0/9c/1c4d12a6.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">阳光</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">mysql&gt; create table T(ID int primary key, c int);</div> <span class="time">2019-02-08</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epjDxrsib6EUtKt6ROhrCNXlEQSoZQNlCG4mPjCGyvicibYbUlGrwiarMSTV3LNoE7IPtDf1NDZ4X2ib2g/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Geek_75b4cd</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">redo log有什么用，binlog可以用来恢复数据</div> <span class="time">2019-02-01</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">看一下第15和第23篇哈 </p> <p class="reply-time">2019-02-02</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/be/d4/ff1c1319.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">金龟</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师我有个问题:<br>1.begin;<br>2.update talble set a=1 where id=1;&#47;&#47;这一步产生redo log 的prepare阶段和binlog了<br>3...其他逻辑操作（比如java里面的判断语句等等）<br>4.commit;<br><br>按照我看评论的说法如果3之前mysql crash掉，再恢复会自动提交，这里应该会有问题吧，因为下面的操作有可能会抛异常回滚之类的</div> <span class="time">2019-02-01</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">不是这样，你看一下15篇，<br>实际上我们图中的两阶段，都是发生在你的 “4.commit;”这个动作里。</p> <p class="reply-time">2019-02-01</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/cb/50/66d0bd7f.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">杰之7</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">可不可以叫您奇奇老师，😊,晚上的上一节的留言您让我发微博，这样可以更好帮我解答，我已经发了。<br><br>先回到您的问题，全量备份的周期，在什么场景下，一天一备会比一周更有优势。我觉得对于需要在更短时间内及时更新的数据一天一备更有优势。我想当发生crash之时，对于已经一天一备份的数据，可以立刻找到昨天到之后的所有数据，而一周就没有在这么快的时间上能够找到。<br><br>通过这一节的复习，老师这一节的内容通过恢复过去半个月的某时刻的数据的问题，给我们讲述了redo log与binlog,关键点是两阶段提交。通过反证法的例子给我们介绍了为什么要设计两阶段提交。<br><br>另外，这节还有一个实践性非常强的可做案例，通过binlog和全量备份扩容搭建备份的问题。我之后会先在网上查一些资料，有疑问，在微博上给您留言。<br><br></div> <span class="time">2019-01-27</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">👍 </p> <p class="reply-time">2019-01-28</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/f8/85/3c072e6f.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">这菜真香呀</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师好，两阶段提交的重点是不是应该是redo log bin log 的刷盘，而非写日志？</div> <span class="time">2019-01-27</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">额 都是重点，不过如果说耗时，确实是刷盘才是主要的耗时的点</p> <p class="reply-time">2019-01-27</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/96/4e/2acbc3a8.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">vvsuperman</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">能否拉出redo和bin在实际环境中一条记录的例子，还是有点绕，感觉是一样的</div> <span class="time">2019-01-26</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">15篇和23篇看一下 😆</p> <p class="reply-time">2019-01-26</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/74/ea/10661bdc.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">kivensu</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">---更新操作<br>涉及redo log，binlog<br>redo log是InnoDB引擎 binlog是Server层实现<br>redo log是物理日志，binlog是逻辑日志<br>redo log循环写 binlog追加写<br>数据库恢复-有备份的情况下，首先恢复临时库，然后重放故障时刻的binlog日志！<br>理解俩阶段提交的重要性！！！<br>innodb_flush_log_at_trx_commit参数设置成1，表示每次事务的redo log日志直接持久化到磁盘<br>sync_binlog参数设置成1，表示每次事务的binlog持久化到磁盘<br></div> <span class="time">2019-01-25</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">👍</p> <p class="reply-time">2019-01-25</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="" class="avatar">
<div class="info">
	<div class="hd"><span class="username">summer_7196</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">两阶段提交是原子性的吧？</div> <span class="time">2019-01-24</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">不是，如果保证原子性，就不用两阶段啦</p> <p class="reply-time">2019-01-24</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="" class="avatar">
<div class="info">
	<div class="hd"><span class="username">summer_7196</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">binlog设计成逻辑是怕生成的日志过大吗？</div> <span class="time">2019-01-24</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">不是😆</p> <p class="reply-time">2019-01-24</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/0e/6c/3f179ea8.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">翟毅</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师您好，innodb_flush_log_at_trx_commit 设置 1，并且sync_binlog也设置为1，就表示redo log和bin log都是同步刷盘的，而库的数据先写内存，后写磁盘。库的数据保存在内存是安全，因为log中有全量数据可以恢复，请问库的数据何时刷盘，是依赖操作系统的pdflush还是mysql主动调用刷盘的系统调用？这是第一个疑问。第二个疑问是既然binlog中有全量的备份，为什么还需要redo log的，感觉关闭redolog也ok的吧，也没有两阶段提交的问题了？请老师答疑解惑~~</div> <span class="time">2019-01-24</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">“请问库的数据何时刷盘” ----两种情况，redo log在推进checkpoint的时候，和脏页被淘汰出内存的时候；<br><br>第二个问题看第15篇哈</p> <p class="reply-time">2019-01-24</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/0e/6c/3f179ea8.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">翟毅</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师您好，请问日志写刷盘跟修改库的数据这两者什么关系。也就是粉板的数据什么时候算总账，在没算账之前如何能查到最新的值？希望老师答疑解惑~</div> <span class="time">2019-01-24</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">内存里是正确的值，直接从内存读走就行；<br>日志和数据的关系，是日志记录了数据从状态1到状态2的过程<br><br>这个过程持久化了，状态1也是已经持久化到磁盘的，那么状态2就可以不着急一定要写到磁盘。<br>这个是WAL机制的逻辑😆</p> <p class="reply-time">2019-01-24</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/1a/66/2d9db9ed.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">苦行僧</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">一天一备 还是一周一备 取决于业务需求 数据实时要求高的 比如金额的增减就要求一天一备</div> <span class="time">2019-01-23</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">对的，恢复的时间需求</p> <p class="reply-time">2019-01-23</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/96/84/43f24eec.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">黑白尤文</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">感觉redolog类似于redis持久化里的aof，binlog类似于redis里的rdb。</div> <span class="time">2019-01-22</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/56/8c/a8317e23.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">磊</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师您好，看到后面的文章越来越吃力，所以想回来再精细的看一遍，有个疑问，翻出了很多留言也没有找到有人问这个问题：<br>文章中写到：write pos 和 checkpoint 之前是“粉板”上还空着的部分，我的疑问是 checkpoint到write pos 这块内容的大小是如何定的，是不是一直是固定的大小？<br></div> <span class="time">2019-01-22</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">好问题，不是固定的大小哦<br><br>整个文件系统空间是固定大小的（根据系统配置）<br><br>write pos是“当前写入的位置”；<br>checkpoint是“已经将更新持久化到数据的位置”<br><br>所以如果系统TPS短时间内增大，这两个距离就会增大；<br>反之如果系统空闲的时候，这两个距离就会减小。<br><br>看到文章吃力也可以先跳过，可能之后的一篇就没那么难了。总之有问题随时发出来哈。<br><br>当然回头复习是好习惯，给你点赞👍</p> <p class="reply-time">2019-01-22</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/15/32/0a/f9b44e11.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Fj_yyyyy</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师, 我是一个初学者, 我有些不太理解为何要用redo.log, 前面举的那个记账的例子我可以理解, 但是binlog只是记录变化, 不是应该就是不停的写下去吗, 就不像是账本需要找到人, 然后对应的计入这个人的账目.....所以我觉得binlog就是那个粉板了...因为我是初学者, 所以可能很多基础知识有缺失, 老师直接指出搜索哪些相关知识可以帮助我理解这个问题也可以, 我可以自己去看</div> <span class="time">2019-01-22</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">redo log和binlog其实都是粉板的概念，<br>只是redo log是专门给innodb用的，而且在MySQL的实现里面，是用redo log来达到“崩溃恢复”这个作用的。<br><br>binlog一直的定位是“归档日志”</p> <p class="reply-time">2019-01-22</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI01GCG9MdMibbI3ykWu9zicMTTaE06bGzGRrb0MKDZaSAmcAmOUNysBaBYB1CB2atURtzbcHrdreqg/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">颜海航</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师 可以讲讲undo log吗</div> <span class="time">2019-01-21</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">08篇有涉及到一点，你看下哦<br></p> <p class="reply-time">2019-01-21</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="" class="avatar">
<div class="info">
	<div class="hd"><span class="username">二马</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">您说“redo log 可以是4组文件，每个文件大小1G”，从大并发update性能方面考虑，这个文件大小及几组一般怎样配置比较合适?</div> <span class="time">2019-01-20</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content"> 我觉得如果是1T以上的磁盘&amp;不小于64G的内存，都可以按照4*1G来配置redo log</p> <p class="reply-time">2019-01-20</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/14/31/b8/b1e0356d.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">傅萌</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，redo log处在commit状态就是已经在check point了吗</div> <span class="time">2019-01-19</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">没有，checkpoint是后台线程追上来的</p> <p class="reply-time">2019-01-20</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/b2/5a/574f5bb0.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Lukia</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">文中的redo log其实是redo+undo log吧，因为记录更新前和更新后的值都记录了的</div> <span class="time">2019-01-19</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">这里主要还是讲“数据更新逻辑”哈， undo log是有的</p> <p class="reply-time">2019-01-19</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/0a/dd/88fa7b52.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">spark</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">您好老师,下面这段话是不是矛盾了,希望老师帮忙解答下<br>既然redo log 本身就配置了一组4个文件,每个文件的大小是 1GB，那么这块“粉板”总共就可以记录 4GB 的操作,这个时候不是持久化到磁盘吗?<br>为什么还要设置<br>innodb_flush_log_at_trx_commit 这个参数设置成 1 的时候，表示每次事务的 redo log 都直接持久化到磁盘.</div> <span class="time">2019-01-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">是这样的，<br>innodb_flush_log_at_trx_commit =1 的时候，才是确保redo log里的数据是持久化到磁盘的；<br><br>如果是innodb_flush_log_at_trx_commit=2， 其实只是“写到redo log文件，但是没有持久化(fsync)”</p> <p class="reply-time">2019-01-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/62/10/c1b4770d.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">球魁</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师你好，按照上面所讲我觉得redo有点多余了，binlog 日志可以恢复某个点之前的操作，并且在异常重试的时候只有binlog 和redo共同存在的时候才会进行commit ，我用binlog也可以恢复数据，所以redo是不是多余了呢</div> <span class="time">2019-01-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">看一下15篇哈</p> <p class="reply-time">2019-01-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/a0/fe/ac5a62f3.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">grey</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师你好，复习这篇文章的时候有几个新的问题，还请老师解答：<br>        1. 如果更新语句涉及到索引，索引是什么时候被更新的，是否跟数据一样，先更新内存，然后再持久化到磁盘？<br>        2. 如果事务失败，回滚的时候，是否也会写redo log和binlog。回滚涉及到索引的更新话，索引如何回滚的呢？</div> <span class="time">2019-01-15</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">1. 索引也是数据的一部分哈，一样的策略<br>2. 会写redolog，打上回滚标签，binlog就直接丢弃啦。回滚都是把没用的内存版本删掉</p> <p class="reply-time">2019-01-15</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/10/d9/acc787a6.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">李大飞</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">落下了很多，正在不断学习。现在在公司直接利用每天午休的2小时来学习，感觉很充实，丁奇大大的文章很到位，评论区也很到位，常有高手出没，感谢丁奇大大和你们！感谢！</div> <span class="time">2019-01-15</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">👍🤝</p> <p class="reply-time">2019-01-15</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/68/a7/abb7bfe3.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">聪</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师有个问题，WAL可以保证之前提交的记录不会丢失。所以是不是只能是checkpoint过的记录不会丢失呢？那没有checkpoint过的数据但是已经write到redo log里的，在数据库发生问题了，应该都丢失了吧。如果发生这样的问题，如何恢复呢？</div> <span class="time">2019-01-15</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">不会呀，崩溃恢复的时候，会从checkpoint开始往后主动去刷数据的，没有checkpoint过的并不会丢失，只是崩溃恢复的时候花点时间</p> <p class="reply-time">2019-01-15</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/38/c8/dfc7a25b.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">readyao</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，任何事务如果在回滚的时候系统异常重启了或者回滚操作失败了， 那是不是就导致数据状态可能不一致？ 这样情况会发生吗？ 如果发生了怎么避免？</div> <span class="time">2019-01-13</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">没问题的<br><br>回滚中系统异常重启，重启后会继续回滚😆<br><br>是通过扫描redo log状态来发现的</p> <p class="reply-time">2019-01-13</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/38/c8/dfc7a25b.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">readyao</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师你好，我想问一下，如果最后一步commit提交的时候MySQL异常重启了，那怎么办？ 那此时redo log还处于prepare的状态，但是binlog已经写入了。这样是不是就也不一致了？</div> <span class="time">2019-01-13</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">不会，你看下15篇，有说明哈</p> <p class="reply-time">2019-01-13</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/f3/89/fcfecb46.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">我爱学习</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，有个地方不明白想请教下：为什么binlog不具备craahsafe功能呢</div> <span class="time">2019-01-12</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">看下15篇哈</p> <p class="reply-time">2019-01-12</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erFY9H3mxyTpZ9gxAmdeKic565hicicDZmv7cjswd8hdernmxib0chdQrlDNKUZQ8AticQCgDdgVEmJNuA/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">changshan</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师好，【update 语句执行流程】这张图的update更新流程是不是有点问题啊，既然是WAL了，为什么是将这一行的c值加1，写入新行，然后才是写入redo log呢？</div> <span class="time">2019-01-09</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">WAL是指在“数据真正写入对应的磁盘数据页“ 之前写日志</p> <p class="reply-time">2019-01-10</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/14/85/88/9b2973fc.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">jzyu</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">关于两阶段提交有个问题想请教一下。写redo log处于prepare阶段后，如果写binlog失败是会回滚redo log的记录吗？</div> <span class="time">2019-01-09</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">不用回滚日志，只需要打上“rollback”标签</p> <p class="reply-time">2019-01-10</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/14/e6/98/289484e2.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">TM_01</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，innodb的update数据，是何时刷入磁盘的，也是和redo log buffer在commit阶段写入通过fsync延迟写入的机制一样嘛</div> <span class="time">2019-01-08</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">没看懂你的意思， “innodb的update数据” 是什么意思，是update语句，还是“引擎更新数据”这个动作</p> <p class="reply-time">2019-01-10</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/6a/07/96c1e57f.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">大牙</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，还是对 redo log 的内容和 bin log的内容有些疑惑，假设redo log 和 bin log 都想记录“把c 从 0改成了1” 这个操作，那么redo log 就是 记录“把c 从 0改成了1”，bin log 记录的是实际的sql 语句：“update table set c = 1 where ... ” 或者记录 具体修改的行之前的值和更改之后的值。<br><br>我认为上述记录的内容很类似啊，一个系统crash之后，假设两个log 都可以用来恢复，我可以用bin log来恢复吗？如果不能，是哪里不能呢？ <br><br>谢谢老师</div> <span class="time">2019-01-05</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">看一下15篇，有提到这个问题😄</p> <p class="reply-time">2019-01-06</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/a5/ff/884d865e.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Geek_89bbab</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">引用@高枕的留言<br>1 prepare阶段 2 写binlog 3 commit<br>当在2之前崩溃时<br>重启恢复：后发现没有commit，回滚。备份恢复：没有binlog 。<br>一致<br>当在3之前崩溃<br>重启恢复：虽没有commit，但满足prepare和binlog完整，所以重启后会自动commit。备份：有binlog. 一致<br>—————<br>在3之前崩溃后，重启是如何判断prepare的redo log 已经记录了相应的binlog日志记录的？难道是redolog里面有一个事务id，binlog也有回应的事务id，通过在binlog中查询是否包含有对应事务id的binlog吗？求老师指点迷津</div> <span class="time">2019-01-05</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">哈哈你猜对啦 👍🏿<br><br>看一下15篇</p> <p class="reply-time">2019-01-05</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/14/1f/2e/27d8b06d.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">蓝天</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">请教下老师：关于先写redo log再写binlog的分析有些不理解。假设redo log写完后binlog还没写完，这时数据库出现意外宕机，修改数据的物理记录虽然记录到redo log，但是事务还没提交，我理解未提交意味着数据没有最终落盘，您说的c=1是因为innodb的崩溃恢复机制能把未提交的事务恢复到提交状态么？</div> <span class="time">2019-01-03</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">如果redo没落盘，那会回滚的</p> <p class="reply-time">2019-01-03</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/14/b0/37/d654fbac.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">几近虚年</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">看了2遍稍微看懂了一些，理论性的知识点还是要多看几遍才行...<br>工作1年多的，之前只知道增删查改的sql语句，跟着老师学习，感觉发现了新大陆一样，学起来也感觉新奇，有意思。<br>跟着老师学完看能进步多少，嘿嘿嘿</div> <span class="time">2019-01-03</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">一起加油</p> <p class="reply-time">2019-01-10</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/06/cf/ef0da49a.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">三木圈圈</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">一天一备和一周一备的场景有一个因素，就是取决于服务器硬件的配置，比如redo log的容量，如果一天一备在容量小的情况下就安全些，如果一周一备，需要更大的配置。当然一天一备从另一个维度看，需要对服务器另一方面的花销，就是这个频率的备份IO的花销比一周一备更大。</div> <span class="time">2019-01-03</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">👍🏿</p> <p class="reply-time">2019-01-10</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/2a/76/315cccab.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">低调</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">这个binlog和主从的binlog是一个概念么？这个binlog不是可以关闭么，那两阶段提交也就没有意义了吧，懵了~</div> <span class="time">2019-01-03</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">是同一个binlog😄<br><br>你看一下15篇，有说到你提的这个问题</p> <p class="reply-time">2019-01-03</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/03/15/293a185d.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">JRich</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，binlog和redolog的那两个参数都设置为1的话，每次事务结束之后立马持久化到磁盘会不会影响性能。</div> <span class="time">2019-01-03</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">会，你明天看下今晚会发的23篇，有说到😄</p> <p class="reply-time">2019-01-03</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/8d/b4/ff82483d.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">邵俊达</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">请问，当目前改动只写入了 redo log 还没有写入磁盘的时候，这时有一条查询语录会发生什么？不会不一致么？</div> <span class="time">2019-01-03</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">08篇看一下😄</p> <p class="reply-time">2019-01-03</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/d3/b3/4f5550c0.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">大宝</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师 能不能问一下binlog为什么不能保证crash safe</div> <span class="time">2019-01-02</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">看下15篇</p> <p class="reply-time">2019-01-02</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/14/c7/99/6403695d.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">强哥</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">喜欢孔乙己这个例子，说明read log很清楚</div> <span class="time">2019-01-01</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">🤝</p> <p class="reply-time">2019-01-02</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoqjK62ZEuj3220ZAAqLBIgiayGn2MfvSOJb1uPz2TmwibSfxKURFj68ITdn6K0EK6MRW1llJBSzLJg/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">just4cn</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">接前一个问题<br>原问题：更新数据的过程是在确保数据能成功更新的情况下就写binlog，然后事务才提交commit，通过binlog来同步数据，当接收到binlog后还需要获取其它数据进行计算，此时立刻去读数据库会发现读不到刚更新的数据。<br>您的回复：做好区分，对延迟敏感的请求，需要去主库上查询。<br>------<br>感谢老师的回复，之前表达的不完善。这里就是接收到主库发出的binlog后，立刻去主库查询数据，有时查不到此条binlog对应的更新内容，当sleep 0.5s(或更久)再去获取便能取到正确的数据，初步怀疑是binlog发送时主库的事务尚未commit导致的，不知道有没有什么好的解决方法。</div> <span class="time">2019-01-01</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">确实有可能，binlog确实先发了，你还有这种场景啊，<br><br>比较少见到这种方案哈，我现在能想起来的就是轮询了。<br>当然还有可以去查解析出binlog里面的线程id 和时间戳，然后去查select  * from information_schema.innodb_trx where trx_mysql_thread_id=$tid and trx_started &lt; $timestamp;<br>必须返回空才行，本质上还是轮询就是了…<br><br>不过，<br>都拿到binlog了，看看能不能考虑设置成row格式，直接解析更更好些；<br><br></p> <p class="reply-time">2019-01-01</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoqjK62ZEuj3220ZAAqLBIgiayGn2MfvSOJb1uPz2TmwibSfxKURFj68ITdn6K0EK6MRW1llJBSzLJg/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">just4cn</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，问个困扰较久的问题：目前更新数据的过程是在确保数据能更新成功的情况下就写binlog了，然后事务才提交commit，如果通过binlog来同步数据，当接收到binlog后还需要获取其它数据进行计算，此时立刻去读数据库的会发现有时候读不到刚更新的这条数据，这个有没有什么办法避免？</div> <span class="time">2019-01-01</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">这个是读写分离常见的问题…只能做好区分，对延迟敏感的请求，需要到主库上去查</p> <p class="reply-time">2019-01-01</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/14/d1/4f/c52f9f6d.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">陈星</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师您好，如果redo log和bin log都已经提交，但是，没有写入到磁盘中的时候，突然发生重启，那么此时，进来的查询请求，会得到及时的响应吗？。</div> <span class="time">2018-12-29</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">重启过程中连接都连不了<br><br>你是说重启之后吗？崩溃恢复完成后开始提供服务</p> <p class="reply-time">2018-12-30</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/23/98/bd96932f.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">xm</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">Mysql redo、undo、bin、relay log这几个日志都晕了，老师会将下这几个日志的么？</div> <span class="time">2018-12-28</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">会，往后看哈</p> <p class="reply-time">2018-12-28</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/f9/86/ba830df4.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">小叶</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">接上一个问题。<br>写内存的时候查询到的数据是不是最新的数据？如果写入内存成功，redolog，binlog失败了，会不会造成读到这个非法数据呢？</div> <span class="time">2018-12-28</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">不会，事务没提交呢，MVCC会让别的线程看不到这个内存的修改的</p> <p class="reply-time">2018-12-28</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/f9/86/ba830df4.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">小叶</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师你好，有个问题<br>写入新行、新行更新到内存、写入redolog写入binlog。这4个操作应该是原子性的吧？<br>这边的写内存，写redolog，写binlog是怎么保证原子性的呢？<br><br><br>还有提个建议，文中图的字体有点过于难分辨了。</div> <span class="time">2018-12-28</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">只是逻辑上原子，实现上不会加这么大一个锁哈</p> <p class="reply-time">2018-12-28</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/be/d4/ff1c1319.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">金龟</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">binlog的写入时机，应该是在事务提交的时候一次性写入的吧，老师</div> <span class="time">2018-12-28</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">对的</p> <p class="reply-time">2018-12-28</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKqDeE8vfUhETcZibFiacSgn863AIqNSGHGgvb1flfLGfOJcQjZomEeh9ibM3WFjWDia5eVMrRDKnUbOg/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">paul</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">请老师回答下，前面一个同学的问题，我也想到这个问题。 问题如下：<br><br>“ 老师，您好。您说MySQL 使用WAL，先写日志再写磁盘。请教一个问题，<br><br>执行一条Update 语句后，马上又执行一条 select * from table limit 10。<br><br>如果刚刚update的记录，还没持久化到磁盘中，而偏偏这个时候的查询条件，又包含了刚刚update的记录。<br><br>那么这个时候，是从日志中获取刚刚update的最新结果，还是说，先把日志中的记录先写磁盘，再返回最新结果？“</div> <span class="time">2018-12-27</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">都不是，直接从内存读走，内存里可是有修改的最新的结果哦</p> <p class="reply-time">2018-12-28</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/4d/0d/63d5a1f8.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">tailender</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">update 执行过程的图里 写入新行深色 是代表已经写入磁盘了吗？ 不是先写redo log，大小满了才写磁盘吗</div> <span class="time">2018-12-27</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">这里说的是commit阶段哈</p> <p class="reply-time">2018-12-27</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/14/b1/7d974f0a.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">黄明恩</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师好，redo log是innodb特有的，那么其他存储引擎有这个机制或者类似思路吗？要不然其他引擎的更新性能和crash safe能力都没保证吗？<br><br>还有就是顺序写和随机写在SSD硬盘开启差别很大吗</div> <span class="time">2018-12-26</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/7a/68/f2bc8fcb.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Hyun</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">如果没有或者禁用 binlog， 我觉得效率会更高一些。不知道 MySQL 后期是不是会调整。2 段式提交，理论上是用于分布式环境的，用在单机 OLTP 里面，是不是贵了点？</div> <span class="time">2018-12-26</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/1d/30/4a82c7af.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">fancion</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">1、其实这个地方不只是有redo，应该还有一个undo日志吧，用于保障未提交事务不会对数据库的ACID特性产生影响<br>2、Binlog模式除了statement和row，是不是还有混合模式</div> <span class="time">2018-12-26</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/6b/c6/2534e14a.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">spraith</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">我觉得也可以这样理解：redolog和binlog可以看成是数据日志的两种不同存储方式（在短时间内），所以它们必须是一致的才行，不然它们本质上就不相同了。</div> <span class="time">2018-12-26</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">是的哦😄</p> <p class="reply-time">2018-12-26</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="" class="avatar">
<div class="info">
	<div class="hd"><span class="username">坏淡一个</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">如果有一个备份库的时间点，最接近误删除的时间点，但这个备份库的时间比误删除的晚，能不能用binlog倒过来回溯？</div> <span class="time">2018-12-25</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">binlog都保留了、并且是row格式、并且误删操作是“delete” 才行</p> <p class="reply-time">2018-12-25</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="" class="avatar">
<div class="info">
	<div class="hd"><span class="username">坏淡一个</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">执行器将值+1后，调用引擎接口，写入这行新数据，然后“引擎将新数据更新到内存中”，也就是说新数据是缓存在内存中的？在redo log把数据写入磁盘前，查询的都是内存中的数据？是不是等redo log把新数据实际写入磁盘后，这些缓存数据才会失效？</div> <span class="time">2018-12-24</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="" class="avatar">
<div class="info">
	<div class="hd"><span class="username">坏淡一个</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">用了两阶段提交，如果redo log处于prepare状态，然后binlog写入完成，这时，在把redo log改为commit状态的过程中出问题崩溃重启了，这种情况会怎么办？</div> <span class="time">2018-12-24</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">看下15篇</p> <p class="reply-time">2018-12-24</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/a6/43/cb6ab349.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">%E6%9D%8E%E6%9D%83%E6%9C%97</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">redo log记录了数据页做了什么变动，他会在适当的时候刷盘。而我们查询是从磁盘查出来的，如何保证我们读到的数据是更新后的数据呢？</div> <span class="time">2018-12-23</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/43/38/72feb2e0.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">哇！怎么这么大个</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师您好，有个问题需要请教您，我发现ibdata0文件无限膨胀并且不分裂初ibdata1文件，具体会是什么原因导致，有没什么有效的方式解决</div> <span class="time">2018-12-20</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">就是回滚段导致的。<br>Ibdata不会帮你自动生成ibdata1,<br>会变大是因为有事务没提交，导致别的事务更新的回滚段不能回收，最终把文件撑大。<br>查一下数据库里的长事务，kill掉。不过这样只能避免继续膨胀，现有的空间不能回收了，<br><br>实在要回收只能靠把数据逻辑导入另外一个干净的库…</p> <p class="reply-time">2018-12-20</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/0c/c2/310f15a4.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Geek_zy</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">又一个疑问如果把redolog的innodb_flush_log_at_trx_commit设置为1<br>不就相当于每一次都要提交到磁盘，就用不到他的记录到小黑板上的功能（先都写到日志，找一个合适的时间记录到磁盘），不是把他的优势给弄丢了吗？<br></div> <span class="time">2018-12-20</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">没丢，顺序写比随机写的成本低</p> <p class="reply-time">2018-12-20</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/a4/97/83e63e00.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">张锋</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">在一个表上有更新的时候，跟这个表有关的查询缓存会失效，所以这条语句就会把表 T 上所有缓存结果都清空。<br><br><br>如果做了主从，把所有的读操作都指到从库上进行，主库update表，从库同步更新表数据，这个时候从库会不会有清空查询缓存的操作？<br><br></div> <span class="time">2018-12-20</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">会，数据同步到从库其实也是在从库做更新，相同逻辑</p> <p class="reply-time">2018-12-20</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/ae/01/12818bab.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Geek_4de7b1</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">请问一下执行最后commit，innodb的commit具体是做了哪些操作呀？移动checkpoint指针吗？</div> <span class="time">2018-12-19</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">不是，<br>Redolog上打上commit 标签，写盘</p> <p class="reply-time">2018-12-20</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/6a/2d/ec4ed8ce.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">shawn</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，对于WAL我还有两个疑问如下：<br>1. 比如WAL 有两个记录（update amount = amount +1 where id = 2,  update amount = amount +1 where id = 200000 ）,虽然wal文件是顺序性的，但是数据库中id =2 ,id = 200000记录可能相差很远，这种寻址速度（寻找数据库中记录）应该也不会很快。不过wal到数据库文件操作是异步后台操作，不影响效率对么？<br><br> 2.另外根据前面事物隔离级别，一条记录只要写入WAL且WAL 持久化到磁盘，就算事物的原子性和持久性保证了对么。 至于WAL数据什么时候更新到数据库文件里不用管对么？<br><br>期待老师的解答，谢谢！</div> <span class="time">2018-12-19</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">两个理解都对</p> <p class="reply-time">2018-12-21</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/50/99/44378317.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">李皮皮皮皮皮</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师你好，看完这篇我有几个疑问：<br>1.如果不设置立即刷到磁盘标志，redo log和binlog应该是放在内存中的吧，它们应该是写到两个不同的文件中的，会不会出现部分写的问题呢？<br>2.prepare-写binlog-commit这个过程中，如果异常重启了。怎么根据binlog找到对应的redo log或者反过来。难道有一个全局唯一id？<br>3.如果在上面写binlog阶段崩溃了，binlog未写入成功。恢复程序会撤销prepare状态的redo log。redo log和最终磁盘中的数据更新是不是只会存在一个？删redo log和写磁盘会不会出现不一致，比如中间又异常重启了</div> <span class="time">2018-12-18</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/50/99/44378317.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">李皮皮皮皮皮</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师你好，看完这篇我有几个疑问：<br>1.如果不设置立即刷到磁盘标志，redo log和binlog应该先在内存中的吧。它们应该是写到两个不同的文件，会不会存在部分写的问题<br>2.prepare-写binlog-commit这个过程中，如果有异常重启。回复程序怎么根据binlog查找redo log或者反过来呢？其实可以有连续执行几个相同的sql语句。难道有一个唯一的id关联吗？<br>3.redo log是最终硬盘中数据更新是不是只能存在一个？比如一次更新，要么更新到最终数据了，要么有一条redo log。不能两者都有。如果只能有一个，那么紧跟着更新后面的针对这个更新的字段查询怎么处理？</div> <span class="time">2018-12-18</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/12/03/c657c350.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">MichaelChen</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">使用show [session|global] status可以查看统计各种SQL执行数以及MySQL各种状态，不写中间的global，默认参数为session，只查询当前链接中的参数，所以我们一般加上global，查询MySQL从上一次启动至今的数据统计，例如：show global status like &#39;Com_select%&#39;用来查询MySQL执行select 的次数</div> <span class="time">2018-12-17</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/bc/fc/cf98963a.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">张伟益</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">我有两个问题<br>1.redo.log你说记录的是“做了什么改动”，这个以怎样的形式来显明改动的内容？<br>2.既然binlog记录了sql，那不是可以通过sql来回复数据吗，它为什么不支持crash safe呢不太理解</div> <span class="time">2018-12-17</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/77/fd/c6619535.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">XD</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">执行器先找引擎取 ID=2 这一行。ID 是主键，引擎直接用树搜索找到这一行。如果 ID=2 这一行所在的数据页本来就在内存中，就直接返回给执行器；否则，需要先从磁盘读入内存，然后再返回。<br><br>执行器拿到引擎给的行数据，把这个值加上 1，比如原来是 N，现在就是 N+1，得到新的一行数据，再调用引擎接口写入这行新数据。<br><br>-----<br><br>老师，这里有个疑问。执行器为什么不直接调用引擎的更新接口而非要先获取这条数据呢？<br>假如满足条件的数据很多，有1000条，innodb也会全部返回给执行器、执行器一条条记录去修改完、然后再调用写入接口一条条的去更新吗？</div> <span class="time">2018-12-16</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/87/dd/4f53f95d.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">进阶的码农</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">innodb_flush_log_at_trx_commit 和 sync_binlog 都设置成1，那么都是每个事务结束直接写磁盘，那是不是就浪费了WAL的作用，这样每一次的更新操作都需要写进磁盘，然后磁盘也要找到对应的那条记录，然后再更新，整个过程 IO 成本、查找成本都很高。</div> <span class="time">2018-12-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">这个是为了保证数据安全必须的成本，但是WAL还是有用的</p> <p class="reply-time">2018-12-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/f7/0a/067537fc.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">别皱眉</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，您好。我是一个小白<br>这里有个问题 希望您看看 谢谢😃<br>执行器先找引擎取 ID=2 这一行。ID 是主键，引擎直接用树搜索找到这一行。如果 ID=2 这一行所在的数据页本来就在内存中，就直接返回给执行器；否则，需要先从磁盘读入内存，然后再返回。<br><br>上篇文章中您说到<br>执行器调用InnoDB引擎取这个表的第一行，然后返回给执行器，由执行器判断ID是不是我们想要的值，在留言娶里您回答同学的问题说这个判断动作是由执行器发出的<br>但是这里怎么是InnoDB判断了呢<br><br></div> <span class="time">2018-12-16</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/f8/e9/f16a536b.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">极客-绝影</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">回答问题<br>老师好，个人认为备份周期没有统一或者固定标准与规范，合适才是最好的，那么我认为合适有三个主要的考虑指标，分别是业务场景，数据重要性和数据量的多少。</div> <span class="time">2018-12-14</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">对的👍🏿</p> <p class="reply-time">2018-12-15</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/14/32/0b/981b4e93.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">念你如昔</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">仔细考虑了一下两阶段提交的异常情况：（请老师看看有没有问题）<br>             因为是采用的redolog来做崩溃后恢复的，所以在检测到有redolog处于prepare状态时，他应该会扫描binlog读取xid，将此xid与prepare事务链表中的xid做比较，如果存在，则前滚；如果不存在，则回滚。<br></div> <span class="time">2018-12-13</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/14/32/0b/981b4e93.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">念你如昔</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，两阶段提交中，如果redo log prepare之后，出现意外情况，事务会回滚。我有个疑问，如果服务器挂了的情况，比如说断电等情况，那么此时事务还会回滚吗</div> <span class="time">2018-12-12</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/f4/d6/0ff4ebe5.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">雨中漫步</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">有个疑问，据之前的理解，应该是commit完成后才会写入binlog到binlog cache。看您说的update过程是先落盘binlog再commit。假设这样的话，在主从复制中，在主库事务未提交的情况下，binlog就已经被同步到从库了。</div> <span class="time">2018-12-12</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">不是哦，我们说的都是“提交过程”哦。<br><br>在事务“执行计期间”，binlog 没有写盘，如你所说，这时候在binlog cache,没往备库发的<br><br></p> <p class="reply-time">2018-12-12</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/55/f7/af3feb56.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">itczl</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，如果在执行器提交commit时挂了咋么办</div> <span class="time">2018-12-12</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">要看阶段。<br><br>第15篇会说</p> <p class="reply-time">2018-12-12</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/cd/9b/451d8c08.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">patient</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">redolog使用两阶段提交，会不会出现一种情况：redolog完成了prepare, 并且binlol也成功了，在redolog 进行commit时失败？</div> <span class="time">2018-12-12</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/b4/57/95c14e47.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">吾道</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">买了很多课程，感觉就这个讲得最容易弄懂😂</div> <span class="time">2018-12-12</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/71/7f/4eba4781.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">木小易</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，您好，最近生产环境遇到一个问题，show full processlist中抓到一个update语句，根据主键更新的，时间是30s，state为updating，但是slow log中没有记录，我知道slow log中只会记录执行时间&gt;long_query_time的查询，不包括lock_time。我的问题是updating过程中做了哪些事情，是有加锁的动作吗？</div> <span class="time">2018-12-11</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">那看来就是被行锁锁住了…</p> <p class="reply-time">2018-12-12</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/14/59/68/b1b5e8bb.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">刘常青</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，数据库在卡的情况，在插入数据的时候会出现重复数据，这个原理是啥?是写入binlog日志在提交事务处于commit状态一直处于等待状态，出现的数据重复吗？</div> <span class="time">2018-12-11</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">不是，应该是你们业务超时重试导致的吧…</p> <p class="reply-time">2018-12-12</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/df/0e/4e2b06d5.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">流浪在寂寞古城</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">没有太理解为什么redo分为两段就可以保证一致，可以举个例子吗？</div> <span class="time">2018-12-11</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">第15篇答疑会说哈</p> <p class="reply-time">2018-12-11</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/09/8e/2ff2823e.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">howhigh</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，我有一个疑问，如果临时账本数据是写在内存里的，那计算机宕机后，内存数据岂不是没有了，那为啥具备crash_safe的能力？</div> <span class="time">2018-12-10</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/13/35/b6328a05.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">如余</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">丁奇老师，问一下为什么redo log 中第四个文件不写内容，具体承载着什么作用</div> <span class="time">2018-12-10</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">没有不写呀，都要写的</p> <p class="reply-time">2018-12-10</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/e02A8tGW0yw86v11TrfaydPegHRDMyq4OL1iauZia7MVV9ibSNANibibVZTjP1GviacnNWhEzHvJuXUX09bdTiaGraUOQ/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">pain</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">redo log 跟 bin log 都是针对事务吧？</div> <span class="time">2018-12-09</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epLbHgQhI0pFNI9iblcKdXqI8F5Fc4fTW0OR78oPdT8rsdq6kIicLhjAUO8atSTIpYk66X1dv08RFcw/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">TimiPai</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，您好，我在网上有看到一个innodb_log_buffer， 好像是介于内存和redo log之间的一个缓冲区，不知道这个该怎么理解呢？或者说它的优势在哪？</div> <span class="time">2018-12-09</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">嗯好几个评论说到，在答疑篇说这个哈</p> <p class="reply-time">2018-12-09</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/e6/26/de4f01e7.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Genius  小嘉</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，二阶段提交，是写完binlog就会返回给程序执行成功么？还是必须redo commit才会给程序成功？</div> <span class="time">2018-12-09</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/a3/40/e0df3b84.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">力挽狂澜爆炸输出的臭臭宁</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">为什么不能用binlog的数据进行crash恢复呢？</div> <span class="time">2018-12-08</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">15篇会说哈</p> <p class="reply-time">2018-12-09</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/18/d0/49b06424.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">qinggeouye</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">redo log 记录物理日志（做了什么改动），事物的提交在 redo log 里完成，bin log 记录逻辑日志（执行语句SQL的原始逻辑、记录更新前后的内容）；<br><br>「两阶段提交」那块，先写入 redo log 处于 prepare 状态，再写 bin log，最后 redo log 提交事物处于 commit 状态。<br><br>有个疑问：<br>如果在最后 redo log 提交事物这一步，数据库发生了 crash 导致没有提交成功，但由于 bin log 里已经记录了逻辑日志，数据恢复的时候仍然从 bin log 取出逻辑SQL来恢复数据吗？</div> <span class="time">2018-12-08</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTL17yp3TmdQNXWELQvjIA2azwZ6ib7Riae9Hcf2YFl1uvnvocQoicTOtJLnvjUPtpbYhSng7DtPR9lfg/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">wvalianty</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，请教一个问题，两段式提交，如果redolog  prepare和binlog都成功了，最后commit失败了，会怎样？</div> <span class="time">2018-12-08</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/e6/26/de4f01e7.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Genius  小嘉</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，问个问题，redo log不是先写redo log buffer,然后再写到redo log磁盘文件么？  看您说的好像没有写到refo log buffer 这个过程啊。</div> <span class="time">2018-12-08</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">这个问题15篇会说哈</p> <p class="reply-time">2018-12-09</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/e8/5c/561caff2.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">陈</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">如果值相同有判断不写binlog那么按逻辑，数据应该也不会在内存中改，从而减少写磁盘，从而不会写redo log,至于怎么判断就要去看write pos是否有改变，可以通过一个大量的更新相同值语句来测试，这是我想到的方法，不知老师是否有其他方法？</div> <span class="time">2018-12-07</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">你是不是要回复11讲的，回复到02来了😓</p> <p class="reply-time">2018-12-07</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/cd/aa/33d48789.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">卫江</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">我想问一下，update最后一步，既修改对应redo日志的状态为commit，这个时候，系统crash，会出现什么情况</div> <span class="time">2018-12-07</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">重启后，崩溃恢复过程中提交该事务</p> <p class="reply-time">2018-12-08</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/14/04/b8/3fd2f448.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">lucky star</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">建议老师把redo日志和binlog日志两阶段提交那里说仔细一点，比如说： <br>      1，binlog是有固定格式的，是可以检查出来写binlog的时候有没有出错（可以解疑写binlog时出错了恢复的时候怎么知道binlog数据是否正确的问题）；<br>      2， binlog和redo日志是有事物ID对应的（可以解疑如果刚好写完redo第一阶段， 还没开始写binlog，然后挂掉了， 这时候binlog是格式正确的， 恢复的时候是怎么确定binlog数据不缺失的问题）；<br>这都是我带着疑问从评论里找到的答案！ 如果在原文中写上会给读者省掉很多时间去找答案<br></div> <span class="time">2018-12-07</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">嗯，其实每个同学疑问的点可能都不一样，没法全部展开。答疑篇和评论区其实就是扩展正文的</p> <p class="reply-time">2018-12-07</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="" class="avatar">
<div class="info">
	<div class="hd"><span class="username">broken_open</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">1 prepare阶段 2 写binlog 3 commit<br>当在2之前崩溃时<br>重启恢复：后发现没有commit，回滚。备份恢复：没有binlog 。<br>一致<br>当在3之前崩溃<br>重启恢复：虽没有commit，但满足prepare和binlog完整，所以重启后会自动commit。备份：有binlog. 一致</div> <span class="time">2018-12-06</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/ed/d2/e3ae7ddd.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">三木禾</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">还有如果二阶段操作，在binlog写入磁盘之后，MySQL崩溃了，事物还未提交，此时redolog的状态还是prepared，如何处理?<br>还有如果二阶段操作，在binlog未写入磁盘，MySQL崩溃了，事物还未提交，此时redolog的状态还是prepared，如何处理?<br></div> <span class="time">2018-12-06</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/ed/d2/e3ae7ddd.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">三木禾</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">然后，从备份的时间点开始，将备份的 binlog 依次取出来，重放到中午误删表之前的那个时刻。<br>这，这段话不太理解，重放，将binlog取出来</div> <span class="time">2018-12-06</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/ed/d2/e3ae7ddd.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">三木禾</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">貌似不太理解数据页的概念，希望下次讲解一下数据库是如何组织数据的，谢谢老师</div> <span class="time">2018-12-06</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/5b/53/200fda62.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">vivien_zh</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">一周一备 需要保证在恢复的时间点之内的所有binlog日志必须没有损坏<br>一日一备 则需要更多的存储空间，而且恢复的速度也会快很多</div> <span class="time">2018-12-06</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/5b/53/200fda62.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">vivien_zh</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">感谢老师 细致的说清楚了redo log 和binlog的区别，更主要的是具体的解释了数据库异常crash后，通过备份+日志恢复中间的差异。</div> <span class="time">2018-12-06</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="" class="avatar">
<div class="info">
	<div class="hd"><span class="username">null</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">谢谢老师回复。<br>老师经常半夜回复留言，上次有一条是凌晨 2 点多回复，老师辛苦了！！<br><br>---<br><br>疑问一：<br>老师您回复：WAL机制里面有“已经提交但是还没落盘”的数据，binlog恢复不了这些。<br>这是因为一开始 binlog 就是设计为归档日志，因此恢复不了“已经提交但是还没落盘”的数据么？<br>从图“update 语句执行流程”来看，提交前已经写 binlog 日志了，即使没落盘，这部分数据仍然是未丢失的。<br><br>疑问二：<br>文章的例子：某天下午两点发现中午十二点有一次误删表，需要找回数据<br>最近一次全量备份文件 + 重放到误删表之前那一时刻，这样十二点到两点的数据是不是丢失了，恢复不了了？<br><br>谢谢老师，晚安！</div> <span class="time">2018-12-06</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">1. 但是binlog并不知道他们没有落盘，这个是引擎内部机制。不会去重新执行。<br><br>2. 对… 一般是这样，恢复出一个临时库是误删前的。然后把里面的数据按需取出来放到线上的库里</p> <p class="reply-time">2018-12-06</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/06/f5/0f1adaf3.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">戴</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">请问答疑的文章在哪里看呢</div> <span class="time">2018-12-05</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">第十五篇😄</p> <p class="reply-time">2018-12-05</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/e8/5c/561caff2.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">陈</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，今天遇到一个问题，当对一个表T中的字段t1做两次更新，update T set t1=2 where id=125;<br>update T set t1=2 where id=125;两次更新的值都相同， binlog只会记录一次日志，如果T表中的t1值原来就等于2，则Binlog不会记录日志。从原理中得知这个操作是没有导致行改变，因此不记录日志，Mysql源码更新操作是否有新值和原值的判读逻辑？<br></div> <span class="time">2018-12-05</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">有判断，相同就不写binlog了。<br><br>不过你这个问题可以衍生一个好问题，我问你一下，你怎么判断，这时候innodb里面改了(执行了修改动作，只是值不变），还是没改（直接跳过）？</p> <p class="reply-time">2018-12-05</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/ee/0d/892eb1bb.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">清凉薄荷糖</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">具体来说，当有一条记录需要更新的时候，InnoDB 引擎就会先把记录写到 redo log（粉板）里面，并更新内存，这个时候更新就算完成了。同时，InnoDB 引擎会在适当的时候，将这个操作记录更新到磁盘里面，而这个更新往往是在系统比较空闲的时候做，这就像打烊以后掌柜做的事。<br>老师，这一段里提到的将这个操作疾苦更新到磁盘里，是从redo log刷新过去还是直接从buffer pool呢？</div> <span class="time">2018-12-05</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">Buffer pool中</p> <p class="reply-time">2018-12-05</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/f3/f6/55f8364f.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">股海旗舰</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">高枕同学提到的，有点疑问，烦请老师解答：<br>1 prepare阶段 2 写binlog 3 commit<br>..........<br>当在3之前崩溃<br>重启恢复：虽没有commit，但满足prepare和binlog完整，所以重启后会自动commit。备份：有binlog. 一致<br><br>疑问：虽没有commit，但满足prepare和binlog完整，所以重启后会自动commit。<br>--这里的binlog完整，通过什么方式或机制来判断？</div> <span class="time">2018-12-04</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">每个事务的binlog日志都有标准的结尾的</p> <p class="reply-time">2018-12-05</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/f3/f6/55f8364f.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">股海旗舰</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">1、写入redolog prepare<br>2、写binlog<br>3、提交事务(commit)<br>如果2执行完，在执行3之前宕机，这时候，binlog已经写完了，如果使用binlog做备份恢复，那么恢复的库和实际的库的数据(MySQL重启后会将事务回滚？)应该是不一致吧。<br>如果数据一致，那不是第3步都不需要了？<br>我记得以前看过文档，要处理这种情况，需要将参数 innodb_support_xa设置为1来确保数据同步。</div> <span class="time">2018-12-04</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/e5/e8/033bdbf5.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">王灯武</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">两阶段提交那个地方用了反证法，个人认为并不一定用了两阶段提交就一定可靠，写入redolog--&gt;写binlog--&gt;提交事务处于commit状态，这个是3步，可能在写完binlog后直接服务器断电，碰到过从库的binlog比主库还超前的状况（可能是binlog已通过网络传给从库，但是主库断电数据没落盘），大神可以解释下这种场景，谢谢！</div> <span class="time">2018-12-04</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">这就是为什么MySQL 在崩溃恢复的时候，会在主库提交这个事务</p> <p class="reply-time">2018-12-04</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/cb/50/66d0bd7f.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">杰之7</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">通过本节的学习熟悉了更新语句除了有查询语句的执行流程，还增加了两个日志，redolog和binlog。老师，我有一点疑问，文章写到redolog是物理日志，记录在某个数据页做了什么修改，binlog是逻辑日志，是原始逻辑。我是否可以这样理解，redolog是增加新的内容，binlog是对表中已有数据做改动。回到老师的问题，一天一备份与一周一在什么指标上更有优势，我的理解是在优化指标上更有优势，备份时间越长，之后查询建立索引上就需要花更多的时间，所以对优化指标有影响，请老师回复我的问题疑问，感谢与老师一同进步。</div> <span class="time">2018-12-04</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">Redolog和binlog都是记录数据的改动，前者是针对数据页，后者是记录修改逻辑（这一行要怎么改）</p> <p class="reply-time">2018-12-04</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJAibnPX9jW8kqLcIfibjic8GbkQkEUYyFKJkc39hZhibVlNrqwTjdLozkqibI2IwACd5YzofYickNxFnZg/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Sinyo</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，您有提到以下两点，不知道是不是有点矛盾呢？第一点提到redolog能持久化到磁盘，第二点提到不能持久保存。<br><br>1. redo log 用于保证 crash-safe 能力。innodb_flush_log_at_trx_commit这个参数设置成 1 的时候，表示每次事务的 redo log 都直接持久化到磁盘。这个参数我建议你设置成 1，这样可以保证MySQL 异常重启之后数据不丢失；<br>2. binlog还不能去掉。<br>一个原因是，redolog只有InnoDB有，别的引擎没有。<br>另一个原因是，redolog是循环写的，不持久保存，binlog的“归档”这个功能，redolog是不具备的。</div> <span class="time">2018-12-04</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">不能持久保存，是因为redolog是循环写的，这样没矛盾呀</p> <p class="reply-time">2018-12-04</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/e8/c7/aba1275d.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">……</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，有一点我有点想不通。两阶段提交的第一阶段，将变更的记录写入redo日志，这个阶段是写到了log buffer还是 log file？binlog也是一样。<br>在第二阶段提交，binlog和redo是这个时候进行刷盘，还是目前已经完成刷盘，二阶段提交确保两者已经刷盘的情况下才会真正意义上完成commit,否则进行rollback。</div> <span class="time">2018-12-04</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">1. 到了提交阶段，就是把logbuffer写入redolog duke<br><br>2. 第二阶段，其实就是binlog和redolog最终提交的阶段</p> <p class="reply-time">2018-12-04</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/dc/fa/3975f8da.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">王先统</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">看了下留言，大家普遍对两阶段提交中的三个步骤再打散怎么保持一致有疑问，请老师再补充一下呢</div> <span class="time">2018-12-04</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">“再打散”是啥意思</p> <p class="reply-time">2018-12-04</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/dc/fa/3975f8da.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">王先统</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">问一个两阶段提交的问题: 如果最后写完binlog，但是没有commit redolog，这个时候redolog处于prepare的状态，岂不是也不一致了？或者说，我只prepare了redolog系统就挂了， binlog都没写呢，又怎样呢？</div> <span class="time">2018-12-04</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">1. 系统重启后会提交这个事务<br><br>2. 系统重启后会回滚这个事务</p> <p class="reply-time">2018-12-04</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="" class="avatar">
<div class="info">
	<div class="hd"><span class="username">疾风狂草</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">是否可以理解为：write pos是redolog记录的位置，而check point就是purge了的位置。如果是的话，redolog的末尾就是write pos，而check point 需要真实记录，并且落盘，才可以保证crash safe，那么他的机制是怎样的呢？</div> <span class="time">2018-12-03</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">前面对的，“Checkpoint需要真实记录”开始没看懂你的意思</p> <p class="reply-time">2018-12-04</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/c7/a1/6e500f6b.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">可凡不凡</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">Redo log不是记录数据页“更新之后的状态”，而是记录这个页 “做了什么改动”。 <br>redo log 不是记录的更新后的状态吗</div> <span class="time">2018-12-03</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/c7/a1/6e500f6b.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">可凡不凡</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">感觉老是应该把redo log 和 undo log 放一起说说 有点迷糊了</div> <span class="time">2018-12-03</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">看08篇哈，那里有</p> <p class="reply-time">2018-12-03</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/da/bb/a20f37b2.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">湘江鸿</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">请教下，如果是redo log处于prepare状态，执行器写完了binlog，然后在提交事务给存储引擎的时候，存储引擎这边操作成功了，但是返回给执行器的时候宕机了，这样两边状态就不一致了吧？</div> <span class="time">2018-12-03</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">这样不算，这样得应用程序自己check</p> <p class="reply-time">2018-12-03</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELtOO0HKrj5SI5JSlmwiaCvaF6GLiaTmf5NX88OZaO3HymTAGTeIoicBUjqzmMF6sF5raPFjuqLFibrrw/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">gesanri</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">看完文章我觉得可以只用binlog，不用redo log，没明白为什么binlog没有crash safe的能力?它不也是存文件吗？异常重启也可以通过它恢复啊，仅仅是因为binlog可以被关闭?那我不关它是不是就可以不用redo log了</div> <span class="time">2018-12-02</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">不只的，这个问题很多同学问，答疑文章来说哈</p> <p class="reply-time">2018-12-03</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1V6BNbTzjPMFPXQLia7jGpKiczxASA2ooAy1tcTkVzbF4upxMZLTxj6GoIlJibudSrJUBCgB0pj9bA/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">飞飞走走</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，我想问下，装库的时候，redo 应该设置成几个文件，以及每个文件的大小怎么设置的，应该从哪些方面去考虑呢</div> <span class="time">2018-12-02</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">主要看你预设多大的TPS，现在SSD机器+32G 以上内存，建议设置4个1G</p> <p class="reply-time">2018-12-03</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/ce/c6/664ddb78.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">sugar</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师您好，看到prepare-commit两阶段提交这里，想请问一下：如果系统运行到prepare阶段时断电，于是 这一次修改还未commit，那么下一次系统重启后会将此次中间态的redolog继续落到binlog中，还是将此条redolog回滚掉呢？重启后 Innodb是否会检查redolog与当前磁盘上物理存储的数据做diff呢？</div> <span class="time">2018-12-02</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/bd/ed/95e8a314.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">过去、今日</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">两阶段提交<br>1、prepare 2、写入binlog 3、commit<br>如果到2后，系统奔溃，binlog没写入，事务回滚<br>如果到3后，系统奔溃，binlog写入，事务自动提交<br>那有个疑问在这过程中，事务回滚和提交mysql是怎么判断的？</div> <span class="time">2018-12-02</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">只好靠恢复后，应用程序自己来查数据验证</p> <p class="reply-time">2018-12-03</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/6f/63/8808cc00.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">扬～</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">只设计使用binlog不行吗，对于里面的操作也分2阶段，这样崩溃时，也能根据记录最近的状态来判断是否回滚提交</div> <span class="time">2018-12-02</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/14/02/84/add96944.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">顺流逆流</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">我感觉binlog也可以保证crash-safe能力吧？因为如果binlog记录数据库所有执行更新语句，那么可以通过更新语句恢复数据库的状态吧？还有如果我只有binlog感觉就很安全了，为什么还需要redo log？我一直不太理解</div> <span class="time">2018-12-01</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/33/af/dda311cf.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">TiTi</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">对于&quot;redo log 用于保证 crash-safe 能力&quot;这个描述，如果在写redo log的时候发生异常(比如断电)，那重启后该条更新是不是失败了？但是在这种情况下redo log、binlog和磁盘上的数据文件里都没有该条更新的记录，从数据一致性角度来看，整个MySQL系统是“安全”的。更新失败的事务可以通知客户端重新提交。不知道我这样理解对不对？</div> <span class="time">2018-12-01</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">这时候崩溃恢复肯定是要回滚了<br><br>但是确没办法再“通知客户端”了，因为之前连接就已经断开了。<br><br>只能靠客户端发起新连接去查数据确认</p> <p class="reply-time">2018-12-01</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/13/7d/1454db9c.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">还来得及</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">把评论看完才能理解的很透彻，嗯～～～</div> <span class="time">2018-11-30</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">评论区是个好地方， 不怕无限展开，越用心看的人奖励越多😄</p> <p class="reply-time">2018-12-01</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="" class="avatar">
<div class="info">
	<div class="hd"><span class="username">leon</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，有个问题一直很困惑<br><br>两阶段提交为了保证binlog和redolog的一致性，<br>1 prepare阶段  2 写binlog  3 commit阶段<br>假如在3之前崩溃，恢复时，虽没有commit，但prepare和binlog完整，所以重启后会自动commit，以此来保证有binlog一致性。<br><br>既然能这样做，那为什么不把commit阶段去掉，恢复时，只要redolog和binlog完整就认为redolog有效，否则回滚呢？ 是因为效率还是其他的原因？</div> <span class="time">2018-11-30</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">如果redolog是完整的，（包括了prepare和commit），就直接认为成功，不去判断binlog </p> <p class="reply-time">2018-12-01</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/0e/3b/66ec78f8.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">彭莉</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">只有redo-log，没有undo-log，innodb应该没有办法做到crash safe，楼主可不可以把这块也稍微讲一下呢？目前有点一知半解。</div> <span class="time">2018-11-30</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">Undo log跟数据一样，也是WAL机制写入，需要依赖redolog 恢复出来<br><br></p> <p class="reply-time">2018-12-01</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/72/89/1a83120a.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">yihang</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">有一点没有看懂为什么binlog没有crash-safe的能力？而redolog有？</div> <span class="time">2018-11-29</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">已加入答疑文章topic</p> <p class="reply-time">2018-11-29</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/07/8f/3ef096f3.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">yu🐟</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师您好，如果update写入日志，还没写进磁盘，此时执行查询，如何保证不会产生数据脏读的？</div> <span class="time">2018-11-29</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">内存里数据是对的<br></p> <p class="reply-time">2018-11-30</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epLLXBLBLgticobxvBYRezd304Y66Q8ibYCl7mG9dvTHGrx9obRcn7ZmJBcib3ibsQPIX3xIbNYiaAUrOA/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Geek_c991e0</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师好，问个问题，如果两种log都写完成了，但是redolog没有写磁盘，物理机挂了，redolog在内存中就丢失了吧，再启动跟磁盘中的binlog就不一致，后期恢复数据的时候会有问题吧</div> <span class="time">2018-11-29</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">是的，这就trx_commit没设置成1的后果…</p> <p class="reply-time">2018-12-01</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/14/1f/c3/1ef2bccf.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">包子木有馅</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师好，“同时，InnoDB 引擎会在适当的时候，将这个操作记录更新到磁盘”，想问一下这里“更新到磁盘”是指将日志写入磁盘呢还是说通过redolog更新磁盘里的数据页，如果是后一种的话，那和insert buffer不是一样了吗？</div> <span class="time">2018-11-29</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">“更新到磁盘” 就是后者，<br><br>Insert buffer本身是数据的一种， 只是说insert buffer也可以把随机读写变成顺序写。<br>这个我们后面讲唯一索引的时候会提到哈</p> <p class="reply-time">2018-11-29</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/GrQsm2lOxnBhFuegVwNxrA2dd9qQLwLOlV3xUB615eqKia5vQPdRcnz1T6sxLcmiaSnibTEIVia9ebThaVWxF2TMnw/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">zxx</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">如果commit写入失败怎么办呢？</div> <span class="time">2018-11-29</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/e0/cc/011b163c.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">scream</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">上面id为某·人的关于二阶段提交，也就是14&#47;15描述貌似有点问题，preper阶段是刷redo到磁盘，commit阶段才刷binlog到磁盘，根据淘宝同学提的建议，5.7.之后某一个版本后改到了只需要确保刷binlog之前刷redo(根据lsn判断)，不知道我描述的对不对，请老师确认下！</div> <span class="time">2018-11-29</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">是的，但是两阶段的逻辑没变😄</p> <p class="reply-time">2018-11-29</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/14/44/2f/42a8d353.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">王宝龙</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">1. 在没有 InnoDB 的 redo log 之前，MyISAM 引擎就已经在做 “粉板” 功能了？只是没有写入日志而已，仅保留在内存中而已。如果是这样的话，那么就会产生 crash 后数据差异的状况。<br>2. 在更新操作时，作者举的例子，是“写入新行”之后再写入 redo log 和 binlog 的，但是按作者的话是，应该是“Write-Ahead Logging”先写日志，等不忙时在写磁盘。也就是说，在文中的第三张图中，作者是按 MySQL 不忙为前提，假如以 MySQL 繁忙为前提，那么 redo log 是不是应该在“写入新行”之前，然后 MySQL 等空闲时，再根据 redo log 写入。</div> <span class="time">2018-11-28</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/f9/aa/4437fe1a.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">龙猫9527</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">mysql的插入操作是否也有两个日志呢，对于批量性的insert在values后面跟多少条值是上线？我看有人说2w多条。</div> <span class="time">2018-11-28</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/31/e8/3e61e916.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">天马行空</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">两个日志的记录是如何建立对应关系的？</div> <span class="time">2018-11-28</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="" class="avatar">
<div class="info">
	<div class="hd"><span class="username">流血的手指</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">redolog binlog是直接写到硬盘吗？还是内存里</div> <span class="time">2018-11-28</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/6a/2d/ec4ed8ce.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">shawn</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，对于wal我还有一些疑问：<br>1. 当你写入 插入一条记录c的时候，要先把c写入到WAL文件。commit 后做了两个动作，先把WAL文件持久化要磁盘，然后更新数据库（磁盘记录）。 我想问，是否要吧WAL文件持久化到磁盘，才更新数据库表和索引的记录到磁盘。<br>2.为什么WAL可用，是不是因为WAL是顺序性的文件，读写起来比较快？<br></div> <span class="time">2018-11-27</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">1. 是，而且更新的数据写到磁盘是后台操作<br><br>2. 是的，就是转成了顺序写</p> <p class="reply-time">2018-11-27</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/52/63/a58ae0ab.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Kongk0ng</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">请问如果写完binlog后crash，redolog还没commit，这时候会发生什么？</div> <span class="time">2018-11-27</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">重启后崩溃恢复时提交事务</p> <p class="reply-time">2018-11-27</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/f7/7a/5a4843ed.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">剃刀吗啡</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">如果是redo log是直接写磁盘，为什么不把更新的数据直接写磁盘？是因为慢太多？</div> <span class="time">2018-11-27</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">是的，顺序写比随机写快</p> <p class="reply-time">2018-11-28</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/e1/bf/7b22efac.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">seafooler</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，我有个问题。如果将innodb_flush_log_at_trx_commit参数设置为1，那么每次redo log都要被刷新到磁盘，这样效率也会比较低吧。感觉就不太符合您讲的“掌柜写粉板提高效率”例子了。谢谢老师的解答</div> <span class="time">2018-11-27</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">日志顺序写盘，比直接写数据（随机写盘）还是快的</p> <p class="reply-time">2018-11-27</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/21/5b/09940ac6.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">动与静</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，什么叫数据页？</div> <span class="time">2018-11-27</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/e1/bf/7b22efac.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">seafooler</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，您这个逻辑架构图是用什么工具画的啊？</div> <span class="time">2018-11-27</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/52/07/5d74b03f.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">静静的等</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">1. redo log做的事情和binlog的row格式有什么区别呢？都是记录了“做了什么改动”。<br><br>Redo log不是记录数据页“更新之后的状态”，而是记录这个页 “做了什么改动”。<br>Binlog有两种模式，statement 格式的话是记sql语句， row格式会记录行的内容，记两条，更新前和更新后都有。</div> <span class="time">2018-11-27</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/52/07/5d74b03f.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">静静的等</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">1. 写完binlog提交redo log之前，数据库crash了，这时候binlog和redo log的状态是怎样的？binlog 和redo log会回滚吗？<br>2. binlog为什么不能保证crash-safe?</div> <span class="time">2018-11-27</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJoyqXrhQS7Chvj4yNxUlZ1Ltribiat2uQMiabQURjwA9KQojKicjjQOdJDZ85VwaI5t4LrOHOHjOLRgw/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">zhxleon</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">innodb肯定是MySQL用的最多的存储引擎，redo为什么不能像oracle一样直接生成一份归档日志，这样MySQL也可以和oracle一样做物理复制了，只需要把redo产生吨位归档传输到从库应用即可，同时也能保证数据完全一致，而且从库应用日志速度也会比现在快的多</div> <span class="time">2018-11-27</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">官方的动作有这个趋势</p> <p class="reply-time">2018-11-27</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/14/02/fc/f18b97c3.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">王大英</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，我这个小白不懂，字段由0变1时，在“先写redo后写bin”下，写完redo就crush，您说用binlog恢复会导致结果是0和原库不一致。但那也还没commit啊，原库不还是0，用binlog恢复出来数据库也还是0，那不是反而保证了和原库一致吗？</div> <span class="time">2018-11-27</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">Innodb里面，redolog写完就算成功了，崩溃恢复以后这个行是1</p> <p class="reply-time">2018-11-27</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="" class="avatar">
<div class="info">
	<div class="hd"><span class="username">大卫</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，有一点我一直不太理解，比如执行器查询一条记录的时候，引擎是从磁盘取数据放到内存在从内存中取数据返回的。更新的时候重做日志没有commit之前就更新内存了，这个时候其他的查询是不是就可以查到未提交的数据？如果加锁那么是对这块内存加锁吗？</div> <span class="time">2018-11-27</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">你先看一下第三讲哈</p> <p class="reply-time">2018-11-27</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/70/70/e8f4bbeb.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">臧忠超</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">使用redo log，有热点表的时候，对热点表的查询效率会较差—需要查询磁盘上的原始数据再查redo log，效率如何保证？</div> <span class="time">2018-11-27</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">不用，查内存就行</p> <p class="reply-time">2018-11-27</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/27/c4/eb7c7b29.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">仰泳的双鱼</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">如果先写binlog  再写redolog ，出现crash时我以之前全备份加binlog进行恢复，不需要redolog了,出现不一致也没有问题啊？</div> <span class="time">2018-11-27</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">嗯，你这么做是可以的，但是正常重启innodb 要做崩溃恢复的，它一看，没redolog, 这个事务是没有的。但是binlog里面已经有了，用你的方法事务就存在。<br><br>设计上要避免使用方式的问题出现不一致的结果</p> <p class="reply-time">2018-11-27</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/f5/68/686d1a0b.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">wq</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">Redolog是在系统闲时将更新到数据库，那在未更新到数据库之前，读取这条数据流程是什么样的</div> <span class="time">2018-11-26</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/ec/cb/27033e11.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">王木鱼</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师好。请问可不可以这样总结归纳：<br>事务的两阶段提交：<br>t-3 时刻：事务开始前，数据库一致<br>t-2 时刻：写入 redo log。redo log 中 本次事务为 prepare 状态<br>t-1 时刻：写入 bin log<br>t 时刻：提交事务，redo log 中 本次事务为 commit 状态<br>两阶段提交的好处是能恢复到 t时刻。<br><br>另有疑问：<br>1. 假设 bin log 可以在事务提交后 append 一个数据一致的标识，那是不是可以仅使用 binlog 就能恢复到 t-3 时刻？<br>2. redo log 是 InnoDB 特有的日志。那么从软件设计的角度来说，是不是由 MySQL 实现一个通用的 redo log(具体实现或接口定义) 会更好？这样以后还可以由开源社区提供其他更好的引擎，并且具有完整的 crash-free 能力</div> <span class="time">2018-11-26</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/b8/36/542c96bf.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Mr.Strive.Z.H.L</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，第一次课的答案第二次课好像没提到答案呢？？还有就是二阶段提交：redo log一阶段perpare后，bin log记录时crash。这个时候没有commit，那redo log 如何处理？</div> <span class="time">2018-11-26</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">在第一次课的置顶评论里面。<br><br>如果binlog没写完，这个事务在崩溃恢复过程中会回滚</p> <p class="reply-time">2018-11-26</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/49/08/9da90ad5.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">亚伯拉罕·林</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">我采用mysqxtrabackup来全量和增量备份数据库,没有备份binlog，这样可以的吧</div> <span class="time">2018-11-26</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">看你的系统可靠性要求哈。两次增量备份之间如果机器挂了怎么解决的，要有个预案</p> <p class="reply-time">2018-11-26</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/c7/d7/b9f93eec.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">特斯拉</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">一天备份一次在经常需要扩容的的场景下可以提高系统的读能力。<br><br>有个小问题，为什么增加备份能提高读能力?</div> <span class="time">2018-11-26</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="" class="avatar">
<div class="info">
	<div class="hd"><span class="username">加班工程师</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">如果是在 新行更新到内存 到 写入redo-log 这两个阶段中间崩了(内存更新了但还没写入redo-log)会有什么措施吗</div> <span class="time">2018-11-26</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/78/31/c7f8d1db.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Laputa</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">文章和就留言中提到了数据页的概念，老师能否简单解释下什么是数据页</div> <span class="time">2018-11-25</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="" class="avatar">
<div class="info">
	<div class="hd"><span class="username">大大大dvavid</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">请问数据库备份是怎么做？可以通过主从数据库，将从库的复制时间设置为1天后复制的方法实现备份么？</div> <span class="time">2018-11-25</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">这个叫延迟从库，你可以在这个库上备份。不过一般建议在一个普通从库上备份</p> <p class="reply-time">2018-11-25</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="" class="avatar">
<div class="info">
	<div class="hd"><span class="username">大大大dvavid</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">想问下老师，在没有数据库备份的情况下，仅仅通过binlog文件是否可以回复一次误删除的表数据？</div> <span class="time">2018-11-25</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">《误删数据后除了跑路还能做啥》这篇会提到</p> <p class="reply-time">2018-11-25</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Geek_9ca34e</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师你好，关于redo log和binlog大概思路我已明白，但是两阶段提交部分我还是有一点纠结，redo先写日志但是状态标记为prepare，再写binlog日志，整个事物提交时再把redo的状态改为commit，问题如下：1、redo 修改状态为commit的时候突然断电，服务器恢复后redo log和binlog是否就不一致了？2、redo 修改状态为commit的时候失败，整个事物回滚但是突然断电是否也会导致redo log和binlog不一致？3、如果通过binlog实现主从复制，那么是事物提交成功才复制到slave节点，还是只有写了binlog就复制到slave节点？4、不管是redo log还是binlog写了日志就理解刷到磁盘，还是写入磁盘缓冲器，实际的刷盘动作有磁盘来保证，不管是否断电重启都不影响实际耍盘和数据丢失？</div> <span class="time">2018-11-25</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/e9/0b/53bf91d3.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">WL</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">一天一备份, 每份bin log都比较小, 数据恢复比较快, 但是每天数据库备份占用的硬盘空间会比较大, 相比每周备份几乎多了一个数量级. </div> <span class="time">2018-11-24</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">对的，存储成本和RTO的权衡</p> <p class="reply-time">2018-11-24</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJZBOcesNKYJRJKR6noK2VClOS8iaeEsibpXSLlFT87mARozsicHSAo8VibSEOZSRVw2XWK4UyqjQDYJQ/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">蓝色十三月</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">哥，想了解下如果写binlog成功了，然后通知redolog commit失败了会怎么样？</div> <span class="time">2018-11-24</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="" class="avatar">
<div class="info">
	<div class="hd"><span class="username">coolep</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">文中有两处内容让我迷惑，感觉描述不一致，如下：<br>“具体来说，当有一条记录需要更新的时候，InnoDB 引擎就会先把记录写到 redo log（粉板）里面，并更新内存”<br>“3.引擎将这行新数据更新到内存中，同时将这个更新操作记录到 redo log 里面”<br><br>该过程是先把新数据更新到内存中再写到redo log里吗？望老师给小白指导一下</div> <span class="time">2018-11-24</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">如果是MySQL 代码里的精确顺序，是先更新内存的。这里主要是要说明WAL机制，这两个的顺序你可以认为“同时”，会更方便理解</p> <p class="reply-time">2018-11-24</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/71/97/09bc55dc.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">张永志</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">一天一备在恢复时应用binlog会更少，恢复起开更快，影响恢复所需时间。<br>如果只有最新一天的全备，恢复是快了，但是可恢复到的时间点就太有限了。<br>如果支持恢复到最近7天任意时点，在库不大且备份空间足够的情况下，可一个全备+隔天一个增量来做，但保留最近7天的binlog。</div> <span class="time">2018-11-24</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">正确😄</p> <p class="reply-time">2018-11-24</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/14/31/a0/96698bbc.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">三七</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">非常感谢老师，但是心中有个小疑问，望老师解答，innodb引入redo log是为了提高效率，并且有了它，InnoDB 就可以保证即使数据库发生异常重启，之前提交的记录都不会丢失，那没有redo log的myisam，数据库发生异常重启会丢失数据吗？如果不会丢失数据，那么myisam是否也算是crash-safe</div> <span class="time">2018-11-24</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">Myisam就是会丢…</p> <p class="reply-time">2018-11-24</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/10/7b/eed9d6d6.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">小笨蛋</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">方便问一句吗？像你说的WAL这种关键技术等东西是在什么官方渠道看到的。</div> <span class="time">2018-11-24</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">https:&#47;&#47;en.wikipedia.org&#47;wiki&#47;Write-ahead_logging WAL是数据库通用技术哈</p> <p class="reply-time">2018-11-24</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/e8/30/0a4eca46.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">小怪</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">厉害，需要看多遍</div> <span class="time">2018-11-23</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ1DjK3gmzm8zABTS9VOfX0sIrNtcrKHMpuw61xORGicUtu3BbDlEBsbDRc736EnicY132biaNQctianQ/0" class="avatar">
<div class="info">
	<div class="hd"><span class="username">乔俊杰</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">留言板里的内容比文章更精彩</div> <span class="time">2018-11-23</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">这确实是意外之喜</p> <p class="reply-time">2018-11-24</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/ff/c3/b90b862c.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">zyy</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">反复看了几遍，根据正文和文末留言大致了解了这些概念。<br>有一个疑问 redo log记录 在某个数据页做了什么修改，这里数据页要怎么理解，数据查询的结果数据？</div> <span class="time">2018-11-23</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">不是，存放数据的地方，你可以理解为按块儿存，一块儿16K</p> <p class="reply-time">2018-11-23</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/42/d3/5cb266ea.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">静处常思己过</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">在两阶段提交那段绕了半天。想了想：<br>1.redo log记录的数据状态，就是用户视角数据库中应该保存的状态。但是实际却可能还在内存中，没有写入磁盘。<br>2.异常重启：当MySQL异常重启后，会读取redo log，将没有写入磁盘的数据写进去。用户视角中的数据完整的保存了下来。并不会因为之前保存在内存中而丢失。此时redo log中没有commit状态的，就会回滚（如果redo log prepare + binlog = redo log commit）。<br>3.备份&#47;复制：当需要恢复数据到某一节点的时候，会用备份+重放binlog的方式。<br>4.如果没有两阶段提交存在。修改status 0 →1，写入redo log成功，写入binlog失败，那么MySQL异常重启后，根据redo log，数据库中的status已经是1 。但是如果我用binlog去恢复另外一个库，因为没有这个事务记录，所以status = 0。两个库对比，会出现一个stauts是0，另外一个是1的情况。反之同理。<br>5.上面是思考的过程，最后感觉可能也有同学跟我一样懵逼。我觉得要点是：redo log是MySQL用来保存类似工作现场快照的东西，MySQL崩溃后自己修复自己的时候用。手动备份或者恢复数据库的时候并不是依据它来做。binlog是给用户恢复到数据库某一节点用的。不能混了，不然绕不出来。<br>6.不知道上面的理解是不是都对。。。。</div> <span class="time">2018-11-23</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/2f/fd/dead7549.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">AJIE</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，还是不太理解binlog为什么不具有crash safe的能力</div> <span class="time">2018-11-23</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/2f/fd/dead7549.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">AJIE</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">既然恢复数据是基于binlog，那在恢复是基本上没redo log什么事，难道用来校验？</div> <span class="time">2018-11-23</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqOpANMwDibLmj5IGJh6dTw300sZ1BHM5sG3sZv1A1rvCHOiblPD3jgFOiaMVVujtctWnQbVFoNPpRgw/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">alioo</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">关于“一天一备会比一周一备更有优势”我谈谈的我观点：<br>binlog一般情况下是崩溃时用来恢复的，恢复时间越短，对业务的影响越小，一天一备的话只需要利用昨天的备份+今天截止到目前的增量binlog，增量数据相对小一些，恢复的时间自然要高效一些。<br>反过来说如果一周一备的话，首先binlog需要存储的至少是一周的数据（binlog如果小于一周的话否则故障发生时就无法恢复了）。所以我认为影响到的指标是expire_logs_days（可以通过 show variables like &#39;%expire_logs_days%&#39;来进行查看）</div> <span class="time">2018-11-23</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/0f/44/396d2d8e.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">zj-de</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">先写redo log。再写bin log。如果在系统崩溃时。没有写redo log，那么这次修改就是真的丢了，找不回来，如果redo log写了。bin log 没写，那么需要依靠bin log + redo log来恢复。如果 bin log也写了，光靠bin log 就能恢复，是这样理解吗？</div> <span class="time">2018-11-23</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/df/6d/44cf0de4.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Ivan</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，您好。mysql5.6以后的crash后的恢复，是不是只是用redo，而不会去查询binlog？</div> <span class="time">2018-11-23</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/7c/d5/7ae845fa.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">hb</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">能大概说下原理嘛 怎么个确认法</div> <span class="time">2018-11-23</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">啥？</p> <p class="reply-time">2018-11-23</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/54/41/3d352f74.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">小金库so</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">有个问题请教老师，既然write pos和checkout都是往后推移并循环的，而且当write pos赶上checkout的时候要停下来，将checkout往后推进，是不是意味着，后续的更新请求都会等待，等checkout往后推到一定空间后，再继续执行。如果上述成立的话，在大量的更新或插入操作的时候，write pos可能会很快的追上checkout，从而再次产生等待的过程，这个是不是一个在性能上产生瓶颈。</div> <span class="time">2018-11-23</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">是的，所以1. 要设置大一点的innodb redolog的大小 2. 用好点的磁盘😄</p> <p class="reply-time">2018-11-23</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/7c/d5/7ae845fa.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">hb</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">关于崩溃恢复 数据库目标既然是保持数据一致可能还原也可能执行 对于数据库的客户端这时候是什么状态呢 对于这些没有收到成功答复的更新操作 客户端需要一直重试吗</div> <span class="time">2018-11-23</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">代码里面要有确认的逻辑</p> <p class="reply-time">2018-11-23</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/ab/10/b812ff3e.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Hesher</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">看来恢复的过程是存储引擎来做的，server层肯定不会去动redo log。其他引擎，没有redo log，只靠bin log也能做备份恢复吧？跟InnoDB比优缺点在哪？看到其他同学的评论，恢复分为重启恢复和备份恢复，redo log的crash safe是为了做重启恢复吗？直接用binlog恢复不行吗，前提是bin log开启的情况下。</div> <span class="time">2018-11-23</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">1. 是的<br>2. Innodb没有binlog<br>3.这个问题问的同学有好几个，我加到答疑篇🤝</p> <p class="reply-time">2018-11-23</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/44/cc/3e62d111.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">justd</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">两种方式确定记录完整：    <br>1. redo log状态为 commit<br>2. redo log状态为prepare并且bin log记录完整 （提交commit之前）</div> <span class="time">2018-11-23</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/de/d4/b83c4185.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">David.cui</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">我没有听明白孔乙己掌柜的粉板和账本怎么和redo log,binlog,磁盘数据对应起来。另外mysql的redolog和oracle 的redolg是名称一样但是用途不一样？</div> <span class="time">2018-11-23</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/14/28/8e/4c6c0ba2.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">TIMKeeper-sxs</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，我受益非浅。</div> <span class="time">2018-11-22</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/d6/d4/0fa9ca6a.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">grace_233</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，我有一个大大的问题想问。 上面的文章中有张 &quot;update 语句执行流程&quot; 的图我看懂了。但是我有一个疑惑。比如我在执行事务的时候，其实有两条sql语句：<br>1. update T set c=c+1 where ID=2;<br>2. commit;<br><br>我特别特别想知道，上面的 &quot;update 语句执行流程&quot; 图，哪些操作是在update T set c=c+1 where ID=2 语句发出后执行的，哪些操作是在commit语句发出之后执行的？<br><br>谢谢老师了~~~~~~~~~~</div> <span class="time">2018-11-22</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/de/1c/60ff644d.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Fatal Error</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">write pos 是当前记录的位置<br>checkpoint 是当前要擦除的位置<br>请问老师，这个checkpoint 是不是就像图片一样，当写到3的时候，0已经被擦除了，并且checkpoint已经在1上面了。就是，checkpoint 是预先擦除一个文件的位置留给 write pos 写？<br></div> <span class="time">2018-11-22</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">对，但是并不保证能够多出一个文件，也有可能write pos追上来就接近chenckpoint,这两位置在同一个文件</p> <p class="reply-time">2018-11-22</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/a6/e2/01dadfb4.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">湖</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">若更新操作记录到redo log中，此时处于prepare状态， binlog也写入成功，但是在最后提交事务是失败会出现什么样的情况？事务会回滚？会做些什么事情呢？</div> <span class="time">2018-11-22</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/cb/53/262a8ce2.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">是我</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">因为redo log不是每个引擎都具备的，所以就需要binlog来进行辅助，不知道可以不可以这样理解？</div> <span class="time">2018-11-22</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">但是算先来后到的话，先有的binlog...</p> <p class="reply-time">2018-11-22</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/fa/8b/d7dd7cae.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">代小亮</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，两阶段提交过程中，如果是在redo log prepare状态，binlog已经写到磁盘上之后，数据库crash了，重启之后，binlog和redo log 不是也不一样吗？</div> <span class="time">2018-11-22</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKq0aBhhSXg7qiaWQH81zmjAYPXwoiaJEoMOxwXZF7d2iazMyQCeYpT7DJmxy2Iny7qq3RRr0UjOnO5A/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">xiaoma2008</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">请问一下，怎么根据id查询到page的？也就是说buffer pool中存的的page，怎么根据记录的id找到对应的page的呢？</div> <span class="time">2018-11-22</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/8c/38/f1f2227a.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">伪装成学霸的学渣</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">想请教一下 table 和  column的命名规则，怎样使比较推荐的方式。我看到作者是table 和 ID 是 大写， 其他的column是小写？ </div> <span class="time">2018-11-22</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">建议全部小写，作者给了错误示范，以后改正😄</p> <p class="reply-time">2018-11-22</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/14/03/c7/563345e1.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">wjz1991</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，问一个问题，客户端发起commit的时候，收到commit成功是在把事务写到innodb_log_buffer_size就返回成功，还是要刷到binlog后才返回成功啊</div> <span class="time">2018-11-22</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">都要。而且不止写到log_buffer,还要写到redolog文件</p> <p class="reply-time">2018-11-22</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/14/16/93/c5be3aee.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Sea - fishing salt</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">我的理解：<br>redoLog就是记录将要做什么，相当于缓存的作用，实在暂时保留未来要写盘的意图，等到空闲时写盘。redolog记录了当前阶段（可以理解为只要没有成功commit，redoLog都有记录。在回滚或提交后再清除这条记录）<br>binLog归档主要用来恢复数据，第一保证事务正常，RedoLog有记录binLog没有日志，事务回滚；当redoLog有binLog也有时就继续提交。第二 数据恢复的时候使用binLog<br>大神，指教一下理解的对不对<br>还有个问题，更新没有及时写盘，还处在与prepare阶段时。查询数据select * from xx limit 10时执行器检索磁盘查的的不包含刚刚更新的那条？会发生数据不同步？</div> <span class="time">2018-11-22</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJJeibN69icI9iapx9h2MtUX3zb2iaggw32w4GAmbUDibPp3ia5MPSznxGZeiadXibBbx6Y13iacDbTDBwKyibA/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">悟空</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，有没有什么直观的方法监控当前buffer pool淘汰了多少页、从磁盘读了多少页呢？谢谢</div> <span class="time">2018-11-22</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/83/4b/0e96fcae.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">sky</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师好！<br>“与此类似，InnoDB 的 redo log 是固定大小的，比如可以配置为一组 4 个文件，每个文件的大小是 1GB，那么这块“粉板”总共就可以记录 4GB 的操作。”<br><br>这里无论配置多少组多少文件，它的总大小都不能超过4G吗 还是这个4G是可以配置的  还有关于这块的配置变量都有哪些呀 谢谢</div> <span class="time">2018-11-22</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/45/c9/a4f7054f.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">佳</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">那个redo log的日志说是物理的，并且是循环写，那一写满以后，原来的就要被擦除掉了，那万一日志发生崩溃，想要恢复到原来被擦除的日志信息的那部分还能恢复吗？那个时候的恢复是只能依靠binlog日志恢复吗？redo log日志在写满后擦除前会持久化原来的信息吗？redo log是怎么实现崩溃恢复的？是边写边做了持久化吗？然后一启动，自动加载崩溃前的保存到磁盘的状态来进行恢复的吗？</div> <span class="time">2018-11-21</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/j0n4JAfhd9wUicVeibMYcWQ3O4Y4dakC161f9rWM7cSicC7UMSSUsJ5hqibFjGmSB0dQDjfkjiavbBmUFroqHYquJRA/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">蒋日健</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">反反复复看了好多遍，最后的疑问是，redo log可以不要，因为别的引擎也没有这个日志，这时候，先写bin log，然后提交，之后返回，但是假如提交之前就异常退出了怎么办？有什么用来记录写入的bin log没生效么？这样重启后才知道应该删除这条bin log或者再执行一次提交。求老师解惑</div> <span class="time">2018-11-21</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="" class="avatar">
<div class="info">
	<div class="hd"><span class="username">hellobfy</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">一。 同样都是调用引擎接口，  为什么写入新行操作算执行器的， 提交事务操作就算引擎的了？<br>具体描述如下：<br><br>update 语句时的内部流程时<br>2.执行器拿到引擎给的行数据，把这个值加上 1，比如原来是 <br>是 N，现在就是 N+1，得到新的一行数据，再调用引擎接口写入这行新数据。 <br><br>这里调用引擎接口时， 算执行器的操作<br><br>5.执行器调用引擎的提交事务接口，引擎把刚刚写入的 redo log 改成提交（commit）状态，更新完成。<br><br>这里调用引擎接口， 提交事务为什么就算引擎的操作了？ 跟上面是不是有冲突，还是因为什么原因呢？<br><br>二。 我对redolog的存在原因的理解： <br>redlog存在时为了数据库的内存操作的数据安全。 <br>虽然写日志有io成本， 但是比每条sql都直接操作硬盘的成本依然还是低， 。<br>所以综合来说，保证内存操作，然后日志硬盘io，最划算。<br><br>三。比较好奇redolog设计固定大小4g的历史原因。。<br><br><br> ps： 每次想您刚发出来时就好好读，有时候加班真的是不允许= =<br> 第一时间读了提出疑惑， 应该是回复最积极的时候啦 哈哈哈。。 <br><br>文中 checkpoint和write 中间部分 描述确实有歧义，需要多想一下。<br><br>另外希望大家写评论时候都注意格式，评论是对文章的补充，格式更好，大家读起来也更轻松和更快<br><br><br><br><br><br><br><br><br></div> <span class="time">2018-11-21</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">一、其实真正做数据更新和事务维护的都是引擎。但是引擎接口是执行器来调用的，调用关系。<br><br>这里只需要明确，“加1” 这个操作是在server层的执行器做的就行啦<br><br>在这个流程里，逻辑计算在server, 引擎层做读写<br><br>二、理解正确<br><br>三、不是固定为4G哦，可以配置的，只是在现在普遍的大内存场景下，要支持稳定的写入性能，可以设置4G</p> <p class="reply-time">2018-11-22</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="" class="avatar">
<div class="info">
	<div class="hd"><span class="username">MrGuo</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">“1. 执行器先找引擎取 ID=2 这一行。ID 是主键，引擎直接用树搜索找到这一行。如果 ID=2 这一行所在的数据页本来就在内存中，就直接返回给执行器”  大神，请问这个数据页本来就在内存中 是 server端的缓存 吗？</div> <span class="time">2018-11-21</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">Innodb 内存</p> <p class="reply-time">2018-11-21</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/14/17/d1/5626f60f.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">尼尼虾条</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">redo log记录的是数据页 做了什么改动，而binlog在statement模式下记录的是sql语句<br>这两者有什么不同呢？个人的理解是 改动不就是sql的语句的实现吗？？请老师答疑，谢谢</div> <span class="time">2018-11-21</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">我在答疑文章中说吧</p> <p class="reply-time">2018-11-21</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="" class="avatar">
<div class="info">
	<div class="hd"><span class="username">风雪</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，是不是可以了理解redolog是为了保证binlog的日志记录有效，那redelog的prepare有什么用当没有写入binlog的时候，可以恢复数据吗，还是说当MySQL中断会清空redolog，那这样的话如果热的redolog做持久化了那是不是跟binlog一样可以恢复数据了</div> <span class="time">2018-11-21</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/d2/7e/bd8c372a.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">你有资格吗？</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师我在这块有疑问：1.在redo log的时候您说的是写磁盘会比较耗费时间，先写redo log然后innodb会在合适的时候写入磁盘，那么这innodb写入之前这时候有线程来读这别数据，是不是不会读到新数据？<br>2.为什么bln log无法crash-safe,讲道理也可以读日志文件来看啊？<br>求大佬解惑！！！</div> <span class="time">2018-11-21</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ep9sZwlAz96kja8n3P0rTerYMLiaOtQEIxYYN1JKAffUMzXIRTHhvzSAqkeTpagnyxXtP3ppt74jxg/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">alvin li</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">对于写多的场景，或者业务本身对数据准确性比较敏感的场景，比如支付，应该备份频繁点比较好吧</div> <span class="time">2018-11-21</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/e8/90/d63f8347.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">yushing</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">binlog写入成功，但在事务提交时crash时，导致redo log和binlog不一致了，老师在问答区提到这种情况下“崩溃恢复时，事务会自动提交”，那么崩溃恢复时redo log是怎么判断事务是需要提交还是回滚的呢？(因为还存在另一种情况是redo log prepare了，但binlog还未写入时crash了，这时崩溃恢复时，事务是应该回滚吧)</div> <span class="time">2018-11-21</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="" class="avatar">
<div class="info">
	<div class="hd"><span class="username">有趣的灵魂</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">有一点没明白，redolog如果用完了，擦出的那一部分会保存到磁盘吗？如果redolog中的内容还没放到磁盘就被异常重启了，会不会丢失？</div> <span class="time">2018-11-21</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/e2/33/688f6c9c.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">kitty猫</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，我是数据库新手，有个问题请问怎么解决，如果一个系统比较重要，对恢复库的时间比较敏感，当然是一天一全备最好，可是现在这个库每天备份已经要20小时，而且此系统使用率很高，备份的时候又会加大影响库的性能，该如何是好？</div> <span class="time">2018-11-21</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/6f/46/b28d4c45.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">张圆要坚强啊</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，有个问题不太理解，redo  log是存在磁盘中的吗？还是存在内存中？如果是存在于磁盘中，日志满了会再写一次磁盘，会不会影响性能？如果是在内存中，像突然断电这种情况会不会丢失更新？</div> <span class="time">2018-11-20</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/48/9e/4f895bfb.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">LyricTian</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师好，我在文章中，看到说，如果redo log被写满了，需要停下来将数据写入磁盘。这个时候，整个数据库是处于阻塞状态吗？当有大量数据涌入的时候，会存在丢失数据的风险吗？</div> <span class="time">2018-11-20</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">更新都会被堵住，但是不算数据丢失，因为事务根本就提交不了。<br><br>事务&#47;数据丢失的定义应该是本应该存在的结果没了。但是这时候并没有告知客户端“成功”，也就不算“丢失”</p> <p class="reply-time">2018-11-20</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/f9/03/23706390.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">魔都浪子</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">innodb_flush_log_at_trx_commit为0，sync-binlog为1，刷盘后binlog已经传到了slave，commit后系统crashed，redo日志还没有来得及刷盘，这样会造成主从数据不一致吗？</div> <span class="time">2018-11-20</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/JKKWS6TzhncvAA0p0NDiaATPIvMicSM76vNAg9IG1ibibcJYPAiaicYjZfq4gAV8GRtcTpOibfRD8vzqHBtL0ibmhwQsbg/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">唐名之</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师我有疑问<br>1：当binlog写入成功后，系统发生carsh，undo 日志为prepare状态，那么binlog日志和undo日志逻辑不一致？系统重启该如何处理undo日志？</div> <span class="time">2018-11-20</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/14/01/1e/3aa8d7ec.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">柠檬</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">redo个人理解为直接写操作记录 <br>binlog 理解为更详细的操作记录，包括更新详细的操作过程。<br>o通过archive log进行恢复<br>mySQL通过binlog进行恢复。<br>不理解的是大的更新语句，如果中断，如何进行回滚</div> <span class="time">2018-11-20</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/3c/fa/e2990931.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">文敦复</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">看到老师评论中有：&quot;redolog是循环写的，不持久保存&quot;,redolog是在内存中的嘛，一直不持久化？</div> <span class="time">2018-11-20</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/88/26/b8c53cee.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">南辕北辙</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师您好，根据我的理解对于一个update 第一个阶段执行器调用引擎还是要去磁盘上找到ID=2这行数据（如果该数据页没有在内存中）。然后执行器进行N+1操作，引擎将这个新数据更新到内存中，并且将数据的更新操作到redo log。我的疑问就是为什么最开始还要去硬盘上去找呢，为什么不在粉板上直接写上ID=2的记录执行N+1,这样连账本都不用去翻了。现在的流程是不是 先是去磁盘上找到ID=2，但是更新完成以后在内存中以及redo log和binlog上，并没有实时的去更新到磁盘上。不知道有没有理解出错，望老师指点。。</div> <span class="time">2018-11-20</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/08/13/68579217.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">M哥</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">为什么满足prepare和binlog完整就是可以恢复的，我理解的是，在redo阶段是找到CK 的LSN开始通过redo日志重做，这个阶段是不管有没有commit都是会重做一遍的，这个时候是包含一部分脏数据的，在crash recovery的undo阶段会通过binlog进行判断是否需要回滚，因为binlog是完整的，所以prepare的uredo日志记录是不会会滚的，也就是说事物已经完成了。这么理解不知道对不对</div> <span class="time">2018-11-20</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/14/11/00/97770728.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">go</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">写入新行的意思是在磁盘上更新数据吗</div> <span class="time">2018-11-20</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/99/af/d29273e2.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Eliefly</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">两种备份的影响的数据库恢复的时间，一天一备最坏的情况下只要重放一天的日志量，而且在查找开始重放的pos点也更容易，可能只需要找一个binlog文件，一周一备可能已经产生多隔binlog文件。<br>另有个疑问是，把innodb_flush_log_at_trx_commit 和 sync_binlog 都设置为1，这样可以保证最好的一致性，但这样一来不是有两次同步磁盘io吗，就相当于翻了两次账本，这好像比翻一次更影响性能？</div> <span class="time">2018-11-20</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/1b/91/66f0d38a.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">花生</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">记录一些偏实践的东西：<br>&#47;&#47; 配置文件etc&#47;my.cnf中，下边两个参数为redo log单个文件大小 和 这一组有几个文件。如下配置为 一组2个文件，文件默认大小2G。<br>innodb-log-file-size                    = 2G<br>innodb-log-files-in-group            = 2<br><br>&#47;&#47;上边配置的log文件位于 var目录中，两个文件命名如下，大小都是2G <br>var$ ll -h<br>-rw-rw---- 1 mysql mysql 2.0G Nov 20 10:58 ib_logfile0<br>-rw-rw---- 1 mysql mysql 2.0G Nov 12 12:55 ib_logfile1<br><br>这两个文件是在硬盘中申请的连续存储空间，配置好的mysql中，redo log会完全占用这一块的存储，所以不论文件中存储多少信息，占用空间都是固定的值2G.<br></div> <span class="time">2018-11-20</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">👍🏿</p> <p class="reply-time">2018-11-20</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/c9/46/094b06bf.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">菠菜</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">在crash的时候，如果可以对比repo bin 是否同时写入了，算作该条数据是否丢弃的条件，那为何还需要commit呢？是有其他考虑吗</div> <span class="time">2018-11-20</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/cf/e0/f6819d03.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">鹏飞天下</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">默默的问一句，啥时候数据真正的落到磁盘，进去表中？？？是commit之后吗</div> <span class="time">2018-11-20</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">不是，“打烊的时候”和“粉板记不下”的时候这类时机</p> <p class="reply-time">2018-11-20</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/5d/7f/f22f9224.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">lzjun</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">按我的理解，redo存储的是这样的信息，“列c原来是1，现在是2”。至于是怎么来的，redolog不知道。而binlog存储的是信息是这条语句的原始逻辑，存储的是“我把表的c列执行了加1操作”这个逻辑，至于最终的值变成了什么，binlog是不知道的，而只有redolog知道</div> <span class="time">2018-11-20</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/86/59/e8f58a2a.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">LAMBO</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">两阶段提交听起来有点抽象，是否可以说得更通俗易懂点？</div> <span class="time">2018-11-20</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/79/53/3a824aed.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Terry</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">repo log的实现机制听起来像是循环队列。这样就限制了他的使用场景，不能够最为恢复数据的源，因为长度有限。所以恢复数据还的依靠binlog</div> <span class="time">2018-11-20</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/ed/a1/d2953af8.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Together</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">组复制模式下，如果主库有大事务产生，主库在等待从库接收的过程中，不断有新的交易进来，因为主库还没有收到从库的ACK，所以主库无法commit，数据也无法写入数据文件，有可能导致write pos追上checkpoint吗？</div> <span class="time">2018-11-20</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/48/a3/d803d383.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">牛牛粑粑</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">请问老师，崩溃恢复时，binlog完整是存储引擎判断的还是Server层判断的？个人感觉Server层应该是个无状态的，但是binlog又不是由存储引擎写入磁盘的，那么崩溃恢复时，是谁验证这个prepare状态的写入操作的binlog完整性呢？</div> <span class="time">2018-11-20</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/16/22/9c02761b.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">余向华|York</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">Binlog有两种模式，statement 格式的话是记sql语句， row格式会记录行的内容，记两条，更新前和更新后都有。<br>老师，我这里的疑问是如果是在开启了 statement 模式，也就说，在 server 层就已经完成了日志的备份了，数据库的存储引擎即使不是 InnoDB 引擎，也是拥有着 crash-fresh 能力，即使数据库异常重启了，把 binlog 给恢复，也不会丢数据，这样的理解对吗？</div> <span class="time">2018-11-20</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI0qUU5bc3kVeO0ZTJliau1dHMZglMib72gelIgKXew4RFDdAHsicodWgdaCwSAWetIuVaFwIzb2fFHw/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">刘向伟</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">问一下老师，既然redolog和binlog都是为了保持一次事物的一致性，那么这两个文件写的顺序可以换吗？</div> <span class="time">2018-11-19</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/ae/c8/0ca41f70.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">liu</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">话说aurora是不是就只有redolog batch落盘，拿掉binlog</div> <span class="time">2018-11-19</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/e7/b1/5c63be67.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">非礼勿言-非礼勿听-非礼勿视</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">如果binlog写入成功了，提交事务操作将redolog状态更新为commit时失败了或宕机了，这不就成了binlog写入成功，redolog失败吗</div> <span class="time">2018-11-19</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/e4/7d/7021c203.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">晓雯</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">既然redo log也可以恢复数据，那为什么都采用全备加binlog的方式？redo log是怎么恢复数据的，有什么限制条件吗？物理方式跟逻辑方式能讲一下吗 老师。</div> <span class="time">2018-11-19</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/87/95/9d7f390f.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">肉包肉包.zss</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师您好，请问下，真正刷数据空间这个动作，是innodb引擎的行为还是mysql server的行为呢？是以redo-log为依据还是以binlog为依据呢？<br>特指正常的流程，并不是指从节点拉取binlog同步数据的流程。</div> <span class="time">2018-11-19</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/f3/69/7039d03f.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">书策稠浊</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">感觉有bin就不需要redo了，请老师指点一下。</div> <span class="time">2018-11-19</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="" class="avatar">
<div class="info">
	<div class="hd"><span class="username">爱做梦的咸鱼</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">那redo log如果改成追加写是不是就可以持久化了呢，此时如果一直用innodb是否不需要binlog了</div> <span class="time">2018-11-19</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">全是innodb表的话理论上是可以的，不过现在官方还没这么做</p> <p class="reply-time">2018-11-19</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/12/b9/aab42878.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">风中追风</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，我有个地方不是很明白，innodb_flush_log_trx_commit跟sync_binlog的作用分别是将redolog跟binlog写到磁盘，难道默认情况下不是直接将这两个写到磁盘吗？还是这两个日志的内容是在内存里，只有配置了这两个参数才会写到磁盘</div> <span class="time">2018-11-19</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/5c/c5/1231d633.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">梁中华</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">接着高枕的话题继续讨论一下，如果第三步用户不是想commit而是想rollback,但不巧在第三步的时候崩溃了，回复后根据redo log和binlog一致来自动commit?</div> <span class="time">2018-11-19</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">如果用户执行rollback语句，整个事务就放弃了，不会进入“prepare”状态</p> <p class="reply-time">2018-11-19</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erPLyDtvoV5IZgCic99zfauGySv4ArucibEmmIKugLnhSaOF0csrCriaiaGupwibMJdYs4DtZtKrvvRfEw/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">everyok22</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">有redo log , 那在查询的时候是不是就得读所有的redo log里的数据呢， 数据库是如何保证查询的效率的。索引是在什么时候写入的呢，跟redo log 一起写入的么。</div> <span class="time">2018-11-19</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">不用，读内存就行了</p> <p class="reply-time">2018-11-19</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/fa/60/74a03dff.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">沙漠不二绿洲</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">林老师，感谢你让我从未如此清晰的理解了二阶段提交的原理和必要性。有个疑惑checkpoint是指redo buffer落盘的位置，还是指日志更新写到表中的位置（crash recovery的起始点），我在理解oracle的checkpoint是后者的。。就不知道他们俩是否都一样?</div> <span class="time">2018-11-19</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">Write pos是redo buffer接下来要写的位置， crash recovery 的起点就是checkpoint. (Crash recovery起点，这个提法很赞👍🏿</p> <p class="reply-time">2018-11-19</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/cb/ab/1aac53bf.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">董航</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，如果更新了一条数据，数据还在redolog里面，后续根据这个更新数据查询的sql不就获取不到数据了吗</div> <span class="time">2018-11-18</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/cb/ab/1aac53bf.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">董航</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">如果数据一直在redo log里面，那么如何查询最新的数据</div> <span class="time">2018-11-18</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/e0/67/6db879e4.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">phantom</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，那如果binlog已经记录，但redo进行commit失败，是否就是“前滚”？通过crash safe能够保证前滚到binlog记录的，redo prepare的状态？<br>另外，对于备份，在存储成本无需担心的情况下dba应该都会选择吧。毕竟追库时间一天以内啦。</div> <span class="time">2018-11-18</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="" class="avatar">
<div class="info">
	<div class="hd"><span class="username">eric254</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">mysql的redo log有没有log buffer？对于高并发事务或者批量事务 如何优化redo文件的写入瓶颈？</div> <span class="time">2018-11-18</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">有buffer的，事务整个完成才学到redolog文件。redolog是顺序写</p> <p class="reply-time">2018-11-18</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/d9/b0/16b8afd9.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">恺</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师好。原文看了几遍，评论也学习一遍，笔记也做了。现在有几个问题想请教下：<br>1、redolog是固定大小的，譬如4GB，那么数据保存 在内存上 是怎么个体现法（大小，内容，数据结构等）<br>2、评论里的redolog写磁盘写了两次有点不太明白（是持久化一次，checkpoint操作一次吗？）<br>3、redolog里的待checkpoint数据在select操作上完全不理解。。。<br>4、redolog有点类型消息队列MQ（譬如rabbitmq、activemq之类）分担当前写压力；而binlog类似记录入参的格式化后能被执行的log4日志，这么理解对吗？<br>5、能不能组建一个微信群或是qq群，即方便学员交流，也可以把一些比较好的知识点或资料整理到群文件里面（方便大家更深入的学习）。谢谢老师🙏🙏</div> <span class="time">2018-11-18</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">1.  后续文章会介绍到<br>2. Prepare写盘一次，commit写盘一次<br>3. 在内存里是对的<br>4. 有点近似，不是很精确哈<br>5. 我比较建议在评论区中讨论，这样大家都能看到，群的人数还是受限</p> <p class="reply-time">2018-11-18</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/0e/61/ae68f8eb.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">dream</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">redo log  和  binlog  分别在什么位置呢？</div> <span class="time">2018-11-18</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/e4/47/7d148d39.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">小娇</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">弱弱地问一句：老师，为什么binlog没有crash-safe的能力呢？不是写磁盘了吗？可以在重启后把宕机前的binlog中记录下来的异常事务sql语句执行一遍？<br></div> <span class="time">2018-11-18</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">一开始没这么设计，实际上现在的binlog也不够，奔溃恢复需要日志和引擎内存状态配合的</p> <p class="reply-time">2018-11-18</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/e5/39/951f89c8.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">信信</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师介绍了不用两阶段提交引发的不一致的的问题，但是没详细介绍用了两阶段提交，具体怎样工作的。看资料说是，崩溃恢复时，处于prepare 的事务会去查binlog ，如果有就继续提交事务，然后会去补充相应的redo log 。还有一点说的是prepare 标志记录在undo  log ，请老师指正。</div> <span class="time">2018-11-18</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">是这样的</p> <p class="reply-time">2018-11-18</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/45/64/2b09a36b.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">风二中</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">林老师，好，有几个疑问：<br>1）文中‘’update 语句执行流程‘’示意图，是先修改数据，在记日志。不应该是先写日志（生成重做日志），在修改数据（缓存里）吗？<br>2）redo log两阶段提交具体是怎么实现呢？我理解就是直接记录哪个页面做了什么修改到redolog（硬盘日志文件）就结束了，已经落盘了，prepare，和commit怎么理解呢<br>谢谢了</div> <span class="time">2018-11-18</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">1. 这两个其实是交叉发生的（对于一个有多次更新日志的事务来说），所以可以忽略先后。关键是他们都在“把日志写入redolog物理文件之前<br>2. 有了binlog, 需要两阶段</p> <p class="reply-time">2018-11-18</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/d9/b0/16b8afd9.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">恺</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师您好。如果有些基于MySQL文件系统的章节就好了，这样有利于“软硬”的结合。把每一块砖头都弄结实了，整体方能更坚固，不是么？!</div> <span class="time">2018-11-18</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">慢慢来哈</p> <p class="reply-time">2018-11-18</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/87/c4/50c8a490.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">陈逸</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师你好，请教您一个问题，是实际工作中遇到的，就是在大数据量高并发情况下，如何保证实时表数据的无延时更新？具体场景是在车联网的一个项目里，车辆每30s上报一次数据，共有将近20万辆车，通过网关采集到这些数据后，经过解析器处理再入库，hbase和mysql各写一份，hbase作为历史数据存储库，mysql作为实时数据存储库，这些实时数据首先被垂直拆分成了将近十张表，然后每次有新数据上报都是直接根据车辆唯一vin码进行更新，使用replace语法，模拟测试的时候10万辆车就出现消息堆积和延时了，mysql是部署在32核128g的云服务器上，做了主备。</div> <span class="time">2018-11-18</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">10万辆一起发的话就是要求10万的TPS，估计只能拆了…</p> <p class="reply-time">2018-11-18</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="" class="avatar">
<div class="info">
	<div class="hd"><span class="username">刘赛</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">请教下，如果在binlog写入成功后出问题了，redo log 就没有进行commit了，此时系统是什么状态呢</div> <span class="time">2018-11-18</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">崩溃恢复后事务提交。如果你是指这个瞬间，那就是“事务未完成”状态</p> <p class="reply-time">2018-11-18</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJAibnPX9jW8kqLcIfibjic8GbkQkEUYyFKJkc39hZhibVlNrqwTjdLozkqibI2IwACd5YzofYickNxFnZg/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Sinyo</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，innodb_flush_log_at_trx_commit这个参数设置成 1，是不是等于binlog的归档了呢？</div> <span class="time">2018-11-18</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">不是，这个但是是控制redolog的。 binlog存起来就有“归档”的功能</p> <p class="reply-time">2018-11-18</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/f9/03/23706390.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">魔都浪子</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">redo日志在prepare阶段之后就已经刷盘啦？我按我的理解，innodb_flush_log_at_trx_commit 应该是控制在commit之后才会写磁盘啊？如果是没有问题，如果不是，binlog刷盘后是无法保证redolog刷盘的。</div> <span class="time">2018-11-18</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">这个prepare已经是在你执行“COMMIT”语句里面了</p> <p class="reply-time">2018-11-18</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/7d/40/92bb705c.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">below zero</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">那个备份的问题，应该还是根据恢复时间快慢的需要来决定是一天一备还是一周一备。</div> <span class="time">2018-11-17</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="" class="avatar">
<div class="info">
	<div class="hd"><span class="username">kghch</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">数据库可用性，即宕机时的恢复速度</div> <span class="time">2018-11-17</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/00/52/d1a1d0ab.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Jason 彭</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">影响的是RPO，一个是一天，一个是七天。请问老师，这个问题中，备份周期的设置是通过什么实现的？</div> <span class="time">2018-11-17</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">这个是外部备份系统的工作</p> <p class="reply-time">2018-11-17</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/1NMAMj2T81BGLJhsnJ7IZL9BeP6LoX6ajukkTKficABoStaE6mAFHBibRQ3HiaG3VNJibVtqQy5m9RMibGfic62yibd7g/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">kali</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">1:取Id=2这行，是怎么知道这一行属于哪一个数据页的？<br>2:redo是记录某个数据页内容的变化？<br>3:binlog在row格式时，一直不明白是怎么记录的</div> <span class="time">2018-11-17</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">1. InnoDB内部管理<br>2. 是<br>3. 这个我补充到答疑文章里面哈</p> <p class="reply-time">2018-11-18</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/73/16/e8a1de30.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Yang</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，我理解Redo log和Binlog都是记录数据页的变化，他俩最大的区别应该是Redo log是固定大小循环记，而Binlog是达到指定大小后归档这一点吧。</div> <span class="time">2018-11-17</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">不是，  binlog做不到的</p> <p class="reply-time">2018-11-17</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="" class="avatar">
<div class="info">
	<div class="hd"><span class="username">娃哈哈</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">如果多个并发修改都未提交时，数据库崩溃了，这个时候有多个redolog的prepare和binlog的记录已经完成，但是还没有提交，这时重启后会怎么操作呢？innodb会通过binlog和prepare成对，然后去commit吗？那客户端会收到事务完成的通知吗？</div> <span class="time">2018-11-17</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">客户端肯定是收不到了， 但是还是会commit</p> <p class="reply-time">2018-11-18</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="" class="avatar">
<div class="info">
	<div class="hd"><span class="username">vo1d</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师你好，自学编程，刚接触mysql，最近碰到些问题想请教下老师。<br>1)我的数据表设计 id user ud,先做个多线程拿号登陆的功能，未避免拿到重复的号码，我百度到使用UPDATE $db SET ud=1, id=LAST_INSERT_ID(id) WHERE ud=0 LIMIT 1  ；SELECT user FROM $db WHERE ROW_COUNT()&gt;0 and id=LAST_INSERT_ID()；这两句来取号，但是效率很低，数据一大，mysql还容易崩溃。请问有更好的方法吗？谢谢。<br>2)我的第二个项目数据表设计 id user  info。数据利润  1，user1，1001;1002;1003。我想查询包含1001的数据，用like的话，数据少的话还可以接受，当百万数据的时候，就会很卡很慢。想请教老师有其他的方案吗？<br>新手，可能问题比较low，期待老师的解惑，谢谢。</div> <span class="time">2018-11-17</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">1. 你这个做法不好，应该先insert,拿到的这个last_insert_id就行<br><br>2. 如果有这种需求，最好不要把这些拆成单行。 或者创建另外一个表单独维护包含“1001”对应的集合</p> <p class="reply-time">2018-11-17</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/95/46/14cee147.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">hbprotoss</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">先写 redo log 后写 binlog 这个场景，个人感觉表述可以再修改一下。如果redo log先提交，那么主从复制的情况下，主库恢复是没问题的，但是由于没有binlog，从库数据就不一致了</div> <span class="time">2018-11-17</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er17O1Y2B8WibUQgQDibrVvTPqwF6dF6bKJLWE7gg2M2mEgZ5cHicn6KUJYHp9gmJfuP4bqshCUxfnGA/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">凉快</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">有一段不太懂：<br>具体来说，当有一条记录需要更新的时候，InnoDB 引擎就会先把记录写到 redo log（粉板）里面，并更新内存，这个时候更新就算完成了。<br>这里所说的，并更新内存，值得是更新内存里面的数据吗？ 即id为2的数据，<br>另一个问题，按照前面所讲的分区，那内存里面最大存储的数据量是否为4个G？（即，老板一直没时间写入账本，小黑板记录的最大数据量）</div> <span class="time">2018-11-17</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">1. 对，更新内存<br>2. 粉板记录的最多的更新记录是4G。 我们说的内存是放数据的内存，就是buffer_pool的大小</p> <p class="reply-time">2018-11-18</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/53/68/593703a5.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">dev4mobile</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">有没有这样的命令dump日志得到查询历史SQL语句？</div> <span class="time">2018-11-17</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">更新在binlog里面有记录，用mysqlbinlog工具可以，仅限更新语句</p> <p class="reply-time">2018-11-18</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/5c/89/f7fff085.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">张双星</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">我想问下，定时备份也是通过执行当前时间到上一次备份时间之间的binlog来完成的吗？</div> <span class="time">2018-11-17</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">这个其实也是一种做法，不会大家用的更多的还是直接找个备库再全量备一次</p> <p class="reply-time">2018-11-18</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/89/e1/2f3cc2d6.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">布衣</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，redo log是prepare状态，写binlog时crash；以及binlog写成功，但是redolog更新为commit状态时crash；重启后的回复机制又是怎么做的呢？</div> <span class="time">2018-11-17</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">第一个回滚，第二个事务有效</p> <p class="reply-time">2018-11-17</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/5b/72/4f8a4297.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">阿May的海绵宝宝</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">1.单独依靠redologo无法做到指定某一点的恢复，是不是因为redologo是循环写的，如果要恢复的那一时刻被擦掉了，就无法知道这点的数据变动轨迹，而binlog是追加的方式，在文件完整的前提下，数据的变动轨迹都可以知晓？<br>2. 最后三步是 ①引擎写redolog，并处于prepare状态   ②执行器写binlog，成功后，发送commit<br>   ③引擎刚写入的redolog改变为commit状态<br>  如果crash发生后  redolog =prepare   binlog没有对应写入记录，则回滚<br>  如果crash发生后  redolog =prepare  binlog有对应写入记录，则提交<br>感觉有点像  1 &amp;&amp; 1= 1   1&amp;&amp;0=0   0&amp;&amp;1=0<br>3.binlog模式  ①记录sql语句    ②记录更新前后的行     一般是用哪种模式？</div> <span class="time">2018-11-17</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">1 对的<br>2 对的👍🏿<br>3 建议使用row格式，就是第二种</p> <p class="reply-time">2018-11-17</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/01/0c/72905a3a.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">宇锋</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">请问<br>1 binlog成功之后，更新redolog状态为commit出错了，好像还是会出现不一致。<br>2 可以说一下binlog的归档是什么意思?比如stament模式，他只是记录了原始更新sql,那他含有什么归档信息呢？</div> <span class="time">2018-11-17</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/14/06/df/d0fe2300.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">刘文韬</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">请问林老师，新行更新到内存与写redo log之间怎么保证一致性？如果在默认隔离级别（可重复读）下，是否此时的更新是写一块新内存？</div> <span class="time">2018-11-17</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">下一讲就讲MVCC😄 等周天晚上哈</p> <p class="reply-time">2018-11-17</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/f9/03/23706390.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">魔都浪子</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">“update 语句时的内部流程”中的步骤4后系统崩溃，产生的效果不是跟后面举的例子先写binlog后写redo log一样嘛？也就是说binlog已经写入磁盘，但是没有commit的时候发生crash，那么redolog没有机会写入磁盘，这样两阶段一样会产生两种不一致的日志。</div> <span class="time">2018-11-17</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/f4/94/13379a7f.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">肥龙</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，前面说的 “如果 write pos 追上 checkpoint，会擦出一部分数据”<br>擦出数据的多少的衡量标准是什么？也就是说，如果 write pos赶上了checkpoint，会擦出多少数据？这个是配置决定？还是mysql会随机擦出一部分？<br></div> <span class="time">2018-11-17</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/86/e3/28d1330a.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">fsj</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师与同学在留言区互动真是太赞了，数据库小白用户也能看懂很大一部分，赞赞赞</div> <span class="time">2018-11-17</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/fe/75/46742f12.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">liao xueqiang</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">个人理解，redo包含已提交和未提交的数据，而binlog只包含已提交的数据，请老师确认</div> <span class="time">2018-11-17</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Ethan</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师我想问一下为什么update的时候要把这个表所有的缓存都清空而不是只把更新的条目失效掉？</div> <span class="time">2018-11-17</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/df/b3/4860a6bc.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">高小强</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">通俗易懂，期待老师下一篇的分享！</div> <span class="time">2018-11-17</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/e2/ff/ca3dec06.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">狗蛋</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">5.7不是已经改了吗？prepare阶段写redo log改到binlog三阶段写的flush阶段了?</div> <span class="time">2018-11-17</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">这个是实现上的，逻辑上的这三个操作都还在</p> <p class="reply-time">2018-11-17</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Nick</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">在一个大事物或长事物里，一边执行sql一边写redo log吗？未提交的事物也会写到redo log file吗？</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">会先写一块内存，叫做log_buffer里面，在提交的时候再一次性写到磁盘</p> <p class="reply-time">2018-11-17</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/22/8a/93ee037f.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Oren</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">讲的很好。👍</div> <span class="time">2018-11-16</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/f8/b5/82b64369.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">阿涛</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">如果更新写入redolog后处于prepare状态，此时系统突然断电，那么binlog没有写入记录，重启后数据库的实际数据根据redolog更新了，但与binlog的语句记录不符，那么binlog怎么办？</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">不会，这时候事务会回滚，binlog也没有，所以是一致的</p> <p class="reply-time">2018-11-17</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Nr8o80t7TVwlXk7eoFYQpknWiayM5NbWKSf4DicTmYxGSoKoUwNurxjvDflgpZu6I9ChWdNr14gbABgq1ibP2cvWg/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">悟空</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">留言太多了，老师可以过滤下吗？把比较集中的代表性的问题，放出来</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">我觉得这些还是应该发出来。不过你可以选择一下，编辑会把好的评论和答复置顶。</p> <p class="reply-time">2018-11-17</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/f9/fa/62682d86.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">DotaSeven</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，我想模式redo_log成功，bin_log失败；或者反过来。该如何模拟呢？</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">这个稍微有点麻烦，最直接方法是GDB，停在两个函数中间，然后coredump出来</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/45/b4/ec66d499.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">oscarwin</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，还有一个疑问，update后先写入内存，然后写redo log，那么写入的这条数据在内存中的驻留时间是怎么处理的？是redo log写入磁盘后从内存中删除吗？</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">不会删除，除非内存不够用。不过在数据从内存删除之前，系统会保证它会被更新到磁盘数据上</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/45/b4/ec66d499.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">oscarwin</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">对思考题说说自己粗浅的理解，如果业务数据量非常大，那么一天一备要比一周一备会更好，因为一天一备相当于把备份的压力分散了，如果全部集中到一周后备份，那么备份的压力会很大。如果业务数据非常重要，一天一备也比一周一备更好，一旦出现了binlog日志被损坏的情况，最多也只丢失了一天的数据。但是，我感觉备份只要有binlog日志就可以，这样不需要占用主库的资源就可以完成备份，所以备份会影响哪些指标还思考不到</div> <span class="time">2018-11-16</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/7a/0a/0ce5c232.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">吕</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">两步提交法，如果在binlog执行完crash，那这时事务处于未提交状态，是prepared的状态，这样会不会也导致恢复的时候数据不一致？</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">这时候是算提交成功的</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/14/00/4e/6a23251c.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">小智e</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">那为什么两次提交可以确保一致性呢？小白勿喷</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">这样问题比较难回答哈，你可以先理解下文章里面的反证的例子，返回想一个两阶段的崩溃的例子，看看哪里没想清楚再提出来</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/7a/0a/0ce5c232.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">吕</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">你好，关于提到的&#39;数据页&#39;这个词我没有太理解，是一种存储方式么？</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">MySQL的记录是以“页”为单位存取的，默认大小16K。也就是说，你要访问磁盘中一个记录，不会只读这个记录，而会把它所在的16K数据一起读入内存</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/57/6e/dd0eee5f.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">夜空中最亮的星（华仔）</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师写的很棒，收获很多，真的赚到了。</div> <span class="time">2018-11-16</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/69/c6/a591b02a.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">强哥</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd"> 一句话，redo日志用于保障，已提交事务的ACID特性。同时随机写改为顺序写，提升性能。这里缺少undolog的讲解吧？</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">是，undolog在后面一篇：）</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/f7/9d/be04b331.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">落叶飞逝的恋</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">还有这两种日志可以在哪直观查看</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">都是文件，在数据库的data目录下，默认的，redolog是ib_log_file0这样的，binlog是xxx-bin.000001这样的</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/f7/9d/be04b331.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">落叶飞逝的恋</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">一天一备份相比一周一备份而言，更加可靠。发生数据库异常，可以快速恢复。</div> <span class="time">2018-11-16</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/f2/83/f2b7036b.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">lucia</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">讲解得很透彻</div> <span class="time">2018-11-16</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="" class="avatar">
<div class="info">
	<div class="hd"><span class="username">yy</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师 我想请教一下 两个控制日志写磁盘的性能参数 如果都设置1 会不会对io影响很大 对大并发也要设成1吗</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">一般这两个都建议设置成1（有时候称双1），除非你的系统IO撑不住了要临时应急</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/11/60/abb7bfe3.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">ThinkingQuest</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">两阶段提交这块看的不是很明白。<br><br>那个过程4之后写入binlog之后如果系统crash了，没有把redo log标记为commit的话，它会怎么样呢。 处在prepare状态下。 <br><br>两阶段提交这个东西，在分布式理论中看到过多次，反复考虑它的过程，始终觉得并不能保证一致性啊。<br>求解答。<br></div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">崩溃恢复后算成功</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/14/5d/3870280f.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">极客童</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">我有个疑问，按照正常的两步提交，先写redo log，回来写bin log，然后再commit的时候故障重启没成功，这时候不是也会导致两者日志不一致的问题吗？</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">不会的，看一下置顶文章的评论哈</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/10/8d/43edb2dd.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">守着云开</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">binlog里面有了 崩溃恢复的时候 redolog就会认可这个事务 这与binlog用于恢复数据的目的一致  可以这样理解吧</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">对</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epfVZHmbUnsxU67FwotibOjM0Obc47VWMyRBmY06AjqTp0C96A8zhUULWjBerK3XtPC7Q8LVClzPxA/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">尼古拉斯·赵四</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">在RTO上一天一备会比一周一备更有优势</div> <span class="time">2018-11-16</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/14/00/e9/00fd2bd3.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">五云天北是神州</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">坐等老师讲一讲详细的crash_recovery，尤其是undo和binlog对比事务链表的回滚那部分。谢谢</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">会在《MySQL重启一次要多久》里面提到，不过更多还是指出有这些过程，应用怎么处理… </p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/15/9f/44a9f51b.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">华仔</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">没有听懂两阶段提交的意思？是指阶段状态的提交，还是指redo日志的一次提交加binlog日志的一次提交呢。<br>是redo日志的两次状态提交么？</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">这个命名来源于redolog提交分成了两阶段</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/fa/32/04056740.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">©w©</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">有個疑問: pos和checkpoint的位置一開始是怎麼確定的呢?checkpoint什麼時候移動呢?應該怎麼移動?移動多少？</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">一开始就是从头了，中间如果有重启，也从重启前的位置继续。 <br><br>移动就是向右，到末尾循环；<br><br>移动多少 取决于事务要写下多少的日志</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/e7/7b/71da8283.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">似水流年</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">binlog感觉像oracle的归档日志，那么也有设置binlog日期的参数，这个参数是？默认值又是多少？</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">expire_logs_days<br>默认是0 表示不自动删除；非零的话，单位是天</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/7f/88/c4263c58.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">五年</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">redo log 满血复活是怎么做到的呢.如果数据库 crash 掉, redo log 是保存到 crash 之前的最后一次提交, binlog 也是; 这时候数据库恢复的话,数据库本身为什么会丢什么数据呢...</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">这样不算丢数据呀</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er6NXib2NGaTAAEe2KCcibH2FiafOOD73kQdcuAMGrnRib5CDWXum0SWDOM9NnWicbUsDpghmxEmJtpk9w/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">tchz</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，假如有一条sql要把c的值从0更新为1，如果已经记了redo log，但是还没有记binlog，这个时候MySQL崩掉了，恢复的时候，存储引擎发现记了redo log,但是没记binlog，存储引擎会把事务回滚，也就是数据库里记的值还是0。如果server记了binlog，但是还没来得及提交事务，那么crash recovery的时候会把这个事务提交，那么数据库里的值就是1。是这个样子的吗？还有一个问题就是，如果是这样子的，因为redo log是引擎层的，binlog是server层的，那么他们之间是怎么交互的？如果不是这样的，那mysql的crash recovery是怎么做的？</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">是你说的这样。<br><br>他们是在同一个执行流程里“按顺序执行”，这么交互的😄</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/32/23/5de4b29a.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">滴答</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">有两个问题想请教老师：<br>1、redolog记录更新日志，当更新完一个表之后再进行查询，此时会将这个表的redolog刷到物理表中再进行查询吗？如果不是的话是如何保证数据最新？<br>2、数据恢复是以binlog的记录为准吗？如果要考虑redolog，那redolog如何帮助恢复？</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">1. 不会。就直接从内存读走，内存是对的就行<br><br>2. 用binlog是用在备份恢复到过程中，这个过程就是用全量备份+binlog,你可以认为没redolog的帮助</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/de/29/71685b0b.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">BigMortal</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">那么在什么场景下，一天一备会比一周一备更有优势呢？或者说，它影响了这个数据库系统的哪个指标？<br>回答：故障发生，需要快速恢复，一周一备，需要应用一周的binlog，恢复时间会相对较长；不知道我的理解时候正确</div> <span class="time">2018-11-16</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/4b/bc/86a9ac70.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">如是</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，既然通过binlog就能恢复数据，为什么还要用redolog？只是重启的时候需要根据备份数据再执行一次binlog,启动可能会耗时，但是大部分情况下都是正常的，这种情况也可以根据备份数据和binlog合并来适当减缓这个问题，不知道我的理解是不是哪有问题，还是redolog还在别的操作上使用。</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">看一下置顶回复</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/07/c2/9066aee8.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Kam</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">感觉很深刻。评论也有干货。</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">谢谢表扬😄<br><br>嗯评论区我觉得是个很好的地方。有些点在正文展开就会打乱整体思路，不能无限细节；<br><br>评论区就是针对细节的，刚好补充</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJAibnPX9jW8kqLcIfibjic8GbkQkEUYyFKJkc39hZhibVlNrqwTjdLozkqibI2IwACd5YzofYickNxFnZg/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Sinyo</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，是不是只能用bin log或redo log其中一个日志对数据库进行还原？</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">置顶回复中说明了，看一下</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="" class="avatar">
<div class="info">
	<div class="hd"><span class="username">爸爸回来了</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">恢复数据时，根据全量所在的pos开始由binlog恢复。假设你周天做恢复，使用的是周一的备份。那么你有周二周三周四周五周六的binlog要恢复。这个过程是可以很感人的(ಥ_ಥ)</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">作者碰到一个月一备，要跑20多天日志的，了解一下😭</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/a1/4b/254480d3.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">石建磊</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">两阶段提交那里不太懂，我理解是不是只要binlog保存成功，数据就能恢复，redolog 是不是就为了加快innodb引擎的写速度的?</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">Binlog写完就算，但是并不是用binlog恢复，恢复这个工作还是innodb做的</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/cf/5c/d4e19eb6.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">安小依</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">更新完内存以后，mysql 会直接返回给客户端吗？还是说会等待 commit 成功才返回</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">必须等commit完成后</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/4f/78/c3d8ecb0.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">undifined</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师 如果 binlog 或者 redo log 在写入磁盘的过程中故障了怎么保障数据一致</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">整个事务回滚，数据也没有，日志也没有，也是一致的</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJAibnPX9jW8kqLcIfibjic8GbkQkEUYyFKJkc39hZhibVlNrqwTjdLozkqibI2IwACd5YzofYickNxFnZg/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Sinyo</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师以后可以提及一下BRIGHTHOUSE引擎么？谢谢！</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">这个专栏应该不会涉及，主要涉及的还是大家碰到比较多的问题和概念</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/e9/8e/6dc15a91.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">晨思暮语</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">丁老师你好，有个问题请帮忙答疑？就是如果innodb_flush_at_trx_commit与sync_binlog都是非1情况下，prepare阶段如何处理redo log，谢谢！</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">处理是一样的，只是不是1，会不会每次写完直接强制落盘</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/36/d2/c7357723.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">发条橙子 。</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，我现在有点搞不懂 mysql 缓存机制和 innodb缓存机制的关系 ，以及   redo日志也有缓存，如果在缓存中还没同步到 redo 日志里的时候，mysql 发生的 crash 时，是否更新记录就真的没了</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">会没了，但是没关系，因为redolog都没写完，表示你事务还没提交，中间出了错，本来就应该没的</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/e7/7b/71da8283.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">似水流年</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">是否在redo没写时重启数据库，会使事务丢失？这个交易也失败。怎样情况重启会出现数据库数据不一致呢？oracle都存在重启后数据不一致的情况。数据不一致后怎么恢复？</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">Redolog没写，这个不算丢数据的。交易失败是预期的，也应该这样处理。就靠业务重试</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/34/5c/6b4757a0.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">倪大人</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">关于redolog prepare之后发生意外，通过binlog恢复时怎么处理的问题，我理解是这样的：通过binlog恢复时默认会把binlog中未提交的记录提交一下，这样这部分数据binlog跟redolog就对得上了。如果binlog中没有记录，redolog中未提交的记录会回滚，相当于这一次更新失败，这样两边也能对得上了。</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">默认会把binlog中未提交的事务，稍微改一下，写成“默认会把binlog中已经完整写完的binlog事务” 。<br><br>嗯嗯解释很到位</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/5e/c1/cd721d46.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">_yiunia##远</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">&quot;前面我们说过，在一个表上有更新的时候，跟这个表有关的查询缓存会失效，所以这条语句就会把表 T 上所有缓存结果都清空。&quot; 感觉不准确。。MySQL5.6开启缓存，第一次查询时间很长，第二次查询命中缓存时间很短，随意修改一行updated 时间，再次查询时间仍然很短。何解？</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">恐怕是innodb buffet pool发挥的作用😄</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/47/65/cce8eb34.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">nimil</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">对于数据丢失时的恢复速度，如果一周一备相对于一天一备来说恢复速度肯定是要慢的，如果数据每天更新量不是很大，可以选择一周一备</div> <span class="time">2018-11-16</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/f1/5f/6ac1c883.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">张良</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">回答上面李提出的问题：始终记住一点它们两个pos都是朝一个方向，按照一致的路径循环的。按图中所示，可写空间是从write pos到3，加上从0到check pos</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">👍🏿到位</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/12/78/e4/7978869e.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">对方正在输入中…</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">回答问题：<br>1如果没有主从，无Binlog Server，建议至少每天一备份，库很小并发少，可以缩短备份周期，例如每小时备份一次。<br>2如果有主从，有Binlog Server，建议至少每周备份一次，库较小并发不算高，可以缩短备份周期，例如每天备份一次。<br>这里不区分有主从无Binlog Server的情况，是由于重要系统建议至少搭建主从复制，尽可能搭建Binlog Server(金融环境尤为重要)。</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">条理清晰的</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/e2/cb/6bc95e09.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">喔～</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师，有点疑惑请教一下<br>对于 deferred 写操作，通过redo 来实现事务<br>对于 in-place 写操作，通过undo 来实现事务<br>那么对于redo与undo共存的日志体系，其目的与应用场景是怎样的？</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">Redo和undo都在支持事务的，undo用于支持事务的隔离性（下一讲会介绍），redo支持持久性</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/14/50/c23cf47d.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">李</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">wirte pos 是当前记录的位置，一边写一边后移，写到第 3 号文件末尾后就回到 0 号文件开头。checkpoint 是当前要擦除的位置，也是往后推移并且循环的，擦除记录前要把记录更新到数据文件。<br><br>write pos 和 checkpoint 之间的是“粉板”上还空着的部分，可以用来记录新的操作。如果 write pos 追上 checkpoint，表示“粉板”满了，这时候不能再执行新的更新，得停下来先擦掉一些记录，把 checkpoint 推进一下。<br>这个看不明白，按上图看的话，是不是画反了，不然已经超过检查点好远了？<br>如果没画反，检查点不是应该擦掉检查点之间的数据吗，那和写点之间的距离就是刚写过的，怎么可以用来记录新的？</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">看一下置顶评论哦</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/9b/ba/333b59e5.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Linuxer</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">请问用redolog恢复时还写binlog吗？反之呢？</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">崩溃恢复过程不写binlog了，用binlog恢复实例（或搭建备库）的时候，是会写redolog的</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/e0/22/18aa3672.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">涂涂的爸爸</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">你好，这篇讲到了redo log 和binlog，后面会不会补充下bilog的组提交以及并发复制呢？感谢！</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">这个专栏这类会涉及比较少，这个专栏我们会更偏“业务应用 和 与应用相关的原理” binlog组提交太底层了，对开发几乎完全透明…</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/0FI2bUjegtznv7XPC9DB9RJaqiaMiamWkibibPOibuUC3DCvI7XMvBANr6sDjRNbc1jwPic9pIaFxrdaib88VqUJKXSTQ/132" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Chenl07</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">前面我们说过，在一个表上有更新的时候，跟这个表有关的查询缓存会失效，所以这条语句就会把表 T 上所有缓存结果都清空。<br><br>老师，这里所有缓存清空，包括数据缓存吗？</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">这里说的清空的就是所有跟这个表有关的query_cache</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/13/fe/68/e0bebd9a.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">高枕</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">老师最后留的问题 是不是会影响到binlog的指标？也就是说，如果一天一备，那么binlog就可以不用保留一天之前的信息了</div> <span class="time">2018-11-16</span>
	<div class="reply">
	
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/c5/14/7f165bfe.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">@周祥兴</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">双写这个没有出现</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">嗯这个比较底层，运维开发基本无感知，怕展开太多。（其实这篇正文内容已经多了😁</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/ab/10/b812ff3e.jpg" class="avatar">
<div class="info">
	<div class="hd"><span class="username">Hesher</span>
	<div class="control">
		 <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>0</span></a></div>
	</div>
	<div class="bd">当一周内redolog容量超过4G？</div> <span class="time">2018-11-16</span>
	<div class="reply">
	<div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> 
	<p class="reply-content">Redolog循环写，一周写超过4G没问题。 你要再看一下文章哈。</p> <p class="reply-time">2018-11-16</p>
	</div>
</div>
</li></ul></div></div></div></div><div id="translate-man-app" class="content-3WfBL_0" style="background-color: rgb(255, 255, 255); display: none;"><div data-v-ea0bd11e="" class="outputBox-qe9A4_0"><div data-v-ea0bd11e="" class="outputBox-3oESn_0"><span data-v-ea0bd11e="" class="outputBox-13Ovx_0"></span></div><div data-v-ea0bd11e="" class="outputBox-1GLb__0"><div data-v-ea0bd11e="" class="outputBox-onVZH_0"><img src="chrome-extension://fapgabkkfcaejckbfmfcdgnfefbmlion/static/sound.svg"            class="icon-tprjJ_0"></div></div><div data-v-ea0bd11e="" class="outputBox-2sJgr_0"></div><div data-v-ea0bd11e="" class="outputBox-17RAm_0" style="display: none;"><div data-v-ea0bd11e=""></div></div></div></div><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({        showProcessingMessages: false,        messageStyle: "none",        tex2jax: {          inlineMath: [['$','$'], ['\\(','\\)']],          displayMath: [ ["$$","$$"] ],          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code', 'a']        }      });      MathJax.Hub.Register.MessageHook("End Process", function (message) {        var eve = new Event('mathjaxfini')        window.dispatchEvent(eve)      })</script></body></html>